{"ast":null,"code":"'use strict';\n\nmodule.exports = createFilteredVector;\n\nvar cubicHermite = require('cubic-hermite');\n\nvar bsearch = require('binary-search-bounds');\n\nfunction clamp(lo, hi, x) {\n  return Math.min(hi, Math.max(lo, x));\n}\n\nfunction FilteredVector(state0, velocity0, t0) {\n  this.dimension = state0.length;\n  this.bounds = [new Array(this.dimension), new Array(this.dimension)];\n\n  for (var i = 0; i < this.dimension; ++i) {\n    this.bounds[0][i] = -Infinity;\n    this.bounds[1][i] = Infinity;\n  }\n\n  this._state = state0.slice().reverse();\n  this._velocity = velocity0.slice().reverse();\n  this._time = [t0];\n  this._scratch = [state0.slice(), state0.slice(), state0.slice(), state0.slice(), state0.slice()];\n}\n\nvar proto = FilteredVector.prototype;\n\nproto.flush = function (t) {\n  var idx = bsearch.gt(this._time, t) - 1;\n\n  if (idx <= 0) {\n    return;\n  }\n\n  this._time.splice(0, idx);\n\n  this._state.splice(0, idx * this.dimension);\n\n  this._velocity.splice(0, idx * this.dimension);\n};\n\nproto.curve = function (t) {\n  var time = this._time;\n  var n = time.length;\n  var idx = bsearch.le(time, t);\n  var result = this._scratch[0];\n  var state = this._state;\n  var velocity = this._velocity;\n  var d = this.dimension;\n  var bounds = this.bounds;\n\n  if (idx < 0) {\n    var ptr = d - 1;\n\n    for (var i = 0; i < d; ++i, --ptr) {\n      result[i] = state[ptr];\n    }\n  } else if (idx >= n - 1) {\n    var ptr = state.length - 1;\n    var tf = t - time[n - 1];\n\n    for (var i = 0; i < d; ++i, --ptr) {\n      result[i] = state[ptr] + tf * velocity[ptr];\n    }\n  } else {\n    var ptr = d * (idx + 1) - 1;\n    var t0 = time[idx];\n    var t1 = time[idx + 1];\n    var dt = t1 - t0 || 1.0;\n    var x0 = this._scratch[1];\n    var x1 = this._scratch[2];\n    var v0 = this._scratch[3];\n    var v1 = this._scratch[4];\n    var steady = true;\n\n    for (var i = 0; i < d; ++i, --ptr) {\n      x0[i] = state[ptr];\n      v0[i] = velocity[ptr] * dt;\n      x1[i] = state[ptr + d];\n      v1[i] = velocity[ptr + d] * dt;\n      steady = steady && x0[i] === x1[i] && v0[i] === v1[i] && v0[i] === 0.0;\n    }\n\n    if (steady) {\n      for (var i = 0; i < d; ++i) {\n        result[i] = x0[i];\n      }\n    } else {\n      cubicHermite(x0, v0, x1, v1, (t - t0) / dt, result);\n    }\n  }\n\n  var lo = bounds[0];\n  var hi = bounds[1];\n\n  for (var i = 0; i < d; ++i) {\n    result[i] = clamp(lo[i], hi[i], result[i]);\n  }\n\n  return result;\n};\n\nproto.dcurve = function (t) {\n  var time = this._time;\n  var n = time.length;\n  var idx = bsearch.le(time, t);\n  var result = this._scratch[0];\n  var state = this._state;\n  var velocity = this._velocity;\n  var d = this.dimension;\n\n  if (idx >= n - 1) {\n    var ptr = state.length - 1;\n    var tf = t - time[n - 1];\n\n    for (var i = 0; i < d; ++i, --ptr) {\n      result[i] = velocity[ptr];\n    }\n  } else {\n    var ptr = d * (idx + 1) - 1;\n    var t0 = time[idx];\n    var t1 = time[idx + 1];\n    var dt = t1 - t0 || 1.0;\n    var x0 = this._scratch[1];\n    var x1 = this._scratch[2];\n    var v0 = this._scratch[3];\n    var v1 = this._scratch[4];\n    var steady = true;\n\n    for (var i = 0; i < d; ++i, --ptr) {\n      x0[i] = state[ptr];\n      v0[i] = velocity[ptr] * dt;\n      x1[i] = state[ptr + d];\n      v1[i] = velocity[ptr + d] * dt;\n      steady = steady && x0[i] === x1[i] && v0[i] === v1[i] && v0[i] === 0.0;\n    }\n\n    if (steady) {\n      for (var i = 0; i < d; ++i) {\n        result[i] = 0.0;\n      }\n    } else {\n      cubicHermite.derivative(x0, v0, x1, v1, (t - t0) / dt, result);\n\n      for (var i = 0; i < d; ++i) {\n        result[i] /= dt;\n      }\n    }\n  }\n\n  return result;\n};\n\nproto.lastT = function () {\n  var time = this._time;\n  return time[time.length - 1];\n};\n\nproto.stable = function () {\n  var velocity = this._velocity;\n  var ptr = velocity.length;\n\n  for (var i = this.dimension - 1; i >= 0; --i) {\n    if (velocity[--ptr]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nproto.jump = function (t) {\n  var t0 = this.lastT();\n  var d = this.dimension;\n\n  if (t < t0 || arguments.length !== d + 1) {\n    return;\n  }\n\n  var state = this._state;\n  var velocity = this._velocity;\n  var ptr = state.length - this.dimension;\n  var bounds = this.bounds;\n  var lo = bounds[0];\n  var hi = bounds[1];\n\n  this._time.push(t0, t);\n\n  for (var j = 0; j < 2; ++j) {\n    for (var i = 0; i < d; ++i) {\n      state.push(state[ptr++]);\n      velocity.push(0);\n    }\n  }\n\n  this._time.push(t);\n\n  for (var i = d; i > 0; --i) {\n    state.push(clamp(lo[i - 1], hi[i - 1], arguments[i]));\n    velocity.push(0);\n  }\n};\n\nproto.push = function (t) {\n  var t0 = this.lastT();\n  var d = this.dimension;\n\n  if (t < t0 || arguments.length !== d + 1) {\n    return;\n  }\n\n  var state = this._state;\n  var velocity = this._velocity;\n  var ptr = state.length - this.dimension;\n  var dt = t - t0;\n  var bounds = this.bounds;\n  var lo = bounds[0];\n  var hi = bounds[1];\n  var sf = dt > 1e-6 ? 1 / dt : 0;\n\n  this._time.push(t);\n\n  for (var i = d; i > 0; --i) {\n    var xc = clamp(lo[i - 1], hi[i - 1], arguments[i]);\n    state.push(xc);\n    velocity.push((xc - state[ptr++]) * sf);\n  }\n};\n\nproto.set = function (t) {\n  var d = this.dimension;\n\n  if (t < this.lastT() || arguments.length !== d + 1) {\n    return;\n  }\n\n  var state = this._state;\n  var velocity = this._velocity;\n  var bounds = this.bounds;\n  var lo = bounds[0];\n  var hi = bounds[1];\n\n  this._time.push(t);\n\n  for (var i = d; i > 0; --i) {\n    state.push(clamp(lo[i - 1], hi[i - 1], arguments[i]));\n    velocity.push(0);\n  }\n};\n\nproto.move = function (t) {\n  var t0 = this.lastT();\n  var d = this.dimension;\n\n  if (t <= t0 || arguments.length !== d + 1) {\n    return;\n  }\n\n  var state = this._state;\n  var velocity = this._velocity;\n  var statePtr = state.length - this.dimension;\n  var bounds = this.bounds;\n  var lo = bounds[0];\n  var hi = bounds[1];\n  var dt = t - t0;\n  var sf = dt > 1e-6 ? 1 / dt : 0.0;\n\n  this._time.push(t);\n\n  for (var i = d; i > 0; --i) {\n    var dx = arguments[i];\n    state.push(clamp(lo[i - 1], hi[i - 1], state[statePtr++] + dx));\n    velocity.push(dx * sf);\n  }\n};\n\nproto.idle = function (t) {\n  var t0 = this.lastT();\n\n  if (t < t0) {\n    return;\n  }\n\n  var d = this.dimension;\n  var state = this._state;\n  var velocity = this._velocity;\n  var statePtr = state.length - d;\n  var bounds = this.bounds;\n  var lo = bounds[0];\n  var hi = bounds[1];\n  var dt = t - t0;\n\n  this._time.push(t);\n\n  for (var i = d - 1; i >= 0; --i) {\n    state.push(clamp(lo[i], hi[i], state[statePtr] + dt * velocity[statePtr]));\n    velocity.push(0);\n    statePtr += 1;\n  }\n};\n\nfunction getZero(d) {\n  var result = new Array(d);\n\n  for (var i = 0; i < d; ++i) {\n    result[i] = 0.0;\n  }\n\n  return result;\n}\n\nfunction createFilteredVector(initState, initVelocity, initTime) {\n  switch (arguments.length) {\n    case 0:\n      return new FilteredVector([0], [0], 0);\n\n    case 1:\n      if (typeof initState === 'number') {\n        var zero = getZero(initState);\n        return new FilteredVector(zero, zero, 0);\n      } else {\n        return new FilteredVector(initState, getZero(initState.length), 0);\n      }\n\n    case 2:\n      if (typeof initVelocity === 'number') {\n        var zero = getZero(initState.length);\n        return new FilteredVector(initState, zero, +initVelocity);\n      } else {\n        initTime = 0;\n      }\n\n    case 3:\n      if (initState.length !== initVelocity.length) {\n        throw new Error('state and velocity lengths must match');\n      }\n\n      return new FilteredVector(initState, initVelocity, initTime);\n  }\n}","map":{"version":3,"sources":["C:/Projects/reactApp/frontend/node_modules/filtered-vector/fvec.js"],"names":["module","exports","createFilteredVector","cubicHermite","require","bsearch","clamp","lo","hi","x","Math","min","max","FilteredVector","state0","velocity0","t0","dimension","length","bounds","Array","i","Infinity","_state","slice","reverse","_velocity","_time","_scratch","proto","prototype","flush","t","idx","gt","splice","curve","time","n","le","result","state","velocity","d","ptr","tf","t1","dt","x0","x1","v0","v1","steady","dcurve","derivative","lastT","stable","jump","arguments","push","j","sf","xc","set","move","statePtr","dx","idle","getZero","initState","initVelocity","initTime","zero","Error"],"mappings":"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","sourcesContent":["'use strict'\n\nmodule.exports = createFilteredVector\n\nvar cubicHermite = require('cubic-hermite')\nvar bsearch = require('binary-search-bounds')\n\nfunction clamp(lo, hi, x) {\n  return Math.min(hi, Math.max(lo, x))\n}\n\nfunction FilteredVector(state0, velocity0, t0) {\n  this.dimension  = state0.length\n  this.bounds     = [ new Array(this.dimension), new Array(this.dimension) ]\n  for(var i=0; i<this.dimension; ++i) {\n    this.bounds[0][i] = -Infinity\n    this.bounds[1][i] = Infinity\n  }\n  this._state     = state0.slice().reverse()\n  this._velocity  = velocity0.slice().reverse()\n  this._time      = [ t0 ]\n  this._scratch   = [ state0.slice(), state0.slice(), state0.slice(), state0.slice(), state0.slice() ]\n}\n\nvar proto = FilteredVector.prototype\n\nproto.flush = function(t) {\n  var idx = bsearch.gt(this._time, t) - 1\n  if(idx <= 0) {\n    return\n  }\n  this._time.splice(0, idx)\n  this._state.splice(0, idx * this.dimension)\n  this._velocity.splice(0, idx * this.dimension)\n}\n\nproto.curve = function(t) {\n  var time      = this._time\n  var n         = time.length\n  var idx       = bsearch.le(time, t)\n  var result    = this._scratch[0]\n  var state     = this._state\n  var velocity  = this._velocity\n  var d         = this.dimension\n  var bounds    = this.bounds\n  if(idx < 0) {\n    var ptr = d-1\n    for(var i=0; i<d; ++i, --ptr) {\n      result[i] = state[ptr]\n    }\n  } else if(idx >= n-1) {\n    var ptr = state.length-1\n    var tf = t - time[n-1]\n    for(var i=0; i<d; ++i, --ptr) {\n      result[i] = state[ptr] + tf * velocity[ptr]\n    }\n  } else {\n    var ptr = d * (idx+1) - 1\n    var t0  = time[idx]\n    var t1  = time[idx+1]\n    var dt  = (t1 - t0) || 1.0\n    var x0  = this._scratch[1]\n    var x1  = this._scratch[2]\n    var v0  = this._scratch[3]\n    var v1  = this._scratch[4]\n    var steady = true\n    for(var i=0; i<d; ++i, --ptr) {\n      x0[i] = state[ptr]\n      v0[i] = velocity[ptr] * dt\n      x1[i] = state[ptr+d]\n      v1[i] = velocity[ptr+d] * dt\n      steady = steady && (x0[i] === x1[i] && v0[i] === v1[i] && v0[i] === 0.0)\n    }\n    if(steady) {\n      for(var i=0; i<d; ++i) {\n        result[i] = x0[i]\n      }\n    } else {\n      cubicHermite(x0, v0, x1, v1, (t-t0)/dt, result)\n    }\n  }\n  var lo = bounds[0]\n  var hi = bounds[1]\n  for(var i=0; i<d; ++i) {\n    result[i] = clamp(lo[i], hi[i], result[i])\n  }\n  return result\n}\n\nproto.dcurve = function(t) {\n  var time     = this._time\n  var n        = time.length\n  var idx      = bsearch.le(time, t)\n  var result   = this._scratch[0]\n  var state    = this._state\n  var velocity = this._velocity\n  var d        = this.dimension\n  if(idx >= n-1) {\n    var ptr = state.length-1\n    var tf = t - time[n-1]\n    for(var i=0; i<d; ++i, --ptr) {\n      result[i] = velocity[ptr]\n    }\n  } else {\n    var ptr = d * (idx+1) - 1\n    var t0 = time[idx]\n    var t1 = time[idx+1]\n    var dt = (t1 - t0) || 1.0\n    var x0 = this._scratch[1]\n    var x1 = this._scratch[2]\n    var v0 = this._scratch[3]\n    var v1 = this._scratch[4]\n    var steady = true\n    for(var i=0; i<d; ++i, --ptr) {\n      x0[i] = state[ptr]\n      v0[i] = velocity[ptr] * dt\n      x1[i] = state[ptr+d]\n      v1[i] = velocity[ptr+d] * dt\n      steady = steady && (x0[i] === x1[i] && v0[i] === v1[i] && v0[i] === 0.0)\n    }\n    if(steady) {\n      for(var i=0; i<d; ++i) {\n        result[i] = 0.0\n      }\n    } else {\n      cubicHermite.derivative(x0, v0, x1, v1, (t-t0)/dt, result)\n      for(var i=0; i<d; ++i) {\n        result[i] /= dt\n      }\n    }\n  }\n  return result\n}\n\nproto.lastT = function() {\n  var time = this._time\n  return time[time.length-1]\n}\n\nproto.stable = function() {\n  var velocity = this._velocity\n  var ptr = velocity.length\n  for(var i=this.dimension-1; i>=0; --i) {\n    if(velocity[--ptr]) {\n      return false\n    }\n  }\n  return true\n}\n\nproto.jump = function(t) {\n  var t0 = this.lastT()\n  var d  = this.dimension\n  if(t < t0 || arguments.length !== d+1) {\n    return\n  }\n  var state     = this._state\n  var velocity  = this._velocity\n  var ptr       = state.length-this.dimension\n  var bounds    = this.bounds\n  var lo        = bounds[0]\n  var hi        = bounds[1]\n  this._time.push(t0, t)\n  for(var j=0; j<2; ++j) {\n    for(var i=0; i<d; ++i) {\n      state.push(state[ptr++])\n      velocity.push(0)\n    }\n  }\n  this._time.push(t)\n  for(var i=d; i>0; --i) {\n    state.push(clamp(lo[i-1], hi[i-1], arguments[i]))\n    velocity.push(0)\n  }\n}\n\nproto.push = function(t) {\n  var t0 = this.lastT()\n  var d  = this.dimension\n  if(t < t0 || arguments.length !== d+1) {\n    return\n  }\n  var state     = this._state\n  var velocity  = this._velocity\n  var ptr       = state.length-this.dimension\n  var dt        = t - t0\n  var bounds    = this.bounds\n  var lo        = bounds[0]\n  var hi        = bounds[1]\n  var sf        = (dt > 1e-6) ? 1/dt : 0\n  this._time.push(t)\n  for(var i=d; i>0; --i) {\n    var xc = clamp(lo[i-1], hi[i-1], arguments[i])\n    state.push(xc)\n    velocity.push((xc - state[ptr++]) * sf)\n  }\n}\n\nproto.set = function(t) {\n  var d = this.dimension\n  if(t < this.lastT() || arguments.length !== d+1) {\n    return\n  }\n  var state     = this._state\n  var velocity  = this._velocity\n  var bounds    = this.bounds\n  var lo        = bounds[0]\n  var hi        = bounds[1]\n  this._time.push(t)\n  for(var i=d; i>0; --i) {\n    state.push(clamp(lo[i-1], hi[i-1], arguments[i]))\n    velocity.push(0)\n  }\n}\n\nproto.move = function(t) {\n  var t0 = this.lastT()\n  var d  = this.dimension\n  if(t <= t0 || arguments.length !== d+1) {\n    return\n  }\n  var state    = this._state\n  var velocity = this._velocity\n  var statePtr = state.length - this.dimension\n  var bounds   = this.bounds\n  var lo       = bounds[0]\n  var hi       = bounds[1]\n  var dt       = t - t0\n  var sf       = (dt > 1e-6) ? 1/dt : 0.0\n  this._time.push(t)\n  for(var i=d; i>0; --i) {\n    var dx = arguments[i]\n    state.push(clamp(lo[i-1], hi[i-1], state[statePtr++] + dx))\n    velocity.push(dx * sf)\n  }\n}\n\nproto.idle = function(t) {\n  var t0 = this.lastT()\n  if(t < t0) {\n    return\n  }\n  var d        = this.dimension\n  var state    = this._state\n  var velocity = this._velocity\n  var statePtr = state.length-d\n  var bounds   = this.bounds\n  var lo       = bounds[0]\n  var hi       = bounds[1]\n  var dt       = t - t0\n  this._time.push(t)\n  for(var i=d-1; i>=0; --i) {\n    state.push(clamp(lo[i], hi[i], state[statePtr] + dt * velocity[statePtr]))\n    velocity.push(0)\n    statePtr += 1\n  }\n}\n\nfunction getZero(d) {\n  var result = new Array(d)\n  for(var i=0; i<d; ++i) {\n    result[i] = 0.0\n  }\n  return result\n}\n\nfunction createFilteredVector(initState, initVelocity, initTime) {\n  switch(arguments.length) {\n    case 0:\n      return new FilteredVector([0], [0], 0)\n    case 1:\n      if(typeof initState === 'number') {\n        var zero = getZero(initState)\n        return new FilteredVector(zero, zero, 0)\n      } else {\n        return new FilteredVector(initState, getZero(initState.length), 0)\n      }\n    case 2:\n      if(typeof initVelocity === 'number') {\n        var zero = getZero(initState.length)\n        return new FilteredVector(initState, zero, +initVelocity)\n      } else {\n        initTime = 0\n      }\n    case 3:\n      if(initState.length !== initVelocity.length) {\n        throw new Error('state and velocity lengths must match')\n      }\n      return new FilteredVector(initState, initVelocity, initTime)\n  }\n}\n"]},"metadata":{},"sourceType":"script"}