{"ast":null,"code":"'use strict';\n\nvar Registry = require('../../registry');\n\nvar Lib = require('../../lib');\n\nvar getTraceColor = require('../scatter/get_trace_color');\n\nfunction hoverPoints(pointData, xval, yval, hovermode) {\n  var cd = pointData.cd;\n  var stash = cd[0].t;\n  var trace = cd[0].trace;\n  var xa = pointData.xa;\n  var ya = pointData.ya;\n  var x = stash.x;\n  var y = stash.y;\n  var xpx = xa.c2p(xval);\n  var ypx = ya.c2p(yval);\n  var maxDistance = pointData.distance;\n  var ids; // FIXME: make sure this is a proper way to calc search radius\n\n  if (stash.tree) {\n    var xl = xa.p2c(xpx - maxDistance);\n    var xr = xa.p2c(xpx + maxDistance);\n    var yl = ya.p2c(ypx - maxDistance);\n    var yr = ya.p2c(ypx + maxDistance);\n\n    if (hovermode === 'x') {\n      ids = stash.tree.range(Math.min(xl, xr), Math.min(ya._rl[0], ya._rl[1]), Math.max(xl, xr), Math.max(ya._rl[0], ya._rl[1]));\n    } else {\n      ids = stash.tree.range(Math.min(xl, xr), Math.min(yl, yr), Math.max(xl, xr), Math.max(yl, yr));\n    }\n  } else {\n    ids = stash.ids;\n  } // pick the id closest to the point\n  // note that point possibly may not be found\n\n\n  var k, closestId, ptx, pty, i, dx, dy, dist, dxy;\n  var minDist = maxDistance;\n\n  if (hovermode === 'x') {\n    var xPeriod = !!trace.xperiodalignment;\n    var yPeriod = !!trace.yperiodalignment;\n\n    for (i = 0; i < ids.length; i++) {\n      k = ids[i];\n      ptx = x[k];\n      dx = Math.abs(xa.c2p(ptx) - xpx);\n\n      if (xPeriod) {\n        var x0 = xa.c2p(trace._xStarts[k]);\n        var x1 = xa.c2p(trace._xEnds[k]);\n        dx = xpx >= Math.min(x0, x1) && xpx <= Math.max(x0, x1) ? 0 : Infinity;\n      }\n\n      if (dx < minDist) {\n        minDist = dx;\n        pty = y[k];\n        dy = ya.c2p(pty) - ypx;\n\n        if (yPeriod) {\n          var y0 = ya.c2p(trace._yStarts[k]);\n          var y1 = ya.c2p(trace._yEnds[k]);\n          dy = ypx >= Math.min(y0, y1) && ypx <= Math.max(y0, y1) ? 0 : Infinity;\n        }\n\n        dxy = Math.sqrt(dx * dx + dy * dy);\n        closestId = ids[i];\n      }\n    }\n  } else {\n    for (i = ids.length - 1; i > -1; i--) {\n      k = ids[i];\n      ptx = x[k];\n      pty = y[k];\n      dx = xa.c2p(ptx) - xpx;\n      dy = ya.c2p(pty) - ypx;\n      dist = Math.sqrt(dx * dx + dy * dy);\n\n      if (dist < minDist) {\n        minDist = dxy = dist;\n        closestId = k;\n      }\n    }\n  }\n\n  pointData.index = closestId;\n  pointData.distance = minDist;\n  pointData.dxy = dxy;\n  if (closestId === undefined) return [pointData];\n  return [calcHover(pointData, x, y, trace)];\n}\n\nfunction calcHover(pointData, x, y, trace) {\n  var xa = pointData.xa;\n  var ya = pointData.ya;\n  var minDist = pointData.distance;\n  var dxy = pointData.dxy;\n  var id = pointData.index; // the closest data point\n\n  var di = {\n    pointNumber: id,\n    x: x[id],\n    y: y[id]\n  }; // that is single-item arrays_to_calcdata excerpt, since we are doing it for a single point and we don't have to do it beforehead for 1e6 points\n\n  di.tx = Array.isArray(trace.text) ? trace.text[id] : trace.text;\n  di.htx = Array.isArray(trace.hovertext) ? trace.hovertext[id] : trace.hovertext;\n  di.data = Array.isArray(trace.customdata) ? trace.customdata[id] : trace.customdata;\n  di.tp = Array.isArray(trace.textposition) ? trace.textposition[id] : trace.textposition;\n  var font = trace.textfont;\n\n  if (font) {\n    di.ts = Lib.isArrayOrTypedArray(font.size) ? font.size[id] : font.size;\n    di.tc = Array.isArray(font.color) ? font.color[id] : font.color;\n    di.tf = Array.isArray(font.family) ? font.family[id] : font.family;\n  }\n\n  var marker = trace.marker;\n\n  if (marker) {\n    di.ms = Lib.isArrayOrTypedArray(marker.size) ? marker.size[id] : marker.size;\n    di.mo = Lib.isArrayOrTypedArray(marker.opacity) ? marker.opacity[id] : marker.opacity;\n    di.mx = Lib.isArrayOrTypedArray(marker.symbol) ? marker.symbol[id] : marker.symbol;\n    di.mc = Lib.isArrayOrTypedArray(marker.color) ? marker.color[id] : marker.color;\n  }\n\n  var line = marker && marker.line;\n\n  if (line) {\n    di.mlc = Array.isArray(line.color) ? line.color[id] : line.color;\n    di.mlw = Lib.isArrayOrTypedArray(line.width) ? line.width[id] : line.width;\n  }\n\n  var grad = marker && marker.gradient;\n\n  if (grad && grad.type !== 'none') {\n    di.mgt = Array.isArray(grad.type) ? grad.type[id] : grad.type;\n    di.mgc = Array.isArray(grad.color) ? grad.color[id] : grad.color;\n  }\n\n  var xp = xa.c2p(di.x, true);\n  var yp = ya.c2p(di.y, true);\n  var rad = di.mrc || 1;\n  var hoverlabel = trace.hoverlabel;\n\n  if (hoverlabel) {\n    di.hbg = Array.isArray(hoverlabel.bgcolor) ? hoverlabel.bgcolor[id] : hoverlabel.bgcolor;\n    di.hbc = Array.isArray(hoverlabel.bordercolor) ? hoverlabel.bordercolor[id] : hoverlabel.bordercolor;\n    di.hts = Lib.isArrayOrTypedArray(hoverlabel.font.size) ? hoverlabel.font.size[id] : hoverlabel.font.size;\n    di.htc = Array.isArray(hoverlabel.font.color) ? hoverlabel.font.color[id] : hoverlabel.font.color;\n    di.htf = Array.isArray(hoverlabel.font.family) ? hoverlabel.font.family[id] : hoverlabel.font.family;\n    di.hnl = Lib.isArrayOrTypedArray(hoverlabel.namelength) ? hoverlabel.namelength[id] : hoverlabel.namelength;\n  }\n\n  var hoverinfo = trace.hoverinfo;\n\n  if (hoverinfo) {\n    di.hi = Array.isArray(hoverinfo) ? hoverinfo[id] : hoverinfo;\n  }\n\n  var hovertemplate = trace.hovertemplate;\n\n  if (hovertemplate) {\n    di.ht = Array.isArray(hovertemplate) ? hovertemplate[id] : hovertemplate;\n  }\n\n  var fakeCd = {};\n  fakeCd[pointData.index] = di;\n  var origX = trace._origX;\n  var origY = trace._origY;\n  var pointData2 = Lib.extendFlat({}, pointData, {\n    color: getTraceColor(trace, di),\n    x0: xp - rad,\n    x1: xp + rad,\n    xLabelVal: origX ? origX[id] : di.x,\n    y0: yp - rad,\n    y1: yp + rad,\n    yLabelVal: origY ? origY[id] : di.y,\n    cd: fakeCd,\n    distance: minDist,\n    spikeDistance: dxy,\n    hovertemplate: di.ht\n  });\n  if (di.htx) pointData2.text = di.htx;else if (di.tx) pointData2.text = di.tx;else if (trace.text) pointData2.text = trace.text;\n  Lib.fillText(di, trace, pointData2);\n  Registry.getComponentMethod('errorbars', 'hoverInfo')(di, trace, pointData2);\n  return pointData2;\n}\n\nmodule.exports = {\n  hoverPoints: hoverPoints,\n  calcHover: calcHover\n};","map":{"version":3,"sources":["C:/Projects/reactApp/frontend/node_modules/plotly.js/src/traces/scattergl/hover.js"],"names":["Registry","require","Lib","getTraceColor","hoverPoints","pointData","xval","yval","hovermode","cd","stash","t","trace","xa","ya","x","y","xpx","c2p","ypx","maxDistance","distance","ids","tree","xl","p2c","xr","yl","yr","range","Math","min","_rl","max","k","closestId","ptx","pty","i","dx","dy","dist","dxy","minDist","xPeriod","xperiodalignment","yPeriod","yperiodalignment","length","abs","x0","_xStarts","x1","_xEnds","Infinity","y0","_yStarts","y1","_yEnds","sqrt","index","undefined","calcHover","id","di","pointNumber","tx","Array","isArray","text","htx","hovertext","data","customdata","tp","textposition","font","textfont","ts","isArrayOrTypedArray","size","tc","color","tf","family","marker","ms","mo","opacity","mx","symbol","mc","line","mlc","mlw","width","grad","gradient","type","mgt","mgc","xp","yp","rad","mrc","hoverlabel","hbg","bgcolor","hbc","bordercolor","hts","htc","htf","hnl","namelength","hoverinfo","hi","hovertemplate","ht","fakeCd","origX","_origX","origY","_origY","pointData2","extendFlat","xLabelVal","yLabelVal","spikeDistance","fillText","getComponentMethod","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar getTraceColor = require('../scatter/get_trace_color');\n\nfunction hoverPoints(pointData, xval, yval, hovermode) {\n    var cd = pointData.cd;\n    var stash = cd[0].t;\n    var trace = cd[0].trace;\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n    var x = stash.x;\n    var y = stash.y;\n    var xpx = xa.c2p(xval);\n    var ypx = ya.c2p(yval);\n    var maxDistance = pointData.distance;\n    var ids;\n\n    // FIXME: make sure this is a proper way to calc search radius\n    if(stash.tree) {\n        var xl = xa.p2c(xpx - maxDistance);\n        var xr = xa.p2c(xpx + maxDistance);\n        var yl = ya.p2c(ypx - maxDistance);\n        var yr = ya.p2c(ypx + maxDistance);\n\n        if(hovermode === 'x') {\n            ids = stash.tree.range(\n                Math.min(xl, xr), Math.min(ya._rl[0], ya._rl[1]),\n                Math.max(xl, xr), Math.max(ya._rl[0], ya._rl[1])\n            );\n        } else {\n            ids = stash.tree.range(\n                Math.min(xl, xr), Math.min(yl, yr),\n                Math.max(xl, xr), Math.max(yl, yr)\n            );\n        }\n    } else {\n        ids = stash.ids;\n    }\n\n    // pick the id closest to the point\n    // note that point possibly may not be found\n    var k, closestId, ptx, pty, i, dx, dy, dist, dxy;\n\n    var minDist = maxDistance;\n    if(hovermode === 'x') {\n        var xPeriod = !!trace.xperiodalignment;\n        var yPeriod = !!trace.yperiodalignment;\n\n        for(i = 0; i < ids.length; i++) {\n            k = ids[i];\n            ptx = x[k];\n\n            dx = Math.abs(xa.c2p(ptx) - xpx);\n            if(xPeriod) {\n                var x0 = xa.c2p(trace._xStarts[k]);\n                var x1 = xa.c2p(trace._xEnds[k]);\n\n                dx = (\n                    xpx >= Math.min(x0, x1) &&\n                    xpx <= Math.max(x0, x1)\n                ) ? 0 : Infinity;\n            }\n\n            if(dx < minDist) {\n                minDist = dx;\n                pty = y[k];\n                dy = ya.c2p(pty) - ypx;\n\n                if(yPeriod) {\n                    var y0 = ya.c2p(trace._yStarts[k]);\n                    var y1 = ya.c2p(trace._yEnds[k]);\n\n                    dy = (\n                        ypx >= Math.min(y0, y1) &&\n                        ypx <= Math.max(y0, y1)\n                    ) ? 0 : Infinity;\n                }\n\n                dxy = Math.sqrt(dx * dx + dy * dy);\n                closestId = ids[i];\n            }\n        }\n    } else {\n        for(i = ids.length - 1; i > -1; i--) {\n            k = ids[i];\n            ptx = x[k];\n            pty = y[k];\n            dx = xa.c2p(ptx) - xpx;\n            dy = ya.c2p(pty) - ypx;\n\n            dist = Math.sqrt(dx * dx + dy * dy);\n            if(dist < minDist) {\n                minDist = dxy = dist;\n                closestId = k;\n            }\n        }\n    }\n\n    pointData.index = closestId;\n    pointData.distance = minDist;\n    pointData.dxy = dxy;\n\n    if(closestId === undefined) return [pointData];\n\n    return [calcHover(pointData, x, y, trace)];\n}\n\nfunction calcHover(pointData, x, y, trace) {\n    var xa = pointData.xa;\n    var ya = pointData.ya;\n    var minDist = pointData.distance;\n    var dxy = pointData.dxy;\n    var id = pointData.index;\n\n    // the closest data point\n    var di = {\n        pointNumber: id,\n        x: x[id],\n        y: y[id]\n    };\n\n    // that is single-item arrays_to_calcdata excerpt, since we are doing it for a single point and we don't have to do it beforehead for 1e6 points\n    di.tx = Array.isArray(trace.text) ? trace.text[id] : trace.text;\n    di.htx = Array.isArray(trace.hovertext) ? trace.hovertext[id] : trace.hovertext;\n    di.data = Array.isArray(trace.customdata) ? trace.customdata[id] : trace.customdata;\n    di.tp = Array.isArray(trace.textposition) ? trace.textposition[id] : trace.textposition;\n\n    var font = trace.textfont;\n    if(font) {\n        di.ts = Lib.isArrayOrTypedArray(font.size) ? font.size[id] : font.size;\n        di.tc = Array.isArray(font.color) ? font.color[id] : font.color;\n        di.tf = Array.isArray(font.family) ? font.family[id] : font.family;\n    }\n\n    var marker = trace.marker;\n    if(marker) {\n        di.ms = Lib.isArrayOrTypedArray(marker.size) ? marker.size[id] : marker.size;\n        di.mo = Lib.isArrayOrTypedArray(marker.opacity) ? marker.opacity[id] : marker.opacity;\n        di.mx = Lib.isArrayOrTypedArray(marker.symbol) ? marker.symbol[id] : marker.symbol;\n        di.mc = Lib.isArrayOrTypedArray(marker.color) ? marker.color[id] : marker.color;\n    }\n\n    var line = marker && marker.line;\n    if(line) {\n        di.mlc = Array.isArray(line.color) ? line.color[id] : line.color;\n        di.mlw = Lib.isArrayOrTypedArray(line.width) ? line.width[id] : line.width;\n    }\n\n    var grad = marker && marker.gradient;\n    if(grad && grad.type !== 'none') {\n        di.mgt = Array.isArray(grad.type) ? grad.type[id] : grad.type;\n        di.mgc = Array.isArray(grad.color) ? grad.color[id] : grad.color;\n    }\n\n    var xp = xa.c2p(di.x, true);\n    var yp = ya.c2p(di.y, true);\n    var rad = di.mrc || 1;\n\n    var hoverlabel = trace.hoverlabel;\n\n    if(hoverlabel) {\n        di.hbg = Array.isArray(hoverlabel.bgcolor) ? hoverlabel.bgcolor[id] : hoverlabel.bgcolor;\n        di.hbc = Array.isArray(hoverlabel.bordercolor) ? hoverlabel.bordercolor[id] : hoverlabel.bordercolor;\n        di.hts = Lib.isArrayOrTypedArray(hoverlabel.font.size) ? hoverlabel.font.size[id] : hoverlabel.font.size;\n        di.htc = Array.isArray(hoverlabel.font.color) ? hoverlabel.font.color[id] : hoverlabel.font.color;\n        di.htf = Array.isArray(hoverlabel.font.family) ? hoverlabel.font.family[id] : hoverlabel.font.family;\n        di.hnl = Lib.isArrayOrTypedArray(hoverlabel.namelength) ? hoverlabel.namelength[id] : hoverlabel.namelength;\n    }\n    var hoverinfo = trace.hoverinfo;\n    if(hoverinfo) {\n        di.hi = Array.isArray(hoverinfo) ? hoverinfo[id] : hoverinfo;\n    }\n\n    var hovertemplate = trace.hovertemplate;\n    if(hovertemplate) {\n        di.ht = Array.isArray(hovertemplate) ? hovertemplate[id] : hovertemplate;\n    }\n\n    var fakeCd = {};\n    fakeCd[pointData.index] = di;\n\n    var origX = trace._origX;\n    var origY = trace._origY;\n\n    var pointData2 = Lib.extendFlat({}, pointData, {\n        color: getTraceColor(trace, di),\n\n        x0: xp - rad,\n        x1: xp + rad,\n        xLabelVal: origX ? origX[id] : di.x,\n\n        y0: yp - rad,\n        y1: yp + rad,\n        yLabelVal: origY ? origY[id] : di.y,\n\n        cd: fakeCd,\n        distance: minDist,\n        spikeDistance: dxy,\n\n        hovertemplate: di.ht\n    });\n\n    if(di.htx) pointData2.text = di.htx;\n    else if(di.tx) pointData2.text = di.tx;\n    else if(trace.text) pointData2.text = trace.text;\n\n    Lib.fillText(di, trace, pointData2);\n    Registry.getComponentMethod('errorbars', 'hoverInfo')(di, trace, pointData2);\n\n    return pointData2;\n}\n\nmodule.exports = {\n    hoverPoints: hoverPoints,\n    calcHover: calcHover\n};\n"]},"metadata":{},"sourceType":"script"}