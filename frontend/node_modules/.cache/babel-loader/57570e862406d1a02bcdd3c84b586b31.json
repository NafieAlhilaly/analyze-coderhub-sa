{"ast":null,"code":"'use strict';\n\nvar dup = require('dup');\n\nvar CACHED_CWiseOp = {\n  zero: function (SS, a0, t0, p0) {\n    var s0 = SS[0],\n        t0p0 = t0[0];\n    p0 |= 0;\n    var i0 = 0,\n        d0s0 = t0p0;\n\n    for (i0 = 0; i0 < s0; ++i0) {\n      a0[p0] = 0;\n      p0 += d0s0;\n    }\n  },\n  fdTemplate1: function (SS, a0, t0, p0, a1, t1, p1) {\n    var s0 = SS[0],\n        t0p0 = t0[0],\n        t1p0 = t1[0],\n        q0 = -1 * t0p0,\n        q1 = t0p0;\n    p0 |= 0;\n    p1 |= 0;\n    var i0 = 0,\n        d0s0 = t0p0,\n        d1s0 = t1p0;\n\n    for (i0 = 0; i0 < s0; ++i0) {\n      a1[p1] = 0.5 * (a0[p0 + q0] - a0[p0 + q1]);\n      p0 += d0s0;\n      p1 += d1s0;\n    }\n  },\n  fdTemplate2: function (SS, a0, t0, p0, a1, t1, p1, a2, t2, p2) {\n    var s0 = SS[0],\n        s1 = SS[1],\n        t0p0 = t0[0],\n        t0p1 = t0[1],\n        t1p0 = t1[0],\n        t1p1 = t1[1],\n        t2p0 = t2[0],\n        t2p1 = t2[1],\n        q0 = -1 * t0p0,\n        q1 = t0p0,\n        q2 = -1 * t0p1,\n        q3 = t0p1;\n    p0 |= 0;\n    p1 |= 0;\n    p2 |= 0;\n    var i0 = 0,\n        i1 = 0,\n        d0s0 = t0p1,\n        d0s1 = t0p0 - s1 * t0p1,\n        d1s0 = t1p1,\n        d1s1 = t1p0 - s1 * t1p1,\n        d2s0 = t2p1,\n        d2s1 = t2p0 - s1 * t2p1;\n\n    for (i1 = 0; i1 < s0; ++i1) {\n      for (i0 = 0; i0 < s1; ++i0) {\n        a1[p1] = 0.5 * (a0[p0 + q0] - a0[p0 + q1]);\n        a2[p2] = 0.5 * (a0[p0 + q2] - a0[p0 + q3]);\n        p0 += d0s0;\n        p1 += d1s0;\n        p2 += d2s0;\n      }\n\n      p0 += d0s1;\n      p1 += d1s1;\n      p2 += d2s1;\n    }\n  }\n};\nvar CACHED_thunk = {\n  cdiff: function (compile) {\n    var CACHED = {};\n    return function cdiff_cwise_thunk(array0, array1, array2) {\n      var t0 = array0.dtype,\n          r0 = array0.order,\n          t1 = array1.dtype,\n          r1 = array1.order,\n          t2 = array2.dtype,\n          r2 = array2.order,\n          type = [t0, r0.join(), t1, r1.join(), t2, r2.join()].join(),\n          proc = CACHED[type];\n\n      if (!proc) {\n        CACHED[type] = proc = compile([t0, r0, t1, r1, t2, r2]);\n      }\n\n      return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0, array1.data, array1.stride, array1.offset | 0, array2.data, array2.stride, array2.offset | 0);\n    };\n  },\n  zero: function (compile) {\n    var CACHED = {};\n    return function zero_cwise_thunk(array0) {\n      var t0 = array0.dtype,\n          r0 = array0.order,\n          type = [t0, r0.join()].join(),\n          proc = CACHED[type];\n\n      if (!proc) {\n        CACHED[type] = proc = compile([t0, r0]);\n      }\n\n      return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0);\n    };\n  },\n  fdTemplate1: function (compile) {\n    var CACHED = {};\n    return function fdTemplate1_cwise_thunk(array0, array1) {\n      var t0 = array0.dtype,\n          r0 = array0.order,\n          t1 = array1.dtype,\n          r1 = array1.order,\n          type = [t0, r0.join(), t1, r1.join()].join(),\n          proc = CACHED[type];\n\n      if (!proc) {\n        CACHED[type] = proc = compile([t0, r0, t1, r1]);\n      }\n\n      return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0, array1.data, array1.stride, array1.offset | 0);\n    };\n  },\n  fdTemplate2: function (compile) {\n    var CACHED = {};\n    return function fdTemplate2_cwise_thunk(array0, array1, array4) {\n      var t0 = array0.dtype,\n          r0 = array0.order,\n          t1 = array1.dtype,\n          r1 = array1.order,\n          t4 = array4.dtype,\n          r4 = array4.order,\n          type = [t0, r0.join(), t1, r1.join(), t4, r4.join()].join(),\n          proc = CACHED[type];\n\n      if (!proc) {\n        CACHED[type] = proc = compile([t0, r0, t1, r1, t4, r4]);\n      }\n\n      return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0, array1.data, array1.stride, array1.offset | 0, array4.data, array4.stride, array4.offset | 0);\n    };\n  }\n};\n\nfunction createThunk(proc) {\n  var thunk = CACHED_thunk[proc.funcName];\n  return thunk(compile.bind(undefined, proc));\n}\n\nfunction compile(proc) {\n  return CACHED_CWiseOp[proc.funcName];\n}\n\nfunction cwiseCompiler(user_args) {\n  return createThunk({\n    funcName: user_args.funcName\n  });\n}\n\nvar TEMPLATE_CACHE = {};\nvar GRADIENT_CACHE = {};\nvar EmptyProc = {\n  body: \"\",\n  args: [],\n  thisVars: [],\n  localVars: []\n};\nvar centralDiff = cwiseCompiler({\n  funcName: 'cdiff'\n});\nvar zeroOut = cwiseCompiler({\n  funcName: 'zero'\n});\n\nfunction generateTemplate(d) {\n  if (d in TEMPLATE_CACHE) {\n    return TEMPLATE_CACHE[d];\n  }\n\n  return TEMPLATE_CACHE[d] = cwiseCompiler({\n    funcName: 'fdTemplate' + d\n  });\n}\n\nfunction CACHED_link(diff, zero, grad1, grad2) {\n  return function (dst, src) {\n    var s = src.shape.slice();\n\n    if (1 && s[0] > 2 && s[1] > 2) {\n      grad2(src.pick(-1, -1).lo(1, 1).hi(s[0] - 2, s[1] - 2), dst.pick(-1, -1, 0).lo(1, 1).hi(s[0] - 2, s[1] - 2), dst.pick(-1, -1, 1).lo(1, 1).hi(s[0] - 2, s[1] - 2));\n    }\n\n    if (1 && s[1] > 2) {\n      grad1(src.pick(0, -1).lo(1).hi(s[1] - 2), dst.pick(0, -1, 1).lo(1).hi(s[1] - 2));\n      zero(dst.pick(0, -1, 0).lo(1).hi(s[1] - 2));\n    }\n\n    if (1 && s[1] > 2) {\n      grad1(src.pick(s[0] - 1, -1).lo(1).hi(s[1] - 2), dst.pick(s[0] - 1, -1, 1).lo(1).hi(s[1] - 2));\n      zero(dst.pick(s[0] - 1, -1, 0).lo(1).hi(s[1] - 2));\n    }\n\n    if (1 && s[0] > 2) {\n      grad1(src.pick(-1, 0).lo(1).hi(s[0] - 2), dst.pick(-1, 0, 0).lo(1).hi(s[0] - 2));\n      zero(dst.pick(-1, 0, 1).lo(1).hi(s[0] - 2));\n    }\n\n    if (1 && s[0] > 2) {\n      grad1(src.pick(-1, s[1] - 1).lo(1).hi(s[0] - 2), dst.pick(-1, s[1] - 1, 0).lo(1).hi(s[0] - 2));\n      zero(dst.pick(-1, s[1] - 1, 1).lo(1).hi(s[0] - 2));\n    }\n\n    dst.set(0, 0, 0, 0);\n    dst.set(0, 0, 1, 0);\n    dst.set(s[0] - 1, 0, 0, 0);\n    dst.set(s[0] - 1, 0, 1, 0);\n    dst.set(0, s[1] - 1, 0, 0);\n    dst.set(0, s[1] - 1, 1, 0);\n    dst.set(s[0] - 1, s[1] - 1, 0, 0);\n    dst.set(s[0] - 1, s[1] - 1, 1, 0);\n    return dst;\n  };\n}\n\nfunction generateGradient(boundaryConditions) {\n  var token = boundaryConditions.join();\n  var proc = GRADIENT_CACHE[token];\n\n  if (proc) {\n    return proc;\n  }\n\n  var d = boundaryConditions.length;\n  var linkArgs = [centralDiff, zeroOut];\n\n  for (var i = 1; i <= d; ++i) {\n    linkArgs.push(generateTemplate(i));\n  }\n\n  var link = CACHED_link;\n  var proc = link.apply(void 0, linkArgs);\n  GRADIENT_CACHE[token] = proc;\n  return proc;\n}\n\nmodule.exports = function gradient(out, inp, bc) {\n  if (!Array.isArray(bc)) {\n    if (typeof bc === 'string') {\n      bc = dup(inp.dimension, bc);\n    } else {\n      bc = dup(inp.dimension, 'clamp');\n    }\n  }\n\n  if (inp.size === 0) {\n    return out;\n  }\n\n  if (inp.dimension === 0) {\n    out.set(0);\n    return out;\n  }\n\n  var cached = generateGradient(bc);\n  return cached(out, inp);\n};","map":{"version":3,"sources":["C:/Projects/reactApp/frontend/node_modules/ndarray-gradient/fdg.js"],"names":["dup","require","CACHED_CWiseOp","zero","SS","a0","t0","p0","s0","t0p0","i0","d0s0","fdTemplate1","a1","t1","p1","t1p0","q0","q1","d1s0","fdTemplate2","a2","t2","p2","s1","t0p1","t1p1","t2p0","t2p1","q2","q3","i1","d0s1","d1s1","d2s0","d2s1","CACHED_thunk","cdiff","compile","CACHED","cdiff_cwise_thunk","array0","array1","array2","dtype","r0","order","r1","r2","type","join","proc","shape","slice","data","stride","offset","zero_cwise_thunk","fdTemplate1_cwise_thunk","fdTemplate2_cwise_thunk","array4","t4","r4","createThunk","thunk","funcName","bind","undefined","cwiseCompiler","user_args","TEMPLATE_CACHE","GRADIENT_CACHE","EmptyProc","body","args","thisVars","localVars","centralDiff","zeroOut","generateTemplate","d","CACHED_link","diff","grad1","grad2","dst","src","s","pick","lo","hi","set","generateGradient","boundaryConditions","token","length","linkArgs","i","push","link","apply","module","exports","gradient","out","inp","bc","Array","isArray","dimension","size","cached"],"mappings":"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","sourcesContent":["'use strict'\r\n\r\nvar dup = require('dup')\r\n\r\nvar CACHED_CWiseOp = {\r\n  zero: function(SS, a0, t0, p0) {\r\n      var s0 = SS[0], t0p0 = t0[0]\r\n      p0 |= 0\r\n      var i0 = 0, d0s0 = t0p0\r\n      for (i0 = 0; i0 < s0; ++i0) {\r\n        a0[p0] = 0\r\n        p0 += d0s0\r\n      }\r\n    },\r\n\r\n    fdTemplate1: function(SS, a0, t0, p0, a1, t1, p1) {\r\n    var s0 = SS[0], t0p0 = t0[0], t1p0 = t1[0], q0 = -1 * t0p0, q1 = t0p0\r\n    p0 |= 0\r\n    p1 |= 0\r\n    var i0 = 0, d0s0 = t0p0, d1s0 = t1p0\r\n    for (i0 = 0; i0 < s0; ++i0) {\r\n      a1[p1] = 0.5 * (a0[p0 + q0] - a0[p0 + q1])\r\n      p0 += d0s0\r\n      p1 += d1s0\r\n    }\r\n  },\r\n\r\n  fdTemplate2: function(SS, a0, t0, p0, a1, t1, p1, a2, t2, p2) {\r\n    var s0 = SS[0], s1 = SS[1], t0p0 = t0[0], t0p1 = t0[1], t1p0 = t1[0], t1p1 = t1[1], t2p0 = t2[0], t2p1 = t2[1], q0 = -1 * t0p0, q1 = t0p0, q2 = -1 * t0p1, q3 = t0p1\r\n    p0 |= 0\r\n    p1 |= 0\r\n    p2 |= 0\r\n    var i0 = 0, i1 = 0, d0s0 = t0p1, d0s1 = (t0p0 - s1 * t0p1), d1s0 = t1p1, d1s1 = (t1p0 - s1 * t1p1), d2s0 = t2p1, d2s1 = (t2p0 - s1 * t2p1)\r\n    for (i1 = 0; i1 < s0; ++i1) {\r\n      for (i0 = 0; i0 < s1; ++i0) {\r\n        a1[p1] = 0.5 * (a0[p0 + q0] - a0[p0 + q1]); a2[p2] = 0.5 * (a0[p0 + q2] - a0[p0 + q3])\r\n        p0 += d0s0\r\n        p1 += d1s0\r\n        p2 += d2s0\r\n      }\r\n      p0 += d0s1\r\n      p1 += d1s1\r\n      p2 += d2s1\r\n    }\r\n  }\r\n}\r\n\r\nvar CACHED_thunk = {\r\n  cdiff: function(compile) {\r\n    var CACHED = {}\r\n    return function cdiff_cwise_thunk(array0, array1, array2) {\r\n      var t0 = array0.dtype, r0 = array0.order, t1 = array1.dtype, r1 = array1.order, t2 = array2.dtype, r2 = array2.order, type = [t0, r0.join(), t1, r1.join(), t2, r2.join()].join(), proc = CACHED[type]\r\n      if (!proc) { CACHED[type] = proc = compile([t0, r0, t1, r1, t2, r2]) } return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0, array1.data, array1.stride, array1.offset | 0, array2.data, array2.stride, array2.offset | 0)\r\n    }\r\n  },\r\n\r\n  zero: function(compile) {\r\n    var CACHED = {}\r\n    return function zero_cwise_thunk(array0) {\r\n      var t0 = array0.dtype, r0 = array0.order, type = [t0, r0.join()].join(), proc = CACHED[type]\r\n      if (!proc) { CACHED[type] = proc = compile([t0, r0]) } return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0)\r\n    }\r\n  },\r\n\r\n  fdTemplate1: function(compile) {\r\n    var CACHED = {}\r\n    return function fdTemplate1_cwise_thunk(array0, array1) {\r\n      var t0 = array0.dtype, r0 = array0.order, t1 = array1.dtype, r1 = array1.order, type = [t0, r0.join(), t1, r1.join()].join(), proc = CACHED[type]\r\n      if (!proc) { CACHED[type] = proc = compile([t0, r0, t1, r1]) } return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0, array1.data, array1.stride, array1.offset | 0)\r\n    }\r\n  },\r\n\r\n  fdTemplate2: function(compile) {\r\n    var CACHED = {}\r\n    return function fdTemplate2_cwise_thunk(array0, array1, array4) {\r\n      var t0 = array0.dtype, r0 = array0.order, t1 = array1.dtype, r1 = array1.order, t4 = array4.dtype, r4 = array4.order, type = [t0, r0.join(), t1, r1.join(), t4, r4.join()].join(), proc = CACHED[type]\r\n      if (!proc) { CACHED[type] = proc = compile([t0, r0, t1, r1, t4, r4]) } return proc(array0.shape.slice(0), array0.data, array0.stride, array0.offset | 0, array1.data, array1.stride, array1.offset | 0, array4.data, array4.stride, array4.offset | 0)\r\n    }\r\n  },\r\n}\r\n\r\nfunction createThunk(proc) {\r\n  var thunk = CACHED_thunk[proc.funcName]\r\n  return thunk(compile.bind(undefined, proc))\r\n}\r\n\r\nfunction compile(proc) {\r\n  return CACHED_CWiseOp[proc.funcName]\r\n}\r\n\r\nfunction cwiseCompiler(user_args) {\r\n  return createThunk({\r\n    funcName: user_args.funcName\r\n  })\r\n}\r\n\r\n\r\nvar TEMPLATE_CACHE  = {}\r\nvar GRADIENT_CACHE  = {}\r\n\r\nvar EmptyProc = {\r\n  body: \"\",\r\n  args: [],\r\n  thisVars: [],\r\n  localVars: []\r\n}\r\n\r\nvar centralDiff = cwiseCompiler({\r\n  funcName: 'cdiff'\r\n})\r\n\r\nvar zeroOut = cwiseCompiler({\r\n  funcName: 'zero'\r\n})\r\n\r\nfunction generateTemplate(d) {\r\n  if(d in TEMPLATE_CACHE) {\r\n    return TEMPLATE_CACHE[d]\r\n  }\r\n  return TEMPLATE_CACHE[d] = cwiseCompiler({\r\n    funcName: 'fdTemplate' + d\r\n  })\r\n}\r\n\r\nfunction CACHED_link(diff, zero, grad1, grad2) {\r\n  return function(dst, src) {\r\n    var s = src.shape.slice()\r\n    if (1 && s[0] > 2 && s[1] > 2) {\r\n      grad2(\r\n        src\r\n          .pick(-1, -1)\r\n          .lo(1, 1)\r\n          .hi(s[0] - 2, s[1] - 2),\r\n        dst\r\n          .pick(-1, -1, 0)\r\n          .lo(1, 1)\r\n          .hi(s[0] - 2, s[1] - 2),\r\n        dst\r\n          .pick(-1, -1, 1)\r\n          .lo(1, 1)\r\n          .hi(s[0] - 2, s[1] - 2)\r\n      )\r\n    }\r\n    if (1 && s[1] > 2) {\r\n      grad1(\r\n        src\r\n          .pick(0, -1)\r\n          .lo(1)\r\n          .hi(s[1] - 2),\r\n        dst\r\n          .pick(0, -1, 1)\r\n          .lo(1)\r\n          .hi(s[1] - 2)\r\n      )\r\n      zero(\r\n        dst\r\n          .pick(0, -1, 0)\r\n          .lo(1)\r\n          .hi(s[1] - 2)\r\n      )\r\n    }\r\n    if (1 && s[1] > 2) {\r\n      grad1(\r\n        src\r\n          .pick(s[0] - 1, -1)\r\n          .lo(1)\r\n          .hi(s[1] - 2),\r\n        dst\r\n          .pick(s[0] - 1, -1, 1)\r\n          .lo(1)\r\n          .hi(s[1] - 2)\r\n      )\r\n      zero(\r\n        dst\r\n          .pick(s[0] - 1, -1, 0)\r\n          .lo(1)\r\n          .hi(s[1] - 2)\r\n      )\r\n    }\r\n    if (1 && s[0] > 2) {\r\n      grad1(\r\n        src\r\n          .pick(-1, 0)\r\n          .lo(1)\r\n          .hi(s[0] - 2),\r\n        dst\r\n          .pick(-1, 0, 0)\r\n          .lo(1)\r\n          .hi(s[0] - 2)\r\n      )\r\n      zero(\r\n        dst\r\n          .pick(-1, 0, 1)\r\n          .lo(1)\r\n          .hi(s[0] - 2)\r\n      )\r\n    }\r\n    if (1 && s[0] > 2) {\r\n      grad1(\r\n        src\r\n          .pick(-1, s[1] - 1)\r\n          .lo(1)\r\n          .hi(s[0] - 2),\r\n        dst\r\n          .pick(-1, s[1] - 1, 0)\r\n          .lo(1)\r\n          .hi(s[0] - 2)\r\n      )\r\n      zero(\r\n        dst\r\n          .pick(-1, s[1] - 1, 1)\r\n          .lo(1)\r\n          .hi(s[0] - 2)\r\n      )\r\n    }\r\n    dst.set(0, 0, 0, 0)\r\n    dst.set(0, 0, 1, 0)\r\n    dst.set(s[0] - 1, 0, 0, 0)\r\n    dst.set(s[0] - 1, 0, 1, 0)\r\n    dst.set(0, s[1] - 1, 0, 0)\r\n    dst.set(0, s[1] - 1, 1, 0)\r\n    dst.set(s[0] - 1, s[1] - 1, 0, 0)\r\n    dst.set(s[0] - 1, s[1] - 1, 1, 0)\r\n    return dst\r\n  }\r\n}\r\n\r\n\r\nfunction generateGradient(boundaryConditions) {\r\n  var token = boundaryConditions.join()\r\n  var proc = GRADIENT_CACHE[token]\r\n  if(proc) {\r\n    return proc\r\n  }\r\n\r\n  var d = boundaryConditions.length\r\n\r\n  var linkArgs  = [ centralDiff, zeroOut ]\r\n  for(var i=1; i<=d; ++i) {\r\n    linkArgs.push(generateTemplate(i))\r\n  }\r\n\r\n  var link = CACHED_link\r\n\r\n  var proc = link.apply(void 0, linkArgs)\r\n\r\n  GRADIENT_CACHE[token] = proc\r\n  return proc\r\n}\r\n\r\nmodule.exports = function gradient(out, inp, bc) {\r\n  if(!Array.isArray(bc)) {\r\n    if(typeof bc === 'string') {\r\n      bc = dup(inp.dimension, bc)\r\n    } else {\r\n      bc = dup(inp.dimension, 'clamp')\r\n    }\r\n  }\r\n  if(inp.size === 0) {\r\n    return out\r\n  }\r\n  if(inp.dimension === 0) {\r\n    out.set(0)\r\n    return out\r\n  }\r\n  var cached = generateGradient(bc)\r\n  return cached(out, inp)\r\n}"]},"metadata":{},"sourceType":"script"}