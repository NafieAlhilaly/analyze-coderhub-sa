{"ast":null,"code":"'use strict';\n\nvar c = require('./constants');\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../../lib');\n\nvar numberFormat = Lib.numberFormat;\n\nvar gup = require('../../lib/gup');\n\nvar Drawing = require('../../components/drawing');\n\nvar svgUtil = require('../../lib/svg_text_utils');\n\nvar raiseToTop = require('../../lib').raiseToTop;\n\nvar strTranslate = require('../../lib').strTranslate;\n\nvar cancelEeaseColumn = require('../../lib').cancelTransition;\n\nvar prepareData = require('./data_preparation_helper');\n\nvar splitData = require('./data_split_helpers');\n\nvar Color = require('../../components/color');\n\nmodule.exports = function plot(gd, wrappedTraceHolders) {\n  var dynamic = !gd._context.staticPlot;\n\n  var table = gd._fullLayout._paper.selectAll('.' + c.cn.table).data(wrappedTraceHolders.map(function (wrappedTraceHolder) {\n    var traceHolder = gup.unwrap(wrappedTraceHolder);\n    var trace = traceHolder.trace;\n    return prepareData(gd, trace);\n  }), gup.keyFun);\n\n  table.exit().remove();\n  table.enter().append('g').classed(c.cn.table, true).attr('overflow', 'visible').style('box-sizing', 'content-box').style('position', 'absolute').style('left', 0).style('overflow', 'visible').style('shape-rendering', 'crispEdges').style('pointer-events', 'all');\n  table.attr('width', function (d) {\n    return d.width + d.size.l + d.size.r;\n  }).attr('height', function (d) {\n    return d.height + d.size.t + d.size.b;\n  }).attr('transform', function (d) {\n    return strTranslate(d.translateX, d.translateY);\n  });\n  var tableControlView = table.selectAll('.' + c.cn.tableControlView).data(gup.repeat, gup.keyFun);\n  var cvEnter = tableControlView.enter().append('g').classed(c.cn.tableControlView, true).style('box-sizing', 'content-box');\n\n  if (dynamic) {\n    var wheelEvent = 'onwheel' in document ? 'wheel' : 'mousewheel';\n    cvEnter.on('mousemove', function (d) {\n      tableControlView.filter(function (dd) {\n        return d === dd;\n      }).call(renderScrollbarKit, gd);\n    }).on(wheelEvent, function (d) {\n      if (d.scrollbarState.wheeling) return;\n      d.scrollbarState.wheeling = true;\n      var newY = d.scrollY + d3.event.deltaY;\n      var noChange = makeDragRow(gd, tableControlView, null, newY)(d);\n\n      if (!noChange) {\n        d3.event.stopPropagation();\n        d3.event.preventDefault();\n      }\n\n      d.scrollbarState.wheeling = false;\n    }).call(renderScrollbarKit, gd, true);\n  }\n\n  tableControlView.attr('transform', function (d) {\n    return strTranslate(d.size.l, d.size.t);\n  }); // scrollBackground merely ensures that mouse events are captured even on crazy fast scrollwheeling\n  // otherwise rendering glitches may occur\n\n  var scrollBackground = tableControlView.selectAll('.' + c.cn.scrollBackground).data(gup.repeat, gup.keyFun);\n  scrollBackground.enter().append('rect').classed(c.cn.scrollBackground, true).attr('fill', 'none');\n  scrollBackground.attr('width', function (d) {\n    return d.width;\n  }).attr('height', function (d) {\n    return d.height;\n  });\n  tableControlView.each(function (d) {\n    Drawing.setClipUrl(d3.select(this), scrollAreaBottomClipKey(gd, d), gd);\n  });\n  var yColumn = tableControlView.selectAll('.' + c.cn.yColumn).data(function (vm) {\n    return vm.columns;\n  }, gup.keyFun);\n  yColumn.enter().append('g').classed(c.cn.yColumn, true);\n  yColumn.exit().remove();\n  yColumn.attr('transform', function (d) {\n    return strTranslate(d.x, 0);\n  });\n\n  if (dynamic) {\n    yColumn.call(d3.behavior.drag().origin(function (d) {\n      var movedColumn = d3.select(this);\n      easeColumn(movedColumn, d, -c.uplift);\n      raiseToTop(this);\n      d.calcdata.columnDragInProgress = true;\n      renderScrollbarKit(tableControlView.filter(function (dd) {\n        return d.calcdata.key === dd.key;\n      }), gd);\n      return d;\n    }).on('drag', function (d) {\n      var movedColumn = d3.select(this);\n\n      var getter = function (dd) {\n        return (d === dd ? d3.event.x : dd.x) + dd.columnWidth / 2;\n      };\n\n      d.x = Math.max(-c.overdrag, Math.min(d.calcdata.width + c.overdrag - d.columnWidth, d3.event.x));\n      var sortableColumns = flatData(yColumn).filter(function (dd) {\n        return dd.calcdata.key === d.calcdata.key;\n      });\n      var newOrder = sortableColumns.sort(function (a, b) {\n        return getter(a) - getter(b);\n      });\n      newOrder.forEach(function (dd, i) {\n        dd.xIndex = i;\n        dd.x = d === dd ? dd.x : dd.xScale(dd);\n      });\n      yColumn.filter(function (dd) {\n        return d !== dd;\n      }).transition().ease(c.transitionEase).duration(c.transitionDuration).attr('transform', function (d) {\n        return strTranslate(d.x, 0);\n      });\n      movedColumn.call(cancelEeaseColumn).attr('transform', strTranslate(d.x, -c.uplift));\n    }).on('dragend', function (d) {\n      var movedColumn = d3.select(this);\n      var p = d.calcdata;\n      d.x = d.xScale(d);\n      d.calcdata.columnDragInProgress = false;\n      easeColumn(movedColumn, d, 0);\n      columnMoved(gd, p, p.columns.map(function (dd) {\n        return dd.xIndex;\n      }));\n    }));\n  }\n\n  yColumn.each(function (d) {\n    Drawing.setClipUrl(d3.select(this), columnBoundaryClipKey(gd, d), gd);\n  });\n  var columnBlock = yColumn.selectAll('.' + c.cn.columnBlock).data(splitData.splitToPanels, gup.keyFun);\n  columnBlock.enter().append('g').classed(c.cn.columnBlock, true).attr('id', function (d) {\n    return d.key;\n  });\n  columnBlock.style('cursor', function (d) {\n    return d.dragHandle ? 'ew-resize' : d.calcdata.scrollbarState.barWiggleRoom ? 'ns-resize' : 'default';\n  });\n  var headerColumnBlock = columnBlock.filter(headerBlock);\n  var cellsColumnBlock = columnBlock.filter(cellsBlock);\n\n  if (dynamic) {\n    cellsColumnBlock.call(d3.behavior.drag().origin(function (d) {\n      d3.event.stopPropagation();\n      return d;\n    }).on('drag', makeDragRow(gd, tableControlView, -1)).on('dragend', function () {// fixme emit plotly notification\n    }));\n  } // initial rendering: header is rendered first, as it may may have async LaTeX (show header first)\n  // but blocks are _entered_ the way they are due to painter's algo (header on top)\n\n\n  renderColumnCellTree(gd, tableControlView, headerColumnBlock, columnBlock);\n  renderColumnCellTree(gd, tableControlView, cellsColumnBlock, columnBlock);\n  var scrollAreaClip = tableControlView.selectAll('.' + c.cn.scrollAreaClip).data(gup.repeat, gup.keyFun);\n  scrollAreaClip.enter().append('clipPath').classed(c.cn.scrollAreaClip, true).attr('id', function (d) {\n    return scrollAreaBottomClipKey(gd, d);\n  });\n  var scrollAreaClipRect = scrollAreaClip.selectAll('.' + c.cn.scrollAreaClipRect).data(gup.repeat, gup.keyFun);\n  scrollAreaClipRect.enter().append('rect').classed(c.cn.scrollAreaClipRect, true).attr('x', -c.overdrag).attr('y', -c.uplift).attr('fill', 'none');\n  scrollAreaClipRect.attr('width', function (d) {\n    return d.width + 2 * c.overdrag;\n  }).attr('height', function (d) {\n    return d.height + c.uplift;\n  });\n  var columnBoundary = yColumn.selectAll('.' + c.cn.columnBoundary).data(gup.repeat, gup.keyFun);\n  columnBoundary.enter().append('g').classed(c.cn.columnBoundary, true);\n  var columnBoundaryClippath = yColumn.selectAll('.' + c.cn.columnBoundaryClippath).data(gup.repeat, gup.keyFun); // SVG spec doesn't mandate wrapping into a <defs> and doesn't seem to cause a speed difference\n\n  columnBoundaryClippath.enter().append('clipPath').classed(c.cn.columnBoundaryClippath, true);\n  columnBoundaryClippath.attr('id', function (d) {\n    return columnBoundaryClipKey(gd, d);\n  });\n  var columnBoundaryRect = columnBoundaryClippath.selectAll('.' + c.cn.columnBoundaryRect).data(gup.repeat, gup.keyFun);\n  columnBoundaryRect.enter().append('rect').classed(c.cn.columnBoundaryRect, true).attr('fill', 'none');\n  columnBoundaryRect.attr('width', function (d) {\n    return d.columnWidth + 2 * roundHalfWidth(d);\n  }).attr('height', function (d) {\n    return d.calcdata.height + 2 * roundHalfWidth(d) + c.uplift;\n  }).attr('x', function (d) {\n    return -roundHalfWidth(d);\n  }).attr('y', function (d) {\n    return -roundHalfWidth(d);\n  });\n  updateBlockYPosition(null, cellsColumnBlock, tableControlView);\n};\n\nfunction roundHalfWidth(d) {\n  return Math.ceil(d.calcdata.maxLineWidth / 2);\n}\n\nfunction scrollAreaBottomClipKey(gd, d) {\n  return 'clip' + gd._fullLayout._uid + '_scrollAreaBottomClip_' + d.key;\n}\n\nfunction columnBoundaryClipKey(gd, d) {\n  return 'clip' + gd._fullLayout._uid + '_columnBoundaryClippath_' + d.calcdata.key + '_' + d.specIndex;\n}\n\nfunction flatData(selection) {\n  return [].concat.apply([], selection.map(function (g) {\n    return g;\n  })).map(function (g) {\n    return g.__data__;\n  });\n}\n\nfunction renderScrollbarKit(tableControlView, gd, bypassVisibleBar) {\n  function calcTotalHeight(d) {\n    var blocks = d.rowBlocks;\n    return firstRowAnchor(blocks, blocks.length - 1) + (blocks.length ? rowsHeight(blocks[blocks.length - 1], Infinity) : 1);\n  }\n\n  var scrollbarKit = tableControlView.selectAll('.' + c.cn.scrollbarKit).data(gup.repeat, gup.keyFun);\n  scrollbarKit.enter().append('g').classed(c.cn.scrollbarKit, true).style('shape-rendering', 'geometricPrecision');\n  scrollbarKit.each(function (d) {\n    var s = d.scrollbarState;\n    s.totalHeight = calcTotalHeight(d);\n    s.scrollableAreaHeight = d.groupHeight - headerHeight(d);\n    s.currentlyVisibleHeight = Math.min(s.totalHeight, s.scrollableAreaHeight);\n    s.ratio = s.currentlyVisibleHeight / s.totalHeight;\n    s.barLength = Math.max(s.ratio * s.currentlyVisibleHeight, c.goldenRatio * c.scrollbarWidth);\n    s.barWiggleRoom = s.currentlyVisibleHeight - s.barLength;\n    s.wiggleRoom = Math.max(0, s.totalHeight - s.scrollableAreaHeight);\n    s.topY = s.barWiggleRoom === 0 ? 0 : d.scrollY / s.wiggleRoom * s.barWiggleRoom;\n    s.bottomY = s.topY + s.barLength;\n    s.dragMultiplier = s.wiggleRoom / s.barWiggleRoom;\n  }).attr('transform', function (d) {\n    var xPosition = d.width + c.scrollbarWidth / 2 + c.scrollbarOffset;\n    return strTranslate(xPosition, headerHeight(d));\n  });\n  var scrollbar = scrollbarKit.selectAll('.' + c.cn.scrollbar).data(gup.repeat, gup.keyFun);\n  scrollbar.enter().append('g').classed(c.cn.scrollbar, true);\n  var scrollbarSlider = scrollbar.selectAll('.' + c.cn.scrollbarSlider).data(gup.repeat, gup.keyFun);\n  scrollbarSlider.enter().append('g').classed(c.cn.scrollbarSlider, true);\n  scrollbarSlider.attr('transform', function (d) {\n    return strTranslate(0, d.scrollbarState.topY || 0);\n  });\n  var scrollbarGlyph = scrollbarSlider.selectAll('.' + c.cn.scrollbarGlyph).data(gup.repeat, gup.keyFun);\n  scrollbarGlyph.enter().append('line').classed(c.cn.scrollbarGlyph, true).attr('stroke', 'black').attr('stroke-width', c.scrollbarWidth).attr('stroke-linecap', 'round').attr('y1', c.scrollbarWidth / 2);\n  scrollbarGlyph.attr('y2', function (d) {\n    return d.scrollbarState.barLength - c.scrollbarWidth / 2;\n  }).attr('stroke-opacity', function (d) {\n    return d.columnDragInProgress || !d.scrollbarState.barWiggleRoom || bypassVisibleBar ? 0 : 0.4;\n  }); // cancel transition: possible pending (also, delayed) transition\n\n  scrollbarGlyph.transition().delay(0).duration(0);\n  scrollbarGlyph.transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration).attr('stroke-opacity', 0);\n  var scrollbarCaptureZone = scrollbar.selectAll('.' + c.cn.scrollbarCaptureZone).data(gup.repeat, gup.keyFun);\n  scrollbarCaptureZone.enter().append('line').classed(c.cn.scrollbarCaptureZone, true).attr('stroke', 'white').attr('stroke-opacity', 0.01) // some browser might get rid of a 0 opacity element\n  .attr('stroke-width', c.scrollbarCaptureWidth).attr('stroke-linecap', 'butt').attr('y1', 0).on('mousedown', function (d) {\n    var y = d3.event.y;\n    var bbox = this.getBoundingClientRect();\n    var s = d.scrollbarState;\n    var pixelVal = y - bbox.top;\n    var inverseScale = d3.scale.linear().domain([0, s.scrollableAreaHeight]).range([0, s.totalHeight]).clamp(true);\n\n    if (!(s.topY <= pixelVal && pixelVal <= s.bottomY)) {\n      makeDragRow(gd, tableControlView, null, inverseScale(pixelVal - s.barLength / 2))(d);\n    }\n  }).call(d3.behavior.drag().origin(function (d) {\n    d3.event.stopPropagation();\n    d.scrollbarState.scrollbarScrollInProgress = true;\n    return d;\n  }).on('drag', makeDragRow(gd, tableControlView)).on('dragend', function () {// fixme emit Plotly event\n  }));\n  scrollbarCaptureZone.attr('y2', function (d) {\n    return d.scrollbarState.scrollableAreaHeight;\n  }); // Remove scroll glyph and capture zone on static plots\n  // as they don't render properly when converted to PDF\n  // in the Chrome PDF viewer\n  // https://github.com/plotly/streambed/issues/11618\n\n  if (gd._context.staticPlot) {\n    scrollbarGlyph.remove();\n    scrollbarCaptureZone.remove();\n  }\n}\n\nfunction renderColumnCellTree(gd, tableControlView, columnBlock, allColumnBlock) {\n  // fixme this perf hotspot\n  // this is performance critical code as scrolling calls it on every revolver switch\n  // it appears sufficiently fast but there are plenty of low-hanging fruits for performance optimization\n  var columnCells = renderColumnCells(columnBlock);\n  var columnCell = renderColumnCell(columnCells);\n  supplyStylingValues(columnCell);\n  var cellRect = renderCellRect(columnCell);\n  sizeAndStyleRect(cellRect);\n  var cellTextHolder = renderCellTextHolder(columnCell);\n  var cellText = renderCellText(cellTextHolder);\n  setFont(cellText);\n  populateCellText(cellText, tableControlView, allColumnBlock, gd); // doing this at the end when text, and text stlying are set\n\n  setCellHeightAndPositionY(columnCell);\n}\n\nfunction renderColumnCells(columnBlock) {\n  var columnCells = columnBlock.selectAll('.' + c.cn.columnCells).data(gup.repeat, gup.keyFun);\n  columnCells.enter().append('g').classed(c.cn.columnCells, true);\n  columnCells.exit().remove();\n  return columnCells;\n}\n\nfunction renderColumnCell(columnCells) {\n  var columnCell = columnCells.selectAll('.' + c.cn.columnCell).data(splitData.splitToCells, function (d) {\n    return d.keyWithinBlock;\n  });\n  columnCell.enter().append('g').classed(c.cn.columnCell, true);\n  columnCell.exit().remove();\n  return columnCell;\n}\n\nfunction renderCellRect(columnCell) {\n  var cellRect = columnCell.selectAll('.' + c.cn.cellRect).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellRect.enter().append('rect').classed(c.cn.cellRect, true);\n  return cellRect;\n}\n\nfunction renderCellText(cellTextHolder) {\n  var cellText = cellTextHolder.selectAll('.' + c.cn.cellText).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellText.enter().append('text').classed(c.cn.cellText, true).style('cursor', function () {\n    return 'auto';\n  }).on('mousedown', function () {\n    d3.event.stopPropagation();\n  });\n  return cellText;\n}\n\nfunction renderCellTextHolder(columnCell) {\n  var cellTextHolder = columnCell.selectAll('.' + c.cn.cellTextHolder).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellTextHolder.enter().append('g').classed(c.cn.cellTextHolder, true).style('shape-rendering', 'geometricPrecision');\n  return cellTextHolder;\n}\n\nfunction supplyStylingValues(columnCell) {\n  columnCell.each(function (d, i) {\n    var spec = d.calcdata.cells.font;\n    var col = d.column.specIndex;\n    var font = {\n      size: gridPick(spec.size, col, i),\n      color: gridPick(spec.color, col, i),\n      family: gridPick(spec.family, col, i)\n    };\n    d.rowNumber = d.key;\n    d.align = gridPick(d.calcdata.cells.align, col, i);\n    d.cellBorderWidth = gridPick(d.calcdata.cells.line.width, col, i);\n    d.font = font;\n  });\n}\n\nfunction setFont(cellText) {\n  cellText.each(function (d) {\n    Drawing.font(d3.select(this), d.font);\n  });\n}\n\nfunction sizeAndStyleRect(cellRect) {\n  cellRect.attr('width', function (d) {\n    return d.column.columnWidth;\n  }).attr('stroke-width', function (d) {\n    return d.cellBorderWidth;\n  }).each(function (d) {\n    var atomicSelection = d3.select(this);\n    Color.stroke(atomicSelection, gridPick(d.calcdata.cells.line.color, d.column.specIndex, d.rowNumber));\n    Color.fill(atomicSelection, gridPick(d.calcdata.cells.fill.color, d.column.specIndex, d.rowNumber));\n  });\n}\n\nfunction populateCellText(cellText, tableControlView, allColumnBlock, gd) {\n  cellText.text(function (d) {\n    var col = d.column.specIndex;\n    var row = d.rowNumber;\n    var userSuppliedContent = d.value;\n    var stringSupplied = typeof userSuppliedContent === 'string';\n    var hasBreaks = stringSupplied && userSuppliedContent.match(/<br>/i);\n    var userBrokenText = !stringSupplied || hasBreaks;\n    d.mayHaveMarkup = stringSupplied && userSuppliedContent.match(/[<&>]/);\n    var latex = isLatex(userSuppliedContent);\n    d.latex = latex;\n    var prefix = latex ? '' : gridPick(d.calcdata.cells.prefix, col, row) || '';\n    var suffix = latex ? '' : gridPick(d.calcdata.cells.suffix, col, row) || '';\n    var format = latex ? null : gridPick(d.calcdata.cells.format, col, row) || null;\n    var prefixSuffixedText = prefix + (format ? numberFormat(format)(d.value) : d.value) + suffix;\n    var hasWrapSplitCharacter;\n    d.wrappingNeeded = !d.wrapped && !userBrokenText && !latex && (hasWrapSplitCharacter = hasWrapCharacter(prefixSuffixedText));\n    d.cellHeightMayIncrease = hasBreaks || latex || d.mayHaveMarkup || (hasWrapSplitCharacter === void 0 ? hasWrapCharacter(prefixSuffixedText) : hasWrapSplitCharacter);\n    d.needsConvertToTspans = d.mayHaveMarkup || d.wrappingNeeded || d.latex;\n    var textToRender;\n\n    if (d.wrappingNeeded) {\n      var hrefPreservedText = c.wrapSplitCharacter === ' ' ? prefixSuffixedText.replace(/<a href=/ig, '<a_href=') : prefixSuffixedText;\n      var fragments = hrefPreservedText.split(c.wrapSplitCharacter);\n      var hrefRestoredFragments = c.wrapSplitCharacter === ' ' ? fragments.map(function (frag) {\n        return frag.replace(/<a_href=/ig, '<a href=');\n      }) : fragments;\n      d.fragments = hrefRestoredFragments.map(function (f) {\n        return {\n          text: f,\n          width: null\n        };\n      });\n      d.fragments.push({\n        fragment: c.wrapSpacer,\n        width: null\n      });\n      textToRender = hrefRestoredFragments.join(c.lineBreaker) + c.lineBreaker + c.wrapSpacer;\n    } else {\n      delete d.fragments;\n      textToRender = prefixSuffixedText;\n    }\n\n    return textToRender;\n  }).attr('dy', function (d) {\n    return d.needsConvertToTspans ? 0 : '0.75em';\n  }).each(function (d) {\n    var element = this;\n    var selection = d3.select(element); // finalize what's in the DOM\n\n    var renderCallback = d.wrappingNeeded ? wrapTextMaker : updateYPositionMaker;\n\n    if (d.needsConvertToTspans) {\n      svgUtil.convertToTspans(selection, gd, renderCallback(allColumnBlock, element, tableControlView, gd, d));\n    } else {\n      d3.select(element.parentNode) // basic cell adjustment - compliance with `cellPad`\n      .attr('transform', function (d) {\n        return strTranslate(xPosition(d), c.cellPad);\n      }).attr('text-anchor', function (d) {\n        return {\n          left: 'start',\n          center: 'middle',\n          right: 'end'\n        }[d.align];\n      });\n    }\n  });\n}\n\nfunction isLatex(content) {\n  return typeof content === 'string' && content.match(c.latexCheck);\n}\n\nfunction hasWrapCharacter(text) {\n  return text.indexOf(c.wrapSplitCharacter) !== -1;\n}\n\nfunction columnMoved(gd, calcdata, indices) {\n  var o = calcdata.gdColumnsOriginalOrder;\n  calcdata.gdColumns.sort(function (a, b) {\n    return indices[o.indexOf(a)] - indices[o.indexOf(b)];\n  });\n  calcdata.columnorder = indices; // TODO: there's no data here, but also this reordering is not reflected\n  // in gd.data or even gd._fullData.\n  // For now I will not attempt to persist this in _preGUI\n\n  gd.emit('plotly_restyle');\n}\n\nfunction gridPick(spec, col, row) {\n  if (Array.isArray(spec)) {\n    var column = spec[Math.min(col, spec.length - 1)];\n\n    if (Array.isArray(column)) {\n      return column[Math.min(row, column.length - 1)];\n    } else {\n      return column;\n    }\n  } else {\n    return spec;\n  }\n}\n\nfunction easeColumn(selection, d, y) {\n  selection.transition().ease(c.releaseTransitionEase).duration(c.releaseTransitionDuration).attr('transform', strTranslate(d.x, y));\n}\n\nfunction cellsBlock(d) {\n  return d.type === 'cells';\n}\n\nfunction headerBlock(d) {\n  return d.type === 'header';\n}\n/**\n * Revolver panel and cell contents layouting\n */\n\n\nfunction headerHeight(d) {\n  var headerBlocks = d.rowBlocks.length ? d.rowBlocks[0].auxiliaryBlocks : [];\n  return headerBlocks.reduce(function (p, n) {\n    return p + rowsHeight(n, Infinity);\n  }, 0);\n}\n\nfunction findPagesAndCacheHeights(blocks, scrollY, scrollHeight) {\n  var pages = [];\n  var pTop = 0;\n\n  for (var blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n    var block = blocks[blockIndex];\n    var blockRows = block.rows;\n    var rowsHeight = 0;\n\n    for (var i = 0; i < blockRows.length; i++) {\n      rowsHeight += blockRows[i].rowHeight;\n    } // caching allRowsHeight on the block - it's safe as this function is always called from within the code part\n    // that handles increases to row heights\n\n\n    block.allRowsHeight = rowsHeight;\n    var pBottom = pTop + rowsHeight;\n    var windowTop = scrollY;\n    var windowBottom = windowTop + scrollHeight;\n\n    if (windowTop < pBottom && windowBottom > pTop) {\n      pages.push(blockIndex);\n    }\n\n    pTop += rowsHeight; // consider this nice final optimization; put it in `for` condition - caveat, currently the\n    // block.allRowsHeight relies on being invalidated, so enabling this opt may not be safe\n    // if(pages.length > 1) break;\n  }\n\n  return pages;\n}\n\nfunction updateBlockYPosition(gd, cellsColumnBlock, tableControlView) {\n  var d = flatData(cellsColumnBlock)[0];\n  if (d === undefined) return;\n  var blocks = d.rowBlocks;\n  var calcdata = d.calcdata;\n  var bottom = firstRowAnchor(blocks, blocks.length);\n  var scrollHeight = d.calcdata.groupHeight - headerHeight(d);\n  var scrollY = calcdata.scrollY = Math.max(0, Math.min(bottom - scrollHeight, calcdata.scrollY));\n  var pages = findPagesAndCacheHeights(blocks, scrollY, scrollHeight);\n\n  if (pages.length === 1) {\n    if (pages[0] === blocks.length - 1) {\n      pages.unshift(pages[0] - 1);\n    } else {\n      pages.push(pages[0] + 1);\n    }\n  } // make phased out page jump by 2 while leaving stationary page intact\n\n\n  if (pages[0] % 2) {\n    pages.reverse();\n  }\n\n  cellsColumnBlock.each(function (d, i) {\n    // these values will also be needed when a block is translated again due to growing cell height\n    d.page = pages[i];\n    d.scrollY = scrollY;\n  });\n  cellsColumnBlock.attr('transform', function (d) {\n    var yTranslate = firstRowAnchor(d.rowBlocks, d.page) - d.scrollY;\n    return strTranslate(0, yTranslate);\n  }); // conditionally rerendering panel 0 and 1\n\n  if (gd) {\n    conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 0);\n    conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 1);\n    renderScrollbarKit(tableControlView, gd);\n  }\n}\n\nfunction makeDragRow(gd, allTableControlView, optionalMultiplier, optionalPosition) {\n  return function dragRow(eventD) {\n    // may come from whichever DOM event target: drag, wheel, bar... eventD corresponds to event target\n    var d = eventD.calcdata ? eventD.calcdata : eventD;\n    var tableControlView = allTableControlView.filter(function (dd) {\n      return d.key === dd.key;\n    });\n    var multiplier = optionalMultiplier || d.scrollbarState.dragMultiplier;\n    var initialScrollY = d.scrollY;\n    d.scrollY = optionalPosition === void 0 ? d.scrollY + multiplier * d3.event.dy : optionalPosition;\n    var cellsColumnBlock = tableControlView.selectAll('.' + c.cn.yColumn).selectAll('.' + c.cn.columnBlock).filter(cellsBlock);\n    updateBlockYPosition(gd, cellsColumnBlock, tableControlView); // return false if we've \"used\" the scroll, ie it did something,\n    // so the event shouldn't bubble (if appropriate)\n\n    return d.scrollY === initialScrollY;\n  };\n}\n\nfunction conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, prevPages, d, revolverIndex) {\n  var shouldComponentUpdate = pages[revolverIndex] !== prevPages[revolverIndex];\n\n  if (shouldComponentUpdate) {\n    clearTimeout(d.currentRepaint[revolverIndex]);\n    d.currentRepaint[revolverIndex] = setTimeout(function () {\n      // setTimeout might lag rendering but yields a smoother scroll, because fast scrolling makes\n      // some repaints invisible ie. wasteful (DOM work blocks the main thread)\n      var toRerender = cellsColumnBlock.filter(function (d, i) {\n        return i === revolverIndex && pages[i] !== prevPages[i];\n      });\n      renderColumnCellTree(gd, tableControlView, toRerender, cellsColumnBlock);\n      prevPages[revolverIndex] = pages[revolverIndex];\n    });\n  }\n}\n\nfunction wrapTextMaker(columnBlock, element, tableControlView, gd) {\n  return function wrapText() {\n    var cellTextHolder = d3.select(element.parentNode);\n    cellTextHolder.each(function (d) {\n      var fragments = d.fragments;\n      cellTextHolder.selectAll('tspan.line').each(function (dd, i) {\n        fragments[i].width = this.getComputedTextLength();\n      }); // last element is only for measuring the separator character, so it's ignored:\n\n      var separatorLength = fragments[fragments.length - 1].width;\n      var rest = fragments.slice(0, -1);\n      var currentRow = [];\n      var currentAddition, currentAdditionLength;\n      var currentRowLength = 0;\n      var rowLengthLimit = d.column.columnWidth - 2 * c.cellPad;\n      d.value = '';\n\n      while (rest.length) {\n        currentAddition = rest.shift();\n        currentAdditionLength = currentAddition.width + separatorLength;\n\n        if (currentRowLength + currentAdditionLength > rowLengthLimit) {\n          d.value += currentRow.join(c.wrapSpacer) + c.lineBreaker;\n          currentRow = [];\n          currentRowLength = 0;\n        }\n\n        currentRow.push(currentAddition.text);\n        currentRowLength += currentAdditionLength;\n      }\n\n      if (currentRowLength) {\n        d.value += currentRow.join(c.wrapSpacer);\n      }\n\n      d.wrapped = true;\n    }); // the pre-wrapped text was rendered only for the text measurements\n\n    cellTextHolder.selectAll('tspan.line').remove(); // resupply text, now wrapped\n\n    populateCellText(cellTextHolder.select('.' + c.cn.cellText), tableControlView, columnBlock, gd);\n    d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY);\n  };\n}\n\nfunction updateYPositionMaker(columnBlock, element, tableControlView, gd, d) {\n  return function updateYPosition() {\n    if (d.settledY) return;\n    var cellTextHolder = d3.select(element.parentNode);\n    var l = getBlock(d);\n    var rowIndex = d.key - l.firstRowIndex;\n    var declaredRowHeight = l.rows[rowIndex].rowHeight;\n    var requiredHeight = d.cellHeightMayIncrease ? element.parentNode.getBoundingClientRect().height + 2 * c.cellPad : declaredRowHeight;\n    var finalHeight = Math.max(requiredHeight, declaredRowHeight);\n    var increase = finalHeight - l.rows[rowIndex].rowHeight;\n\n    if (increase) {\n      // current row height increased\n      l.rows[rowIndex].rowHeight = finalHeight;\n      columnBlock.selectAll('.' + c.cn.columnCell).call(setCellHeightAndPositionY);\n      updateBlockYPosition(null, columnBlock.filter(cellsBlock), 0); // if d.column.type === 'header', then the scrollbar has to be pushed downward to the scrollable area\n      // if d.column.type === 'cells', it can still be relevant if total scrolling content height is less than the\n      //                               scrollable window, as increases to row heights may need scrollbar updates\n\n      renderScrollbarKit(tableControlView, gd, true);\n    }\n\n    cellTextHolder.attr('transform', function () {\n      // this code block is only invoked for items where d.cellHeightMayIncrease is truthy\n      var element = this;\n      var columnCellElement = element.parentNode;\n      var box = columnCellElement.getBoundingClientRect();\n      var rectBox = d3.select(element.parentNode).select('.' + c.cn.cellRect).node().getBoundingClientRect();\n      var currentTransform = element.transform.baseVal.consolidate();\n      var yPosition = rectBox.top - box.top + (currentTransform ? currentTransform.matrix.f : c.cellPad);\n      return strTranslate(xPosition(d, d3.select(element.parentNode).select('.' + c.cn.cellTextHolder).node().getBoundingClientRect().width), yPosition);\n    });\n    d.settledY = true;\n  };\n}\n\nfunction xPosition(d, optionalWidth) {\n  switch (d.align) {\n    case 'left':\n      return c.cellPad;\n\n    case 'right':\n      return d.column.columnWidth - (optionalWidth || 0) - c.cellPad;\n\n    case 'center':\n      return (d.column.columnWidth - (optionalWidth || 0)) / 2;\n\n    default:\n      return c.cellPad;\n  }\n}\n\nfunction setCellHeightAndPositionY(columnCell) {\n  columnCell.attr('transform', function (d) {\n    var headerHeight = d.rowBlocks[0].auxiliaryBlocks.reduce(function (p, n) {\n      return p + rowsHeight(n, Infinity);\n    }, 0);\n    var l = getBlock(d);\n    var rowAnchor = rowsHeight(l, d.key);\n    var yOffset = rowAnchor + headerHeight;\n    return strTranslate(0, yOffset);\n  }).selectAll('.' + c.cn.cellRect).attr('height', function (d) {\n    return getRow(getBlock(d), d.key).rowHeight;\n  });\n}\n\nfunction firstRowAnchor(blocks, page) {\n  var total = 0;\n\n  for (var i = page - 1; i >= 0; i--) {\n    total += allRowsHeight(blocks[i]);\n  }\n\n  return total;\n}\n\nfunction rowsHeight(rowBlock, key) {\n  var total = 0;\n\n  for (var i = 0; i < rowBlock.rows.length && rowBlock.rows[i].rowIndex < key; i++) {\n    total += rowBlock.rows[i].rowHeight;\n  }\n\n  return total;\n}\n\nfunction allRowsHeight(rowBlock) {\n  var cached = rowBlock.allRowsHeight;\n\n  if (cached !== void 0) {\n    return cached;\n  }\n\n  var total = 0;\n\n  for (var i = 0; i < rowBlock.rows.length; i++) {\n    total += rowBlock.rows[i].rowHeight;\n  }\n\n  rowBlock.allRowsHeight = total;\n  return total;\n}\n\nfunction getBlock(d) {\n  return d.rowBlocks[d.page];\n}\n\nfunction getRow(l, i) {\n  return l.rows[i - l.firstRowIndex];\n}","map":{"version":3,"sources":["C:/Projects/reactApp/analyse_coderhub/node_modules/plotly.js/src/traces/table/plot.js"],"names":["c","require","d3","Lib","numberFormat","gup","Drawing","svgUtil","raiseToTop","strTranslate","cancelEeaseColumn","cancelTransition","prepareData","splitData","Color","module","exports","plot","gd","wrappedTraceHolders","dynamic","_context","staticPlot","table","_fullLayout","_paper","selectAll","cn","data","map","wrappedTraceHolder","traceHolder","unwrap","trace","keyFun","exit","remove","enter","append","classed","attr","style","d","width","size","l","r","height","t","b","translateX","translateY","tableControlView","repeat","cvEnter","wheelEvent","document","on","filter","dd","call","renderScrollbarKit","scrollbarState","wheeling","newY","scrollY","event","deltaY","noChange","makeDragRow","stopPropagation","preventDefault","scrollBackground","each","setClipUrl","select","scrollAreaBottomClipKey","yColumn","vm","columns","x","behavior","drag","origin","movedColumn","easeColumn","uplift","calcdata","columnDragInProgress","key","getter","columnWidth","Math","max","overdrag","min","sortableColumns","flatData","newOrder","sort","a","forEach","i","xIndex","xScale","transition","ease","transitionEase","duration","transitionDuration","p","columnMoved","columnBoundaryClipKey","columnBlock","splitToPanels","dragHandle","barWiggleRoom","headerColumnBlock","headerBlock","cellsColumnBlock","cellsBlock","renderColumnCellTree","scrollAreaClip","scrollAreaClipRect","columnBoundary","columnBoundaryClippath","columnBoundaryRect","roundHalfWidth","updateBlockYPosition","ceil","maxLineWidth","_uid","specIndex","selection","concat","apply","g","__data__","bypassVisibleBar","calcTotalHeight","blocks","rowBlocks","firstRowAnchor","length","rowsHeight","Infinity","scrollbarKit","s","totalHeight","scrollableAreaHeight","groupHeight","headerHeight","currentlyVisibleHeight","ratio","barLength","goldenRatio","scrollbarWidth","wiggleRoom","topY","bottomY","dragMultiplier","xPosition","scrollbarOffset","scrollbar","scrollbarSlider","scrollbarGlyph","delay","scrollbarHideDelay","scrollbarHideDuration","scrollbarCaptureZone","scrollbarCaptureWidth","y","bbox","getBoundingClientRect","pixelVal","top","inverseScale","scale","linear","domain","range","clamp","scrollbarScrollInProgress","allColumnBlock","columnCells","renderColumnCells","columnCell","renderColumnCell","supplyStylingValues","cellRect","renderCellRect","sizeAndStyleRect","cellTextHolder","renderCellTextHolder","cellText","renderCellText","setFont","populateCellText","setCellHeightAndPositionY","splitToCells","keyWithinBlock","spec","cells","font","col","column","gridPick","color","family","rowNumber","align","cellBorderWidth","line","atomicSelection","stroke","fill","text","row","userSuppliedContent","value","stringSupplied","hasBreaks","match","userBrokenText","mayHaveMarkup","latex","isLatex","prefix","suffix","format","prefixSuffixedText","hasWrapSplitCharacter","wrappingNeeded","wrapped","hasWrapCharacter","cellHeightMayIncrease","needsConvertToTspans","textToRender","hrefPreservedText","wrapSplitCharacter","replace","fragments","split","hrefRestoredFragments","frag","f","push","fragment","wrapSpacer","join","lineBreaker","element","renderCallback","wrapTextMaker","updateYPositionMaker","convertToTspans","parentNode","cellPad","left","center","right","content","latexCheck","indexOf","indices","o","gdColumnsOriginalOrder","gdColumns","columnorder","emit","Array","isArray","releaseTransitionEase","releaseTransitionDuration","type","headerBlocks","auxiliaryBlocks","reduce","n","findPagesAndCacheHeights","scrollHeight","pages","pTop","blockIndex","block","blockRows","rows","rowHeight","allRowsHeight","pBottom","windowTop","windowBottom","undefined","bottom","unshift","reverse","page","yTranslate","conditionalPanelRerender","prevPages","allTableControlView","optionalMultiplier","optionalPosition","dragRow","eventD","multiplier","initialScrollY","dy","revolverIndex","shouldComponentUpdate","clearTimeout","currentRepaint","setTimeout","toRerender","wrapText","getComputedTextLength","separatorLength","rest","slice","currentRow","currentAddition","currentAdditionLength","currentRowLength","rowLengthLimit","shift","updateYPosition","settledY","getBlock","rowIndex","firstRowIndex","declaredRowHeight","requiredHeight","finalHeight","increase","columnCellElement","box","rectBox","node","currentTransform","transform","baseVal","consolidate","yPosition","matrix","optionalWidth","rowAnchor","yOffset","getRow","total","rowBlock","cached"],"mappings":"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","sourcesContent":["'use strict';\n\nvar c = require('./constants');\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar numberFormat = Lib.numberFormat;\nvar gup = require('../../lib/gup');\nvar Drawing = require('../../components/drawing');\nvar svgUtil = require('../../lib/svg_text_utils');\nvar raiseToTop = require('../../lib').raiseToTop;\nvar strTranslate = require('../../lib').strTranslate;\nvar cancelEeaseColumn = require('../../lib').cancelTransition;\nvar prepareData = require('./data_preparation_helper');\nvar splitData = require('./data_split_helpers');\nvar Color = require('../../components/color');\n\nmodule.exports = function plot(gd, wrappedTraceHolders) {\n    var dynamic = !gd._context.staticPlot;\n\n    var table = gd._fullLayout._paper.selectAll('.' + c.cn.table)\n        .data(wrappedTraceHolders.map(function(wrappedTraceHolder) {\n            var traceHolder = gup.unwrap(wrappedTraceHolder);\n            var trace = traceHolder.trace;\n            return prepareData(gd, trace);\n        }), gup.keyFun);\n\n    table.exit().remove();\n\n    table.enter()\n        .append('g')\n        .classed(c.cn.table, true)\n        .attr('overflow', 'visible')\n        .style('box-sizing', 'content-box')\n        .style('position', 'absolute')\n        .style('left', 0)\n        .style('overflow', 'visible')\n        .style('shape-rendering', 'crispEdges')\n        .style('pointer-events', 'all');\n\n    table\n        .attr('width', function(d) {return d.width + d.size.l + d.size.r;})\n        .attr('height', function(d) {return d.height + d.size.t + d.size.b;})\n        .attr('transform', function(d) {\n            return strTranslate(d.translateX, d.translateY);\n        });\n\n    var tableControlView = table.selectAll('.' + c.cn.tableControlView)\n        .data(gup.repeat, gup.keyFun);\n\n    var cvEnter = tableControlView.enter()\n        .append('g')\n        .classed(c.cn.tableControlView, true)\n        .style('box-sizing', 'content-box');\n    if(dynamic) {\n        var wheelEvent = 'onwheel' in document ? 'wheel' : 'mousewheel';\n        cvEnter\n            .on('mousemove', function(d) {\n                tableControlView\n                    .filter(function(dd) {return d === dd;})\n                    .call(renderScrollbarKit, gd);\n            })\n            .on(wheelEvent, function(d) {\n                if(d.scrollbarState.wheeling) return;\n                d.scrollbarState.wheeling = true;\n                var newY = d.scrollY + d3.event.deltaY;\n                var noChange = makeDragRow(gd, tableControlView, null, newY)(d);\n                if(!noChange) {\n                    d3.event.stopPropagation();\n                    d3.event.preventDefault();\n                }\n                d.scrollbarState.wheeling = false;\n            })\n            .call(renderScrollbarKit, gd, true);\n    }\n\n    tableControlView\n        .attr('transform', function(d) {return strTranslate(d.size.l, d.size.t);});\n\n    // scrollBackground merely ensures that mouse events are captured even on crazy fast scrollwheeling\n    // otherwise rendering glitches may occur\n    var scrollBackground = tableControlView.selectAll('.' + c.cn.scrollBackground)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollBackground.enter()\n        .append('rect')\n        .classed(c.cn.scrollBackground, true)\n        .attr('fill', 'none');\n\n    scrollBackground\n        .attr('width', function(d) {return d.width;})\n        .attr('height', function(d) {return d.height;});\n\n    tableControlView.each(function(d) {\n        Drawing.setClipUrl(d3.select(this), scrollAreaBottomClipKey(gd, d), gd);\n    });\n\n    var yColumn = tableControlView.selectAll('.' + c.cn.yColumn)\n        .data(function(vm) {return vm.columns;}, gup.keyFun);\n\n    yColumn.enter()\n        .append('g')\n        .classed(c.cn.yColumn, true);\n\n    yColumn.exit().remove();\n\n    yColumn.attr('transform', function(d) {return strTranslate(d.x, 0);});\n\n    if(dynamic) {\n        yColumn.call(d3.behavior.drag()\n            .origin(function(d) {\n                var movedColumn = d3.select(this);\n                easeColumn(movedColumn, d, -c.uplift);\n                raiseToTop(this);\n                d.calcdata.columnDragInProgress = true;\n                renderScrollbarKit(tableControlView.filter(function(dd) {return d.calcdata.key === dd.key;}), gd);\n                return d;\n            })\n            .on('drag', function(d) {\n                var movedColumn = d3.select(this);\n                var getter = function(dd) {return (d === dd ? d3.event.x : dd.x) + dd.columnWidth / 2;};\n                d.x = Math.max(-c.overdrag, Math.min(d.calcdata.width + c.overdrag - d.columnWidth, d3.event.x));\n\n                var sortableColumns = flatData(yColumn).filter(function(dd) {return dd.calcdata.key === d.calcdata.key;});\n                var newOrder = sortableColumns.sort(function(a, b) {return getter(a) - getter(b);});\n                newOrder.forEach(function(dd, i) {\n                    dd.xIndex = i;\n                    dd.x = d === dd ? dd.x : dd.xScale(dd);\n                });\n\n                yColumn.filter(function(dd) {return d !== dd;})\n                    .transition()\n                    .ease(c.transitionEase)\n                    .duration(c.transitionDuration)\n                    .attr('transform', function(d) {return strTranslate(d.x, 0);});\n                movedColumn\n                    .call(cancelEeaseColumn)\n                    .attr('transform', strTranslate(d.x, -c.uplift));\n            })\n            .on('dragend', function(d) {\n                var movedColumn = d3.select(this);\n                var p = d.calcdata;\n                d.x = d.xScale(d);\n                d.calcdata.columnDragInProgress = false;\n                easeColumn(movedColumn, d, 0);\n                columnMoved(gd, p, p.columns.map(function(dd) {return dd.xIndex;}));\n            })\n        );\n    }\n\n    yColumn.each(function(d) {\n        Drawing.setClipUrl(d3.select(this), columnBoundaryClipKey(gd, d), gd);\n    });\n\n    var columnBlock = yColumn.selectAll('.' + c.cn.columnBlock)\n        .data(splitData.splitToPanels, gup.keyFun);\n\n    columnBlock.enter()\n        .append('g')\n        .classed(c.cn.columnBlock, true)\n        .attr('id', function(d) {return d.key;});\n\n    columnBlock\n        .style('cursor', function(d) {\n            return d.dragHandle ? 'ew-resize' : d.calcdata.scrollbarState.barWiggleRoom ? 'ns-resize' : 'default';\n        });\n\n    var headerColumnBlock = columnBlock.filter(headerBlock);\n    var cellsColumnBlock = columnBlock.filter(cellsBlock);\n\n    if(dynamic) {\n        cellsColumnBlock.call(d3.behavior.drag()\n            .origin(function(d) {\n                d3.event.stopPropagation();\n                return d;\n            })\n            .on('drag', makeDragRow(gd, tableControlView, -1))\n            .on('dragend', function() {\n                // fixme emit plotly notification\n            })\n        );\n    }\n\n    // initial rendering: header is rendered first, as it may may have async LaTeX (show header first)\n    // but blocks are _entered_ the way they are due to painter's algo (header on top)\n    renderColumnCellTree(gd, tableControlView, headerColumnBlock, columnBlock);\n    renderColumnCellTree(gd, tableControlView, cellsColumnBlock, columnBlock);\n\n    var scrollAreaClip = tableControlView.selectAll('.' + c.cn.scrollAreaClip)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollAreaClip.enter()\n        .append('clipPath')\n        .classed(c.cn.scrollAreaClip, true)\n        .attr('id', function(d) {return scrollAreaBottomClipKey(gd, d);});\n\n    var scrollAreaClipRect = scrollAreaClip.selectAll('.' + c.cn.scrollAreaClipRect)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollAreaClipRect.enter()\n        .append('rect')\n        .classed(c.cn.scrollAreaClipRect, true)\n        .attr('x', -c.overdrag)\n        .attr('y', -c.uplift)\n        .attr('fill', 'none');\n\n    scrollAreaClipRect\n        .attr('width', function(d) {return d.width + 2 * c.overdrag;})\n        .attr('height', function(d) {return d.height + c.uplift;});\n\n    var columnBoundary = yColumn.selectAll('.' + c.cn.columnBoundary)\n        .data(gup.repeat, gup.keyFun);\n\n    columnBoundary.enter()\n        .append('g')\n        .classed(c.cn.columnBoundary, true);\n\n    var columnBoundaryClippath = yColumn.selectAll('.' + c.cn.columnBoundaryClippath)\n        .data(gup.repeat, gup.keyFun);\n\n    // SVG spec doesn't mandate wrapping into a <defs> and doesn't seem to cause a speed difference\n    columnBoundaryClippath.enter()\n        .append('clipPath')\n        .classed(c.cn.columnBoundaryClippath, true);\n\n    columnBoundaryClippath\n        .attr('id', function(d) {return columnBoundaryClipKey(gd, d);});\n\n    var columnBoundaryRect = columnBoundaryClippath.selectAll('.' + c.cn.columnBoundaryRect)\n        .data(gup.repeat, gup.keyFun);\n\n    columnBoundaryRect.enter()\n        .append('rect')\n        .classed(c.cn.columnBoundaryRect, true)\n        .attr('fill', 'none');\n\n    columnBoundaryRect\n        .attr('width', function(d) { return d.columnWidth + 2 * roundHalfWidth(d); })\n        .attr('height', function(d) {return d.calcdata.height + 2 * roundHalfWidth(d) + c.uplift;})\n        .attr('x', function(d) { return -roundHalfWidth(d); })\n        .attr('y', function(d) { return -roundHalfWidth(d); });\n\n    updateBlockYPosition(null, cellsColumnBlock, tableControlView);\n};\n\nfunction roundHalfWidth(d) {\n    return Math.ceil(d.calcdata.maxLineWidth / 2);\n}\n\nfunction scrollAreaBottomClipKey(gd, d) {\n    return 'clip' + gd._fullLayout._uid + '_scrollAreaBottomClip_' + d.key;\n}\n\nfunction columnBoundaryClipKey(gd, d) {\n    return 'clip' + gd._fullLayout._uid + '_columnBoundaryClippath_' + d.calcdata.key + '_' + d.specIndex;\n}\n\nfunction flatData(selection) {\n    return [].concat.apply([], selection.map(function(g) {return g;}))\n        .map(function(g) {return g.__data__;});\n}\n\nfunction renderScrollbarKit(tableControlView, gd, bypassVisibleBar) {\n    function calcTotalHeight(d) {\n        var blocks = d.rowBlocks;\n        return firstRowAnchor(blocks, blocks.length - 1) + (blocks.length ? rowsHeight(blocks[blocks.length - 1], Infinity) : 1);\n    }\n\n    var scrollbarKit = tableControlView.selectAll('.' + c.cn.scrollbarKit)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarKit.enter()\n        .append('g')\n        .classed(c.cn.scrollbarKit, true)\n        .style('shape-rendering', 'geometricPrecision');\n\n    scrollbarKit\n        .each(function(d) {\n            var s = d.scrollbarState;\n            s.totalHeight = calcTotalHeight(d);\n            s.scrollableAreaHeight = d.groupHeight - headerHeight(d);\n            s.currentlyVisibleHeight = Math.min(s.totalHeight, s.scrollableAreaHeight);\n            s.ratio = s.currentlyVisibleHeight / s.totalHeight;\n            s.barLength = Math.max(s.ratio * s.currentlyVisibleHeight, c.goldenRatio * c.scrollbarWidth);\n            s.barWiggleRoom = s.currentlyVisibleHeight - s.barLength;\n            s.wiggleRoom = Math.max(0, s.totalHeight - s.scrollableAreaHeight);\n            s.topY = s.barWiggleRoom === 0 ? 0 : (d.scrollY / s.wiggleRoom) * s.barWiggleRoom;\n            s.bottomY = s.topY + s.barLength;\n            s.dragMultiplier = s.wiggleRoom / s.barWiggleRoom;\n        })\n        .attr('transform', function(d) {\n            var xPosition = d.width + c.scrollbarWidth / 2 + c.scrollbarOffset;\n            return strTranslate(xPosition, headerHeight(d));\n        });\n\n    var scrollbar = scrollbarKit.selectAll('.' + c.cn.scrollbar)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbar.enter()\n        .append('g')\n        .classed(c.cn.scrollbar, true);\n\n    var scrollbarSlider = scrollbar.selectAll('.' + c.cn.scrollbarSlider)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarSlider.enter()\n        .append('g')\n        .classed(c.cn.scrollbarSlider, true);\n\n    scrollbarSlider\n        .attr('transform', function(d) {\n            return strTranslate(0, d.scrollbarState.topY || 0);\n        });\n\n    var scrollbarGlyph = scrollbarSlider.selectAll('.' + c.cn.scrollbarGlyph)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarGlyph.enter()\n        .append('line')\n        .classed(c.cn.scrollbarGlyph, true)\n        .attr('stroke', 'black')\n        .attr('stroke-width', c.scrollbarWidth)\n        .attr('stroke-linecap', 'round')\n        .attr('y1', c.scrollbarWidth / 2);\n\n    scrollbarGlyph\n        .attr('y2', function(d) {\n            return d.scrollbarState.barLength - c.scrollbarWidth / 2;\n        })\n        .attr('stroke-opacity', function(d) {\n            return d.columnDragInProgress || !d.scrollbarState.barWiggleRoom || bypassVisibleBar ? 0 : 0.4;\n        });\n\n    // cancel transition: possible pending (also, delayed) transition\n    scrollbarGlyph\n        .transition().delay(0).duration(0);\n\n    scrollbarGlyph\n        .transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration)\n        .attr('stroke-opacity', 0);\n\n    var scrollbarCaptureZone = scrollbar.selectAll('.' + c.cn.scrollbarCaptureZone)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarCaptureZone.enter()\n        .append('line')\n        .classed(c.cn.scrollbarCaptureZone, true)\n        .attr('stroke', 'white')\n        .attr('stroke-opacity', 0.01) // some browser might get rid of a 0 opacity element\n        .attr('stroke-width', c.scrollbarCaptureWidth)\n        .attr('stroke-linecap', 'butt')\n        .attr('y1', 0)\n        .on('mousedown', function(d) {\n            var y = d3.event.y;\n            var bbox = this.getBoundingClientRect();\n            var s = d.scrollbarState;\n            var pixelVal = y - bbox.top;\n            var inverseScale = d3.scale.linear().domain([0, s.scrollableAreaHeight]).range([0, s.totalHeight]).clamp(true);\n            if(!(s.topY <= pixelVal && pixelVal <= s.bottomY)) {\n                makeDragRow(gd, tableControlView, null, inverseScale(pixelVal - s.barLength / 2))(d);\n            }\n        })\n        .call(d3.behavior.drag()\n            .origin(function(d) {\n                d3.event.stopPropagation();\n                d.scrollbarState.scrollbarScrollInProgress = true;\n                return d;\n            })\n            .on('drag', makeDragRow(gd, tableControlView))\n            .on('dragend', function() {\n                // fixme emit Plotly event\n            })\n        );\n\n    scrollbarCaptureZone\n        .attr('y2', function(d) {\n            return d.scrollbarState.scrollableAreaHeight;\n        });\n\n    // Remove scroll glyph and capture zone on static plots\n    // as they don't render properly when converted to PDF\n    // in the Chrome PDF viewer\n    // https://github.com/plotly/streambed/issues/11618\n    if(gd._context.staticPlot) {\n        scrollbarGlyph.remove();\n        scrollbarCaptureZone.remove();\n    }\n}\n\nfunction renderColumnCellTree(gd, tableControlView, columnBlock, allColumnBlock) {\n    // fixme this perf hotspot\n    // this is performance critical code as scrolling calls it on every revolver switch\n    // it appears sufficiently fast but there are plenty of low-hanging fruits for performance optimization\n\n    var columnCells = renderColumnCells(columnBlock);\n\n    var columnCell = renderColumnCell(columnCells);\n\n    supplyStylingValues(columnCell);\n\n    var cellRect = renderCellRect(columnCell);\n\n    sizeAndStyleRect(cellRect);\n\n    var cellTextHolder = renderCellTextHolder(columnCell);\n\n    var cellText = renderCellText(cellTextHolder);\n\n    setFont(cellText);\n    populateCellText(cellText, tableControlView, allColumnBlock, gd);\n\n    // doing this at the end when text, and text stlying are set\n    setCellHeightAndPositionY(columnCell);\n}\n\nfunction renderColumnCells(columnBlock) {\n    var columnCells = columnBlock.selectAll('.' + c.cn.columnCells)\n        .data(gup.repeat, gup.keyFun);\n\n    columnCells.enter()\n        .append('g')\n        .classed(c.cn.columnCells, true);\n\n    columnCells.exit()\n        .remove();\n\n    return columnCells;\n}\n\nfunction renderColumnCell(columnCells) {\n    var columnCell = columnCells.selectAll('.' + c.cn.columnCell)\n        .data(splitData.splitToCells, function(d) {return d.keyWithinBlock;});\n\n    columnCell.enter()\n        .append('g')\n        .classed(c.cn.columnCell, true);\n\n    columnCell.exit()\n        .remove();\n\n    return columnCell;\n}\n\nfunction renderCellRect(columnCell) {\n    var cellRect = columnCell.selectAll('.' + c.cn.cellRect)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellRect.enter()\n        .append('rect')\n        .classed(c.cn.cellRect, true);\n\n    return cellRect;\n}\n\nfunction renderCellText(cellTextHolder) {\n    var cellText = cellTextHolder.selectAll('.' + c.cn.cellText)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellText.enter()\n        .append('text')\n        .classed(c.cn.cellText, true)\n        .style('cursor', function() {return 'auto';})\n        .on('mousedown', function() {d3.event.stopPropagation();});\n\n    return cellText;\n}\n\nfunction renderCellTextHolder(columnCell) {\n    var cellTextHolder = columnCell.selectAll('.' + c.cn.cellTextHolder)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellTextHolder.enter()\n        .append('g')\n        .classed(c.cn.cellTextHolder, true)\n        .style('shape-rendering', 'geometricPrecision');\n\n    return cellTextHolder;\n}\n\nfunction supplyStylingValues(columnCell) {\n    columnCell\n        .each(function(d, i) {\n            var spec = d.calcdata.cells.font;\n            var col = d.column.specIndex;\n            var font = {\n                size: gridPick(spec.size, col, i),\n                color: gridPick(spec.color, col, i),\n                family: gridPick(spec.family, col, i)\n            };\n            d.rowNumber = d.key;\n            d.align = gridPick(d.calcdata.cells.align, col, i);\n            d.cellBorderWidth = gridPick(d.calcdata.cells.line.width, col, i);\n            d.font = font;\n        });\n}\n\nfunction setFont(cellText) {\n    cellText\n        .each(function(d) {\n            Drawing.font(d3.select(this), d.font);\n        });\n}\n\nfunction sizeAndStyleRect(cellRect) {\n    cellRect\n        .attr('width', function(d) {return d.column.columnWidth;})\n        .attr('stroke-width', function(d) {return d.cellBorderWidth;})\n        .each(function(d) {\n            var atomicSelection = d3.select(this);\n            Color.stroke(atomicSelection, gridPick(d.calcdata.cells.line.color, d.column.specIndex, d.rowNumber));\n            Color.fill(atomicSelection, gridPick(d.calcdata.cells.fill.color, d.column.specIndex, d.rowNumber));\n        });\n}\n\nfunction populateCellText(cellText, tableControlView, allColumnBlock, gd) {\n    cellText\n        .text(function(d) {\n            var col = d.column.specIndex;\n            var row = d.rowNumber;\n\n            var userSuppliedContent = d.value;\n            var stringSupplied = (typeof userSuppliedContent === 'string');\n            var hasBreaks = stringSupplied && userSuppliedContent.match(/<br>/i);\n            var userBrokenText = !stringSupplied || hasBreaks;\n            d.mayHaveMarkup = stringSupplied && userSuppliedContent.match(/[<&>]/);\n\n            var latex = isLatex(userSuppliedContent);\n            d.latex = latex;\n\n            var prefix = latex ? '' : gridPick(d.calcdata.cells.prefix, col, row) || '';\n            var suffix = latex ? '' : gridPick(d.calcdata.cells.suffix, col, row) || '';\n            var format = latex ? null : gridPick(d.calcdata.cells.format, col, row) || null;\n\n            var prefixSuffixedText = prefix + (format ? numberFormat(format)(d.value) : d.value) + suffix;\n\n            var hasWrapSplitCharacter;\n            d.wrappingNeeded = !d.wrapped && !userBrokenText && !latex && (hasWrapSplitCharacter = hasWrapCharacter(prefixSuffixedText));\n            d.cellHeightMayIncrease = hasBreaks || latex || d.mayHaveMarkup || (hasWrapSplitCharacter === void(0) ? hasWrapCharacter(prefixSuffixedText) : hasWrapSplitCharacter);\n            d.needsConvertToTspans = d.mayHaveMarkup || d.wrappingNeeded || d.latex;\n\n            var textToRender;\n            if(d.wrappingNeeded) {\n                var hrefPreservedText = c.wrapSplitCharacter === ' ' ? prefixSuffixedText.replace(/<a href=/ig, '<a_href=') : prefixSuffixedText;\n                var fragments = hrefPreservedText.split(c.wrapSplitCharacter);\n                var hrefRestoredFragments = c.wrapSplitCharacter === ' ' ? fragments.map(function(frag) {return frag.replace(/<a_href=/ig, '<a href=');}) : fragments;\n                d.fragments = hrefRestoredFragments.map(function(f) {return {text: f, width: null};});\n                d.fragments.push({fragment: c.wrapSpacer, width: null});\n                textToRender = hrefRestoredFragments.join(c.lineBreaker) + c.lineBreaker + c.wrapSpacer;\n            } else {\n                delete d.fragments;\n                textToRender = prefixSuffixedText;\n            }\n\n            return textToRender;\n        })\n        .attr('dy', function(d) {\n            return d.needsConvertToTspans ? 0 : '0.75em';\n        })\n        .each(function(d) {\n            var element = this;\n            var selection = d3.select(element);\n\n            // finalize what's in the DOM\n\n            var renderCallback = d.wrappingNeeded ? wrapTextMaker : updateYPositionMaker;\n            if(d.needsConvertToTspans) {\n                svgUtil.convertToTspans(selection, gd, renderCallback(allColumnBlock, element, tableControlView, gd, d));\n            } else {\n                d3.select(element.parentNode)\n                    // basic cell adjustment - compliance with `cellPad`\n                    .attr('transform', function(d) {return strTranslate(xPosition(d), c.cellPad);})\n                    .attr('text-anchor', function(d) {\n                        return ({\n                            left: 'start',\n                            center: 'middle',\n                            right: 'end'\n                        })[d.align];\n                    });\n            }\n        });\n}\n\nfunction isLatex(content) {\n    return typeof content === 'string' && content.match(c.latexCheck);\n}\n\nfunction hasWrapCharacter(text) {return text.indexOf(c.wrapSplitCharacter) !== -1;}\n\nfunction columnMoved(gd, calcdata, indices) {\n    var o = calcdata.gdColumnsOriginalOrder;\n    calcdata.gdColumns.sort(function(a, b) {\n        return indices[o.indexOf(a)] - indices[o.indexOf(b)];\n    });\n\n    calcdata.columnorder = indices;\n\n    // TODO: there's no data here, but also this reordering is not reflected\n    // in gd.data or even gd._fullData.\n    // For now I will not attempt to persist this in _preGUI\n    gd.emit('plotly_restyle');\n}\n\nfunction gridPick(spec, col, row) {\n    if(Array.isArray(spec)) {\n        var column = spec[Math.min(col, spec.length - 1)];\n        if(Array.isArray(column)) {\n            return column[Math.min(row, column.length - 1)];\n        } else {\n            return column;\n        }\n    } else {\n        return spec;\n    }\n}\n\nfunction easeColumn(selection, d, y) {\n    selection\n        .transition()\n        .ease(c.releaseTransitionEase)\n        .duration(c.releaseTransitionDuration)\n        .attr('transform', strTranslate(d.x, y));\n}\n\nfunction cellsBlock(d) {return d.type === 'cells';}\nfunction headerBlock(d) {return d.type === 'header';}\n\n/**\n * Revolver panel and cell contents layouting\n */\n\nfunction headerHeight(d) {\n    var headerBlocks = d.rowBlocks.length ? d.rowBlocks[0].auxiliaryBlocks : [];\n    return headerBlocks.reduce(function(p, n) {return p + rowsHeight(n, Infinity);}, 0);\n}\n\nfunction findPagesAndCacheHeights(blocks, scrollY, scrollHeight) {\n    var pages = [];\n    var pTop = 0;\n\n    for(var blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n        var block = blocks[blockIndex];\n        var blockRows = block.rows;\n        var rowsHeight = 0;\n        for(var i = 0; i < blockRows.length; i++) {\n            rowsHeight += blockRows[i].rowHeight;\n        }\n\n        // caching allRowsHeight on the block - it's safe as this function is always called from within the code part\n        // that handles increases to row heights\n        block.allRowsHeight = rowsHeight;\n\n        var pBottom = pTop + rowsHeight;\n        var windowTop = scrollY;\n        var windowBottom = windowTop + scrollHeight;\n        if(windowTop < pBottom && windowBottom > pTop) {\n            pages.push(blockIndex);\n        }\n        pTop += rowsHeight;\n\n        // consider this nice final optimization; put it in `for` condition - caveat, currently the\n        // block.allRowsHeight relies on being invalidated, so enabling this opt may not be safe\n        // if(pages.length > 1) break;\n    }\n\n    return pages;\n}\n\nfunction updateBlockYPosition(gd, cellsColumnBlock, tableControlView) {\n    var d = flatData(cellsColumnBlock)[0];\n    if(d === undefined) return;\n    var blocks = d.rowBlocks;\n    var calcdata = d.calcdata;\n\n    var bottom = firstRowAnchor(blocks, blocks.length);\n    var scrollHeight = d.calcdata.groupHeight - headerHeight(d);\n    var scrollY = calcdata.scrollY = Math.max(0, Math.min(bottom - scrollHeight, calcdata.scrollY));\n\n    var pages = findPagesAndCacheHeights(blocks, scrollY, scrollHeight);\n    if(pages.length === 1) {\n        if(pages[0] === blocks.length - 1) {\n            pages.unshift(pages[0] - 1);\n        } else {\n            pages.push(pages[0] + 1);\n        }\n    }\n\n    // make phased out page jump by 2 while leaving stationary page intact\n    if(pages[0] % 2) {\n        pages.reverse();\n    }\n\n    cellsColumnBlock\n        .each(function(d, i) {\n            // these values will also be needed when a block is translated again due to growing cell height\n            d.page = pages[i];\n            d.scrollY = scrollY;\n        });\n\n    cellsColumnBlock\n        .attr('transform', function(d) {\n            var yTranslate = firstRowAnchor(d.rowBlocks, d.page) - d.scrollY;\n            return strTranslate(0, yTranslate);\n        });\n\n    // conditionally rerendering panel 0 and 1\n    if(gd) {\n        conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 0);\n        conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 1);\n        renderScrollbarKit(tableControlView, gd);\n    }\n}\n\nfunction makeDragRow(gd, allTableControlView, optionalMultiplier, optionalPosition) {\n    return function dragRow(eventD) {\n        // may come from whichever DOM event target: drag, wheel, bar... eventD corresponds to event target\n        var d = eventD.calcdata ? eventD.calcdata : eventD;\n        var tableControlView = allTableControlView.filter(function(dd) {return d.key === dd.key;});\n        var multiplier = optionalMultiplier || d.scrollbarState.dragMultiplier;\n\n        var initialScrollY = d.scrollY;\n\n        d.scrollY = optionalPosition === void(0) ? d.scrollY + multiplier * d3.event.dy : optionalPosition;\n        var cellsColumnBlock = tableControlView.selectAll('.' + c.cn.yColumn).selectAll('.' + c.cn.columnBlock).filter(cellsBlock);\n        updateBlockYPosition(gd, cellsColumnBlock, tableControlView);\n\n        // return false if we've \"used\" the scroll, ie it did something,\n        // so the event shouldn't bubble (if appropriate)\n        return d.scrollY === initialScrollY;\n    };\n}\n\nfunction conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, prevPages, d, revolverIndex) {\n    var shouldComponentUpdate = pages[revolverIndex] !== prevPages[revolverIndex];\n    if(shouldComponentUpdate) {\n        clearTimeout(d.currentRepaint[revolverIndex]);\n        d.currentRepaint[revolverIndex] = setTimeout(function() {\n            // setTimeout might lag rendering but yields a smoother scroll, because fast scrolling makes\n            // some repaints invisible ie. wasteful (DOM work blocks the main thread)\n            var toRerender = cellsColumnBlock.filter(function(d, i) {return i === revolverIndex && pages[i] !== prevPages[i];});\n            renderColumnCellTree(gd, tableControlView, toRerender, cellsColumnBlock);\n            prevPages[revolverIndex] = pages[revolverIndex];\n        });\n    }\n}\n\nfunction wrapTextMaker(columnBlock, element, tableControlView, gd) {\n    return function wrapText() {\n        var cellTextHolder = d3.select(element.parentNode);\n        cellTextHolder\n            .each(function(d) {\n                var fragments = d.fragments;\n                cellTextHolder.selectAll('tspan.line').each(function(dd, i) {\n                    fragments[i].width = this.getComputedTextLength();\n                });\n                // last element is only for measuring the separator character, so it's ignored:\n                var separatorLength = fragments[fragments.length - 1].width;\n                var rest = fragments.slice(0, -1);\n                var currentRow = [];\n                var currentAddition, currentAdditionLength;\n                var currentRowLength = 0;\n                var rowLengthLimit = d.column.columnWidth - 2 * c.cellPad;\n                d.value = '';\n                while(rest.length) {\n                    currentAddition = rest.shift();\n                    currentAdditionLength = currentAddition.width + separatorLength;\n                    if(currentRowLength + currentAdditionLength > rowLengthLimit) {\n                        d.value += currentRow.join(c.wrapSpacer) + c.lineBreaker;\n                        currentRow = [];\n                        currentRowLength = 0;\n                    }\n                    currentRow.push(currentAddition.text);\n                    currentRowLength += currentAdditionLength;\n                }\n                if(currentRowLength) {\n                    d.value += currentRow.join(c.wrapSpacer);\n                }\n                d.wrapped = true;\n            });\n\n        // the pre-wrapped text was rendered only for the text measurements\n        cellTextHolder.selectAll('tspan.line').remove();\n\n        // resupply text, now wrapped\n        populateCellText(cellTextHolder.select('.' + c.cn.cellText), tableControlView, columnBlock, gd);\n        d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY);\n    };\n}\n\nfunction updateYPositionMaker(columnBlock, element, tableControlView, gd, d) {\n    return function updateYPosition() {\n        if(d.settledY) return;\n        var cellTextHolder = d3.select(element.parentNode);\n        var l = getBlock(d);\n        var rowIndex = d.key - l.firstRowIndex;\n\n        var declaredRowHeight = l.rows[rowIndex].rowHeight;\n\n        var requiredHeight = d.cellHeightMayIncrease ? element.parentNode.getBoundingClientRect().height + 2 * c.cellPad : declaredRowHeight;\n\n        var finalHeight = Math.max(requiredHeight, declaredRowHeight);\n        var increase = finalHeight - l.rows[rowIndex].rowHeight;\n\n        if(increase) {\n            // current row height increased\n            l.rows[rowIndex].rowHeight = finalHeight;\n\n            columnBlock\n                .selectAll('.' + c.cn.columnCell)\n                .call(setCellHeightAndPositionY);\n\n            updateBlockYPosition(null, columnBlock.filter(cellsBlock), 0);\n\n            // if d.column.type === 'header', then the scrollbar has to be pushed downward to the scrollable area\n            // if d.column.type === 'cells', it can still be relevant if total scrolling content height is less than the\n            //                               scrollable window, as increases to row heights may need scrollbar updates\n            renderScrollbarKit(tableControlView, gd, true);\n        }\n\n        cellTextHolder\n            .attr('transform', function() {\n                // this code block is only invoked for items where d.cellHeightMayIncrease is truthy\n                var element = this;\n                var columnCellElement = element.parentNode;\n                var box = columnCellElement.getBoundingClientRect();\n                var rectBox = d3.select(element.parentNode).select('.' + c.cn.cellRect).node().getBoundingClientRect();\n                var currentTransform = element.transform.baseVal.consolidate();\n                var yPosition = rectBox.top - box.top + (currentTransform ? currentTransform.matrix.f : c.cellPad);\n                return strTranslate(xPosition(d, d3.select(element.parentNode).select('.' + c.cn.cellTextHolder).node().getBoundingClientRect().width), yPosition);\n            });\n\n        d.settledY = true;\n    };\n}\n\nfunction xPosition(d, optionalWidth) {\n    switch(d.align) {\n        case 'left': return c.cellPad;\n        case 'right': return d.column.columnWidth - (optionalWidth || 0) - c.cellPad;\n        case 'center': return (d.column.columnWidth - (optionalWidth || 0)) / 2;\n        default: return c.cellPad;\n    }\n}\n\nfunction setCellHeightAndPositionY(columnCell) {\n    columnCell\n        .attr('transform', function(d) {\n            var headerHeight = d.rowBlocks[0].auxiliaryBlocks.reduce(function(p, n) {return p + rowsHeight(n, Infinity);}, 0);\n            var l = getBlock(d);\n            var rowAnchor = rowsHeight(l, d.key);\n            var yOffset = rowAnchor + headerHeight;\n            return strTranslate(0, yOffset);\n        })\n        .selectAll('.' + c.cn.cellRect)\n        .attr('height', function(d) {return getRow(getBlock(d), d.key).rowHeight;});\n}\n\nfunction firstRowAnchor(blocks, page) {\n    var total = 0;\n    for(var i = page - 1; i >= 0; i--) {\n        total += allRowsHeight(blocks[i]);\n    }\n    return total;\n}\n\nfunction rowsHeight(rowBlock, key) {\n    var total = 0;\n    for(var i = 0; i < rowBlock.rows.length && rowBlock.rows[i].rowIndex < key; i++) {\n        total += rowBlock.rows[i].rowHeight;\n    }\n    return total;\n}\n\nfunction allRowsHeight(rowBlock) {\n    var cached = rowBlock.allRowsHeight;\n\n    if(cached !== void(0)) {\n        return cached;\n    }\n\n    var total = 0;\n    for(var i = 0; i < rowBlock.rows.length; i++) {\n        total += rowBlock.rows[i].rowHeight;\n    }\n    rowBlock.allRowsHeight = total;\n\n    return total;\n}\n\nfunction getBlock(d) {return d.rowBlocks[d.page];}\nfunction getRow(l, i) {return l.rows[i - l.firstRowIndex];}\n"]},"metadata":{},"sourceType":"script"}