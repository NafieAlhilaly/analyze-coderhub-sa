{"ast":null,"code":"'use strict';\n\nvar isNumeric = require('fast-isnumeric');\n\nvar tinycolor = require('tinycolor2');\n\nvar baseTraceAttrs = require('../plots/attributes');\n\nvar colorscales = require('../components/colorscale/scales');\n\nvar Color = require('../components/color');\n\nvar DESELECTDIM = require('../constants/interactions').DESELECTDIM;\n\nvar nestedProperty = require('./nested_property');\n\nvar counterRegex = require('./regex').counter;\n\nvar modHalf = require('./mod').modHalf;\n\nvar isArrayOrTypedArray = require('./array').isArrayOrTypedArray;\n\nexports.valObjectMeta = {\n  data_array: {\n    // You can use *dflt=[] to force said array to exist though.\n    description: ['An {array} of data.', 'The value MUST be an {array}, or we ignore it.', 'Note that typed arrays (e.g. Float32Array) are supported.'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt'],\n    coerceFunction: function (v, propOut, dflt) {\n      // TODO maybe `v: {type: 'float32', vals: [/* ... */]}` also\n      if (isArrayOrTypedArray(v)) propOut.set(v);else if (dflt !== undefined) propOut.set(dflt);\n    }\n  },\n  enumerated: {\n    description: ['Enumerated value type. The available values are listed', 'in `values`.'].join(' '),\n    requiredOpts: ['values'],\n    otherOpts: ['dflt', 'coerceNumber', 'arrayOk'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      if (opts.coerceNumber) v = +v;\n      if (opts.values.indexOf(v) === -1) propOut.set(dflt);else propOut.set(v);\n    },\n    validateFunction: function (v, opts) {\n      if (opts.coerceNumber) v = +v;\n      var values = opts.values;\n\n      for (var i = 0; i < values.length; i++) {\n        var k = String(values[i]);\n\n        if (k.charAt(0) === '/' && k.charAt(k.length - 1) === '/') {\n          var regex = new RegExp(k.substr(1, k.length - 2));\n          if (regex.test(v)) return true;\n        } else if (v === values[i]) return true;\n      }\n\n      return false;\n    }\n  },\n  'boolean': {\n    description: 'A boolean (true/false) value.',\n    requiredOpts: [],\n    otherOpts: ['dflt'],\n    coerceFunction: function (v, propOut, dflt) {\n      if (v === true || v === false) propOut.set(v);else propOut.set(dflt);\n    }\n  },\n  number: {\n    description: ['A number or a numeric value', '(e.g. a number inside a string).', 'When applicable, values greater (less) than `max` (`min`)', 'are coerced to the `dflt`.'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt', 'min', 'max', 'arrayOk'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      if (!isNumeric(v) || opts.min !== undefined && v < opts.min || opts.max !== undefined && v > opts.max) {\n        propOut.set(dflt);\n      } else propOut.set(+v);\n    }\n  },\n  integer: {\n    description: ['An integer or an integer inside a string.', 'When applicable, values greater (less) than `max` (`min`)', 'are coerced to the `dflt`.'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt', 'min', 'max', 'arrayOk'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      if (v % 1 || !isNumeric(v) || opts.min !== undefined && v < opts.min || opts.max !== undefined && v > opts.max) {\n        propOut.set(dflt);\n      } else propOut.set(+v);\n    }\n  },\n  string: {\n    description: ['A string value.', 'Numbers are converted to strings except for attributes with', '`strict` set to true.'].join(' '),\n    requiredOpts: [],\n    // TODO 'values shouldn't be in there (edge case: 'dash' in Scatter)\n    otherOpts: ['dflt', 'noBlank', 'strict', 'arrayOk', 'values'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      if (typeof v !== 'string') {\n        var okToCoerce = typeof v === 'number';\n        if (opts.strict === true || !okToCoerce) propOut.set(dflt);else propOut.set(String(v));\n      } else if (opts.noBlank && !v) propOut.set(dflt);else propOut.set(v);\n    }\n  },\n  color: {\n    description: ['A string describing color.', 'Supported formats:', '- hex (e.g. \\'#d3d3d3\\')', '- rgb (e.g. \\'rgb(255, 0, 0)\\')', '- rgba (e.g. \\'rgb(255, 0, 0, 0.5)\\')', '- hsl (e.g. \\'hsl(0, 100%, 50%)\\')', '- hsv (e.g. \\'hsv(0, 100%, 100%)\\')', '- named colors (full list: http://www.w3.org/TR/css3-color/#svg-color)'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt', 'arrayOk'],\n    coerceFunction: function (v, propOut, dflt) {\n      if (tinycolor(v).isValid()) propOut.set(v);else propOut.set(dflt);\n    }\n  },\n  colorlist: {\n    description: ['A list of colors.', 'Must be an {array} containing valid colors.'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt'],\n    coerceFunction: function (v, propOut, dflt) {\n      function isColor(color) {\n        return tinycolor(color).isValid();\n      }\n\n      if (!Array.isArray(v) || !v.length) propOut.set(dflt);else if (v.every(isColor)) propOut.set(v);else propOut.set(dflt);\n    }\n  },\n  colorscale: {\n    description: ['A Plotly colorscale either picked by a name:', '(any of', Object.keys(colorscales.scales).join(', '), ')', 'customized as an {array} of 2-element {arrays} where', 'the first element is the normalized color level value', '(starting at *0* and ending at *1*),', 'and the second item is a valid color string.'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt'],\n    coerceFunction: function (v, propOut, dflt) {\n      propOut.set(colorscales.get(v, dflt));\n    }\n  },\n  angle: {\n    description: ['A number (in degree) between -180 and 180.'].join(' '),\n    requiredOpts: [],\n    otherOpts: ['dflt'],\n    coerceFunction: function (v, propOut, dflt) {\n      if (v === 'auto') propOut.set('auto');else if (!isNumeric(v)) propOut.set(dflt);else propOut.set(modHalf(+v, 360));\n    }\n  },\n  subplotid: {\n    description: ['An id string of a subplot type (given by dflt), optionally', 'followed by an integer >1. e.g. if dflt=\\'geo\\', we can have', '\\'geo\\', \\'geo2\\', \\'geo3\\', ...'].join(' '),\n    requiredOpts: ['dflt'],\n    otherOpts: ['regex'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      var regex = opts.regex || counterRegex(dflt);\n\n      if (typeof v === 'string' && regex.test(v)) {\n        propOut.set(v);\n        return;\n      }\n\n      propOut.set(dflt);\n    },\n    validateFunction: function (v, opts) {\n      var dflt = opts.dflt;\n      if (v === dflt) return true;\n      if (typeof v !== 'string') return false;\n      if (counterRegex(dflt).test(v)) return true;\n      return false;\n    }\n  },\n  flaglist: {\n    description: ['A string representing a combination of flags', '(order does not matter here).', 'Combine any of the available `flags` with *+*.', '(e.g. (\\'lines+markers\\')).', 'Values in `extras` cannot be combined.'].join(' '),\n    requiredOpts: ['flags'],\n    otherOpts: ['dflt', 'extras', 'arrayOk'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      if (typeof v !== 'string') {\n        propOut.set(dflt);\n        return;\n      }\n\n      if ((opts.extras || []).indexOf(v) !== -1) {\n        propOut.set(v);\n        return;\n      }\n\n      var vParts = v.split('+');\n      var i = 0;\n\n      while (i < vParts.length) {\n        var vi = vParts[i];\n\n        if (opts.flags.indexOf(vi) === -1 || vParts.indexOf(vi) < i) {\n          vParts.splice(i, 1);\n        } else i++;\n      }\n\n      if (!vParts.length) propOut.set(dflt);else propOut.set(vParts.join('+'));\n    }\n  },\n  any: {\n    description: 'Any type.',\n    requiredOpts: [],\n    otherOpts: ['dflt', 'values', 'arrayOk'],\n    coerceFunction: function (v, propOut, dflt) {\n      if (v === undefined) propOut.set(dflt);else propOut.set(v);\n    }\n  },\n  info_array: {\n    description: ['An {array} of plot information.'].join(' '),\n    requiredOpts: ['items'],\n    // set `dimensions=2` for a 2D array or '1-2' for either\n    // `items` may be a single object instead of an array, in which case\n    // `freeLength` must be true.\n    // if `dimensions='1-2'` and items is a 1D array, then the value can\n    // either be a matching 1D array or an array of such matching 1D arrays\n    otherOpts: ['dflt', 'freeLength', 'dimensions'],\n    coerceFunction: function (v, propOut, dflt, opts) {\n      // simplified coerce function just for array items\n      function coercePart(v, opts, dflt) {\n        var out;\n        var propPart = {\n          set: function (v) {\n            out = v;\n          }\n        };\n        if (dflt === undefined) dflt = opts.dflt;\n        exports.valObjectMeta[opts.valType].coerceFunction(v, propPart, dflt, opts);\n        return out;\n      }\n\n      var twoD = opts.dimensions === 2 || opts.dimensions === '1-2' && Array.isArray(v) && Array.isArray(v[0]);\n\n      if (!Array.isArray(v)) {\n        propOut.set(dflt);\n        return;\n      }\n\n      var items = opts.items;\n      var vOut = [];\n      var arrayItems = Array.isArray(items);\n      var arrayItems2D = arrayItems && twoD && Array.isArray(items[0]);\n      var innerItemsOnly = twoD && arrayItems && !arrayItems2D;\n      var len = arrayItems && !innerItemsOnly ? items.length : v.length;\n      var i, j, row, item, len2, vNew;\n      dflt = Array.isArray(dflt) ? dflt : [];\n\n      if (twoD) {\n        for (i = 0; i < len; i++) {\n          vOut[i] = [];\n          row = Array.isArray(v[i]) ? v[i] : [];\n          if (innerItemsOnly) len2 = items.length;else if (arrayItems) len2 = items[i].length;else len2 = row.length;\n\n          for (j = 0; j < len2; j++) {\n            if (innerItemsOnly) item = items[j];else if (arrayItems) item = items[i][j];else item = items;\n            vNew = coercePart(row[j], item, (dflt[i] || [])[j]);\n            if (vNew !== undefined) vOut[i][j] = vNew;\n          }\n        }\n      } else {\n        for (i = 0; i < len; i++) {\n          vNew = coercePart(v[i], arrayItems ? items[i] : items, dflt[i]);\n          if (vNew !== undefined) vOut[i] = vNew;\n        }\n      }\n\n      propOut.set(vOut);\n    },\n    validateFunction: function (v, opts) {\n      if (!Array.isArray(v)) return false;\n      var items = opts.items;\n      var arrayItems = Array.isArray(items);\n      var twoD = opts.dimensions === 2; // when free length is off, input and declared lengths must match\n\n      if (!opts.freeLength && v.length !== items.length) return false; // valid when all input items are valid\n\n      for (var i = 0; i < v.length; i++) {\n        if (twoD) {\n          if (!Array.isArray(v[i]) || !opts.freeLength && v[i].length !== items[i].length) {\n            return false;\n          }\n\n          for (var j = 0; j < v[i].length; j++) {\n            if (!validate(v[i][j], arrayItems ? items[i][j] : items)) {\n              return false;\n            }\n          }\n        } else if (!validate(v[i], arrayItems ? items[i] : items)) return false;\n      }\n\n      return true;\n    }\n  }\n};\n/**\n * Ensures that container[attribute] has a valid value.\n *\n * attributes[attribute] is an object with possible keys:\n * - valType: data_array, enumerated, boolean, ... as in valObjectMeta\n * - values: (enumerated only) array of allowed vals\n * - min, max: (number, integer only) inclusive bounds on allowed vals\n *      either or both may be omitted\n * - dflt: if attribute is invalid or missing, use this default\n *      if dflt is provided as an argument to lib.coerce it takes precedence\n *      as a convenience, returns the value it finally set\n */\n\nexports.coerce = function (containerIn, containerOut, attributes, attribute, dflt) {\n  var opts = nestedProperty(attributes, attribute).get();\n  var propIn = nestedProperty(containerIn, attribute);\n  var propOut = nestedProperty(containerOut, attribute);\n  var v = propIn.get();\n  var template = containerOut._template;\n\n  if (v === undefined && template) {\n    v = nestedProperty(template, attribute).get(); // already used the template value, so short-circuit the second check\n\n    template = 0;\n  }\n\n  if (dflt === undefined) dflt = opts.dflt;\n  /**\n   * arrayOk: value MAY be an array, then we do no value checking\n   * at this point, because it can be more complicated than the\n   * individual form (eg. some array vals can be numbers, even if the\n   * single values must be color strings)\n   */\n\n  if (opts.arrayOk && isArrayOrTypedArray(v)) {\n    propOut.set(v);\n    return v;\n  }\n\n  var coerceFunction = exports.valObjectMeta[opts.valType].coerceFunction;\n  coerceFunction(v, propOut, dflt, opts);\n  var out = propOut.get(); // in case v was provided but invalid, try the template again so it still\n  // overrides the regular default\n\n  if (template && out === dflt && !validate(v, opts)) {\n    v = nestedProperty(template, attribute).get();\n    coerceFunction(v, propOut, dflt, opts);\n    out = propOut.get();\n  }\n\n  return out;\n};\n/**\n * Variation on coerce\n *\n * Uses coerce to get attribute value if user input is valid,\n * returns attribute default if user input it not valid or\n * returns false if there is no user input.\n */\n\n\nexports.coerce2 = function (containerIn, containerOut, attributes, attribute, dflt) {\n  var propIn = nestedProperty(containerIn, attribute);\n  var propOut = exports.coerce(containerIn, containerOut, attributes, attribute, dflt);\n  var valIn = propIn.get();\n  return valIn !== undefined && valIn !== null ? propOut : false;\n};\n/*\n * Shortcut to coerce the three font attributes\n *\n * 'coerce' is a lib.coerce wrapper with implied first three arguments\n */\n\n\nexports.coerceFont = function (coerce, attr, dfltObj) {\n  var out = {};\n  dfltObj = dfltObj || {};\n  out.family = coerce(attr + '.family', dfltObj.family);\n  out.size = coerce(attr + '.size', dfltObj.size);\n  out.color = coerce(attr + '.color', dfltObj.color);\n  return out;\n};\n/*\n * Shortcut to coerce the pattern attributes\n */\n\n\nexports.coercePattern = function (coerce, attr, markerColor, hasMarkerColorscale) {\n  var shape = coerce(attr + '.shape');\n\n  if (shape) {\n    coerce(attr + '.solidity');\n    coerce(attr + '.size');\n    var fillmode = coerce(attr + '.fillmode');\n    var isOverlay = fillmode === 'overlay';\n\n    if (!hasMarkerColorscale) {\n      var bgcolor = coerce(attr + '.bgcolor', isOverlay ? markerColor : undefined);\n      coerce(attr + '.fgcolor', isOverlay ? Color.contrast(bgcolor) : markerColor);\n    }\n\n    coerce(attr + '.fgopacity', isOverlay ? 0.5 : 1);\n  }\n};\n/** Coerce shortcut for 'hoverinfo'\n * handling 1-vs-multi-trace dflt logic\n *\n * @param {object} traceIn : user trace object\n * @param {object} traceOut : full trace object (requires _module ref)\n * @param {object} layoutOut : full layout object (require _dataLength ref)\n * @return {any} : the coerced value\n */\n\n\nexports.coerceHoverinfo = function (traceIn, traceOut, layoutOut) {\n  var moduleAttrs = traceOut._module.attributes;\n  var attrs = moduleAttrs.hoverinfo ? moduleAttrs : baseTraceAttrs;\n  var valObj = attrs.hoverinfo;\n  var dflt;\n\n  if (layoutOut._dataLength === 1) {\n    var flags = valObj.dflt === 'all' ? valObj.flags.slice() : valObj.dflt.split('+');\n    flags.splice(flags.indexOf('name'), 1);\n    dflt = flags.join('+');\n  }\n\n  return exports.coerce(traceIn, traceOut, attrs, 'hoverinfo', dflt);\n};\n/** Coerce shortcut for [un]selected.marker.opacity,\n *  which has special default logic, to ensure that it corresponds to the\n *  default selection behavior while allowing to be overtaken by any other\n *  [un]selected attribute.\n *\n *  N.B. This must be called *after* coercing all the other [un]selected attrs,\n *  to give the intended result.\n *\n * @param {object} traceOut : fullData item\n * @param {function} coerce : lib.coerce wrapper with implied first three arguments\n */\n\n\nexports.coerceSelectionMarkerOpacity = function (traceOut, coerce) {\n  if (!traceOut.marker) return;\n  var mo = traceOut.marker.opacity; // you can still have a `marker` container with no markers if there's text\n\n  if (mo === undefined) return;\n  var smoDflt;\n  var usmoDflt; // Don't give [un]selected.marker.opacity a default value if\n  // marker.opacity is an array: handle this during style step.\n  //\n  // Only give [un]selected.marker.opacity a default value if you don't\n  // set any other [un]selected attributes.\n\n  if (!isArrayOrTypedArray(mo) && !traceOut.selected && !traceOut.unselected) {\n    smoDflt = mo;\n    usmoDflt = DESELECTDIM * mo;\n  }\n\n  coerce('selected.marker.opacity', smoDflt);\n  coerce('unselected.marker.opacity', usmoDflt);\n};\n\nfunction validate(value, opts) {\n  var valObjectDef = exports.valObjectMeta[opts.valType];\n  if (opts.arrayOk && isArrayOrTypedArray(value)) return true;\n\n  if (valObjectDef.validateFunction) {\n    return valObjectDef.validateFunction(value, opts);\n  }\n\n  var failed = {};\n  var out = failed;\n  var propMock = {\n    set: function (v) {\n      out = v;\n    }\n  }; // 'failed' just something mutable that won't be === anything else\n\n  valObjectDef.coerceFunction(value, propMock, failed, opts);\n  return out !== failed;\n}\n\nexports.validate = validate;","map":{"version":3,"sources":["C:/Projects/reactApp/analyse_coderhub/node_modules/plotly.js/src/lib/coerce.js"],"names":["isNumeric","require","tinycolor","baseTraceAttrs","colorscales","Color","DESELECTDIM","nestedProperty","counterRegex","counter","modHalf","isArrayOrTypedArray","exports","valObjectMeta","data_array","description","join","requiredOpts","otherOpts","coerceFunction","v","propOut","dflt","set","undefined","enumerated","opts","coerceNumber","values","indexOf","validateFunction","i","length","k","String","charAt","regex","RegExp","substr","test","number","min","max","integer","string","okToCoerce","strict","noBlank","color","isValid","colorlist","isColor","Array","isArray","every","colorscale","Object","keys","scales","get","angle","subplotid","flaglist","extras","vParts","split","vi","flags","splice","any","info_array","coercePart","out","propPart","valType","twoD","dimensions","items","vOut","arrayItems","arrayItems2D","innerItemsOnly","len","j","row","item","len2","vNew","freeLength","validate","coerce","containerIn","containerOut","attributes","attribute","propIn","template","_template","arrayOk","coerce2","valIn","coerceFont","attr","dfltObj","family","size","coercePattern","markerColor","hasMarkerColorscale","shape","fillmode","isOverlay","bgcolor","contrast","coerceHoverinfo","traceIn","traceOut","layoutOut","moduleAttrs","_module","attrs","hoverinfo","valObj","_dataLength","slice","coerceSelectionMarkerOpacity","marker","mo","opacity","smoDflt","usmoDflt","selected","unselected","value","valObjectDef","failed","propMock"],"mappings":"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","sourcesContent":["'use strict';\n\nvar isNumeric = require('fast-isnumeric');\nvar tinycolor = require('tinycolor2');\n\nvar baseTraceAttrs = require('../plots/attributes');\nvar colorscales = require('../components/colorscale/scales');\nvar Color = require('../components/color');\nvar DESELECTDIM = require('../constants/interactions').DESELECTDIM;\n\nvar nestedProperty = require('./nested_property');\nvar counterRegex = require('./regex').counter;\nvar modHalf = require('./mod').modHalf;\nvar isArrayOrTypedArray = require('./array').isArrayOrTypedArray;\n\nexports.valObjectMeta = {\n    data_array: {\n        // You can use *dflt=[] to force said array to exist though.\n        description: [\n            'An {array} of data.',\n            'The value MUST be an {array}, or we ignore it.',\n            'Note that typed arrays (e.g. Float32Array) are supported.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            // TODO maybe `v: {type: 'float32', vals: [/* ... */]}` also\n            if(isArrayOrTypedArray(v)) propOut.set(v);\n            else if(dflt !== undefined) propOut.set(dflt);\n        }\n    },\n    enumerated: {\n        description: [\n            'Enumerated value type. The available values are listed',\n            'in `values`.'\n        ].join(' '),\n        requiredOpts: ['values'],\n        otherOpts: ['dflt', 'coerceNumber', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(opts.coerceNumber) v = +v;\n            if(opts.values.indexOf(v) === -1) propOut.set(dflt);\n            else propOut.set(v);\n        },\n        validateFunction: function(v, opts) {\n            if(opts.coerceNumber) v = +v;\n\n            var values = opts.values;\n            for(var i = 0; i < values.length; i++) {\n                var k = String(values[i]);\n\n                if((k.charAt(0) === '/' && k.charAt(k.length - 1) === '/')) {\n                    var regex = new RegExp(k.substr(1, k.length - 2));\n                    if(regex.test(v)) return true;\n                } else if(v === values[i]) return true;\n            }\n            return false;\n        }\n    },\n    'boolean': {\n        description: 'A boolean (true/false) value.',\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(v === true || v === false) propOut.set(v);\n            else propOut.set(dflt);\n        }\n    },\n    number: {\n        description: [\n            'A number or a numeric value',\n            '(e.g. a number inside a string).',\n            'When applicable, values greater (less) than `max` (`min`)',\n            'are coerced to the `dflt`.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt', 'min', 'max', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(!isNumeric(v) ||\n                    (opts.min !== undefined && v < opts.min) ||\n                    (opts.max !== undefined && v > opts.max)) {\n                propOut.set(dflt);\n            } else propOut.set(+v);\n        }\n    },\n    integer: {\n        description: [\n            'An integer or an integer inside a string.',\n            'When applicable, values greater (less) than `max` (`min`)',\n            'are coerced to the `dflt`.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt', 'min', 'max', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(v % 1 || !isNumeric(v) ||\n                    (opts.min !== undefined && v < opts.min) ||\n                    (opts.max !== undefined && v > opts.max)) {\n                propOut.set(dflt);\n            } else propOut.set(+v);\n        }\n    },\n    string: {\n        description: [\n            'A string value.',\n            'Numbers are converted to strings except for attributes with',\n            '`strict` set to true.'\n        ].join(' '),\n        requiredOpts: [],\n        // TODO 'values shouldn't be in there (edge case: 'dash' in Scatter)\n        otherOpts: ['dflt', 'noBlank', 'strict', 'arrayOk', 'values'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(typeof v !== 'string') {\n                var okToCoerce = (typeof v === 'number');\n\n                if(opts.strict === true || !okToCoerce) propOut.set(dflt);\n                else propOut.set(String(v));\n            } else if(opts.noBlank && !v) propOut.set(dflt);\n            else propOut.set(v);\n        }\n    },\n    color: {\n        description: [\n            'A string describing color.',\n            'Supported formats:',\n            '- hex (e.g. \\'#d3d3d3\\')',\n            '- rgb (e.g. \\'rgb(255, 0, 0)\\')',\n            '- rgba (e.g. \\'rgb(255, 0, 0, 0.5)\\')',\n            '- hsl (e.g. \\'hsl(0, 100%, 50%)\\')',\n            '- hsv (e.g. \\'hsv(0, 100%, 100%)\\')',\n            '- named colors (full list: http://www.w3.org/TR/css3-color/#svg-color)'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(tinycolor(v).isValid()) propOut.set(v);\n            else propOut.set(dflt);\n        }\n    },\n    colorlist: {\n        description: [\n            'A list of colors.',\n            'Must be an {array} containing valid colors.',\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            function isColor(color) {\n                return tinycolor(color).isValid();\n            }\n            if(!Array.isArray(v) || !v.length) propOut.set(dflt);\n            else if(v.every(isColor)) propOut.set(v);\n            else propOut.set(dflt);\n        }\n    },\n    colorscale: {\n        description: [\n            'A Plotly colorscale either picked by a name:',\n            '(any of', Object.keys(colorscales.scales).join(', '), ')',\n            'customized as an {array} of 2-element {arrays} where',\n            'the first element is the normalized color level value',\n            '(starting at *0* and ending at *1*),',\n            'and the second item is a valid color string.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            propOut.set(colorscales.get(v, dflt));\n        }\n    },\n    angle: {\n        description: [\n            'A number (in degree) between -180 and 180.'\n        ].join(' '),\n        requiredOpts: [],\n        otherOpts: ['dflt'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(v === 'auto') propOut.set('auto');\n            else if(!isNumeric(v)) propOut.set(dflt);\n            else propOut.set(modHalf(+v, 360));\n        }\n    },\n    subplotid: {\n        description: [\n            'An id string of a subplot type (given by dflt), optionally',\n            'followed by an integer >1. e.g. if dflt=\\'geo\\', we can have',\n            '\\'geo\\', \\'geo2\\', \\'geo3\\', ...'\n        ].join(' '),\n        requiredOpts: ['dflt'],\n        otherOpts: ['regex'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            var regex = opts.regex || counterRegex(dflt);\n            if(typeof v === 'string' && regex.test(v)) {\n                propOut.set(v);\n                return;\n            }\n            propOut.set(dflt);\n        },\n        validateFunction: function(v, opts) {\n            var dflt = opts.dflt;\n\n            if(v === dflt) return true;\n            if(typeof v !== 'string') return false;\n            if(counterRegex(dflt).test(v)) return true;\n\n            return false;\n        }\n    },\n    flaglist: {\n        description: [\n            'A string representing a combination of flags',\n            '(order does not matter here).',\n            'Combine any of the available `flags` with *+*.',\n            '(e.g. (\\'lines+markers\\')).',\n            'Values in `extras` cannot be combined.'\n        ].join(' '),\n        requiredOpts: ['flags'],\n        otherOpts: ['dflt', 'extras', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            if(typeof v !== 'string') {\n                propOut.set(dflt);\n                return;\n            }\n            if((opts.extras || []).indexOf(v) !== -1) {\n                propOut.set(v);\n                return;\n            }\n            var vParts = v.split('+');\n            var i = 0;\n            while(i < vParts.length) {\n                var vi = vParts[i];\n                if(opts.flags.indexOf(vi) === -1 || vParts.indexOf(vi) < i) {\n                    vParts.splice(i, 1);\n                } else i++;\n            }\n            if(!vParts.length) propOut.set(dflt);\n            else propOut.set(vParts.join('+'));\n        }\n    },\n    any: {\n        description: 'Any type.',\n        requiredOpts: [],\n        otherOpts: ['dflt', 'values', 'arrayOk'],\n        coerceFunction: function(v, propOut, dflt) {\n            if(v === undefined) propOut.set(dflt);\n            else propOut.set(v);\n        }\n    },\n    info_array: {\n        description: [\n            'An {array} of plot information.'\n        ].join(' '),\n        requiredOpts: ['items'],\n        // set `dimensions=2` for a 2D array or '1-2' for either\n        // `items` may be a single object instead of an array, in which case\n        // `freeLength` must be true.\n        // if `dimensions='1-2'` and items is a 1D array, then the value can\n        // either be a matching 1D array or an array of such matching 1D arrays\n        otherOpts: ['dflt', 'freeLength', 'dimensions'],\n        coerceFunction: function(v, propOut, dflt, opts) {\n            // simplified coerce function just for array items\n            function coercePart(v, opts, dflt) {\n                var out;\n                var propPart = {set: function(v) { out = v; }};\n\n                if(dflt === undefined) dflt = opts.dflt;\n\n                exports.valObjectMeta[opts.valType].coerceFunction(v, propPart, dflt, opts);\n\n                return out;\n            }\n\n            var twoD = opts.dimensions === 2 || (opts.dimensions === '1-2' && Array.isArray(v) && Array.isArray(v[0]));\n\n            if(!Array.isArray(v)) {\n                propOut.set(dflt);\n                return;\n            }\n\n            var items = opts.items;\n            var vOut = [];\n            var arrayItems = Array.isArray(items);\n            var arrayItems2D = arrayItems && twoD && Array.isArray(items[0]);\n            var innerItemsOnly = twoD && arrayItems && !arrayItems2D;\n            var len = (arrayItems && !innerItemsOnly) ? items.length : v.length;\n\n            var i, j, row, item, len2, vNew;\n\n            dflt = Array.isArray(dflt) ? dflt : [];\n\n            if(twoD) {\n                for(i = 0; i < len; i++) {\n                    vOut[i] = [];\n                    row = Array.isArray(v[i]) ? v[i] : [];\n                    if(innerItemsOnly) len2 = items.length;\n                    else if(arrayItems) len2 = items[i].length;\n                    else len2 = row.length;\n\n                    for(j = 0; j < len2; j++) {\n                        if(innerItemsOnly) item = items[j];\n                        else if(arrayItems) item = items[i][j];\n                        else item = items;\n\n                        vNew = coercePart(row[j], item, (dflt[i] || [])[j]);\n                        if(vNew !== undefined) vOut[i][j] = vNew;\n                    }\n                }\n            } else {\n                for(i = 0; i < len; i++) {\n                    vNew = coercePart(v[i], arrayItems ? items[i] : items, dflt[i]);\n                    if(vNew !== undefined) vOut[i] = vNew;\n                }\n            }\n\n            propOut.set(vOut);\n        },\n        validateFunction: function(v, opts) {\n            if(!Array.isArray(v)) return false;\n\n            var items = opts.items;\n            var arrayItems = Array.isArray(items);\n            var twoD = opts.dimensions === 2;\n\n            // when free length is off, input and declared lengths must match\n            if(!opts.freeLength && v.length !== items.length) return false;\n\n            // valid when all input items are valid\n            for(var i = 0; i < v.length; i++) {\n                if(twoD) {\n                    if(!Array.isArray(v[i]) || (!opts.freeLength && v[i].length !== items[i].length)) {\n                        return false;\n                    }\n                    for(var j = 0; j < v[i].length; j++) {\n                        if(!validate(v[i][j], arrayItems ? items[i][j] : items)) {\n                            return false;\n                        }\n                    }\n                } else if(!validate(v[i], arrayItems ? items[i] : items)) return false;\n            }\n\n            return true;\n        }\n    }\n};\n\n/**\n * Ensures that container[attribute] has a valid value.\n *\n * attributes[attribute] is an object with possible keys:\n * - valType: data_array, enumerated, boolean, ... as in valObjectMeta\n * - values: (enumerated only) array of allowed vals\n * - min, max: (number, integer only) inclusive bounds on allowed vals\n *      either or both may be omitted\n * - dflt: if attribute is invalid or missing, use this default\n *      if dflt is provided as an argument to lib.coerce it takes precedence\n *      as a convenience, returns the value it finally set\n */\nexports.coerce = function(containerIn, containerOut, attributes, attribute, dflt) {\n    var opts = nestedProperty(attributes, attribute).get();\n    var propIn = nestedProperty(containerIn, attribute);\n    var propOut = nestedProperty(containerOut, attribute);\n    var v = propIn.get();\n\n    var template = containerOut._template;\n    if(v === undefined && template) {\n        v = nestedProperty(template, attribute).get();\n        // already used the template value, so short-circuit the second check\n        template = 0;\n    }\n\n    if(dflt === undefined) dflt = opts.dflt;\n\n    /**\n     * arrayOk: value MAY be an array, then we do no value checking\n     * at this point, because it can be more complicated than the\n     * individual form (eg. some array vals can be numbers, even if the\n     * single values must be color strings)\n     */\n    if(opts.arrayOk && isArrayOrTypedArray(v)) {\n        propOut.set(v);\n        return v;\n    }\n\n    var coerceFunction = exports.valObjectMeta[opts.valType].coerceFunction;\n    coerceFunction(v, propOut, dflt, opts);\n\n    var out = propOut.get();\n    // in case v was provided but invalid, try the template again so it still\n    // overrides the regular default\n    if(template && out === dflt && !validate(v, opts)) {\n        v = nestedProperty(template, attribute).get();\n        coerceFunction(v, propOut, dflt, opts);\n        out = propOut.get();\n    }\n    return out;\n};\n\n/**\n * Variation on coerce\n *\n * Uses coerce to get attribute value if user input is valid,\n * returns attribute default if user input it not valid or\n * returns false if there is no user input.\n */\nexports.coerce2 = function(containerIn, containerOut, attributes, attribute, dflt) {\n    var propIn = nestedProperty(containerIn, attribute);\n    var propOut = exports.coerce(containerIn, containerOut, attributes, attribute, dflt);\n    var valIn = propIn.get();\n\n    return (valIn !== undefined && valIn !== null) ? propOut : false;\n};\n\n/*\n * Shortcut to coerce the three font attributes\n *\n * 'coerce' is a lib.coerce wrapper with implied first three arguments\n */\nexports.coerceFont = function(coerce, attr, dfltObj) {\n    var out = {};\n\n    dfltObj = dfltObj || {};\n\n    out.family = coerce(attr + '.family', dfltObj.family);\n    out.size = coerce(attr + '.size', dfltObj.size);\n    out.color = coerce(attr + '.color', dfltObj.color);\n\n    return out;\n};\n\n/*\n * Shortcut to coerce the pattern attributes\n */\nexports.coercePattern = function(coerce, attr, markerColor, hasMarkerColorscale) {\n    var shape = coerce(attr + '.shape');\n    if(shape) {\n        coerce(attr + '.solidity');\n        coerce(attr + '.size');\n        var fillmode = coerce(attr + '.fillmode');\n        var isOverlay = fillmode === 'overlay';\n\n        if(!hasMarkerColorscale) {\n            var bgcolor = coerce(attr + '.bgcolor', isOverlay ?\n                markerColor :\n                undefined\n            );\n\n            coerce(attr + '.fgcolor', isOverlay ?\n                Color.contrast(bgcolor) :\n                markerColor\n            );\n        }\n\n        coerce(attr + '.fgopacity', isOverlay ?\n            0.5 :\n            1\n        );\n    }\n};\n\n/** Coerce shortcut for 'hoverinfo'\n * handling 1-vs-multi-trace dflt logic\n *\n * @param {object} traceIn : user trace object\n * @param {object} traceOut : full trace object (requires _module ref)\n * @param {object} layoutOut : full layout object (require _dataLength ref)\n * @return {any} : the coerced value\n */\nexports.coerceHoverinfo = function(traceIn, traceOut, layoutOut) {\n    var moduleAttrs = traceOut._module.attributes;\n    var attrs = moduleAttrs.hoverinfo ? moduleAttrs : baseTraceAttrs;\n\n    var valObj = attrs.hoverinfo;\n    var dflt;\n\n    if(layoutOut._dataLength === 1) {\n        var flags = valObj.dflt === 'all' ?\n            valObj.flags.slice() :\n            valObj.dflt.split('+');\n\n        flags.splice(flags.indexOf('name'), 1);\n        dflt = flags.join('+');\n    }\n\n    return exports.coerce(traceIn, traceOut, attrs, 'hoverinfo', dflt);\n};\n\n/** Coerce shortcut for [un]selected.marker.opacity,\n *  which has special default logic, to ensure that it corresponds to the\n *  default selection behavior while allowing to be overtaken by any other\n *  [un]selected attribute.\n *\n *  N.B. This must be called *after* coercing all the other [un]selected attrs,\n *  to give the intended result.\n *\n * @param {object} traceOut : fullData item\n * @param {function} coerce : lib.coerce wrapper with implied first three arguments\n */\nexports.coerceSelectionMarkerOpacity = function(traceOut, coerce) {\n    if(!traceOut.marker) return;\n\n    var mo = traceOut.marker.opacity;\n    // you can still have a `marker` container with no markers if there's text\n    if(mo === undefined) return;\n\n    var smoDflt;\n    var usmoDflt;\n\n    // Don't give [un]selected.marker.opacity a default value if\n    // marker.opacity is an array: handle this during style step.\n    //\n    // Only give [un]selected.marker.opacity a default value if you don't\n    // set any other [un]selected attributes.\n    if(!isArrayOrTypedArray(mo) && !traceOut.selected && !traceOut.unselected) {\n        smoDflt = mo;\n        usmoDflt = DESELECTDIM * mo;\n    }\n\n    coerce('selected.marker.opacity', smoDflt);\n    coerce('unselected.marker.opacity', usmoDflt);\n};\n\nfunction validate(value, opts) {\n    var valObjectDef = exports.valObjectMeta[opts.valType];\n\n    if(opts.arrayOk && isArrayOrTypedArray(value)) return true;\n\n    if(valObjectDef.validateFunction) {\n        return valObjectDef.validateFunction(value, opts);\n    }\n\n    var failed = {};\n    var out = failed;\n    var propMock = { set: function(v) { out = v; } };\n\n    // 'failed' just something mutable that won't be === anything else\n\n    valObjectDef.coerceFunction(value, propMock, failed, opts);\n    return out !== failed;\n}\nexports.validate = validate;\n"]},"metadata":{},"sourceType":"script"}