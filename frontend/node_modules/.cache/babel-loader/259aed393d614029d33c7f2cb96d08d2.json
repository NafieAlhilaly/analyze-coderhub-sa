{"ast":null,"code":"'use strict';\n\nmodule.exports = createAxes;\n\nvar createText = require('./lib/text.js');\n\nvar createLines = require('./lib/lines.js');\n\nvar createBackground = require('./lib/background.js');\n\nvar getCubeProperties = require('./lib/cube.js');\n\nvar Ticks = require('./lib/ticks.js');\n\nvar identity = new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);\n\nfunction copyVec3(a, b) {\n  a[0] = b[0];\n  a[1] = b[1];\n  a[2] = b[2];\n  return a;\n}\n\nfunction Axes(gl) {\n  this.gl = gl;\n  this.pixelRatio = 1;\n  this.bounds = [[-10, -10, -10], [10, 10, 10]];\n  this.ticks = [[], [], []];\n  this.autoTicks = true;\n  this.tickSpacing = [1, 1, 1];\n  this.tickEnable = [true, true, true];\n  this.tickFont = ['sans-serif', 'sans-serif', 'sans-serif'];\n  this.tickSize = [12, 12, 12];\n  this.tickAngle = [0, 0, 0];\n  this.tickAlign = ['auto', 'auto', 'auto'];\n  this.tickColor = [[0, 0, 0, 1], [0, 0, 0, 1], [0, 0, 0, 1]];\n  this.tickPad = [10, 10, 10];\n  this.lastCubeProps = {\n    cubeEdges: [0, 0, 0],\n    axis: [0, 0, 0]\n  };\n  this.labels = ['x', 'y', 'z'];\n  this.labelEnable = [true, true, true];\n  this.labelFont = 'sans-serif';\n  this.labelSize = [20, 20, 20];\n  this.labelAngle = [0, 0, 0];\n  this.labelAlign = ['auto', 'auto', 'auto'];\n  this.labelColor = [[0, 0, 0, 1], [0, 0, 0, 1], [0, 0, 0, 1]];\n  this.labelPad = [10, 10, 10];\n  this.lineEnable = [true, true, true];\n  this.lineMirror = [false, false, false];\n  this.lineWidth = [1, 1, 1];\n  this.lineColor = [[0, 0, 0, 1], [0, 0, 0, 1], [0, 0, 0, 1]];\n  this.lineTickEnable = [true, true, true];\n  this.lineTickMirror = [false, false, false];\n  this.lineTickLength = [0, 0, 0];\n  this.lineTickWidth = [1, 1, 1];\n  this.lineTickColor = [[0, 0, 0, 1], [0, 0, 0, 1], [0, 0, 0, 1]];\n  this.gridEnable = [true, true, true];\n  this.gridWidth = [1, 1, 1];\n  this.gridColor = [[0, 0, 0, 1], [0, 0, 0, 1], [0, 0, 0, 1]];\n  this.zeroEnable = [true, true, true];\n  this.zeroLineColor = [[0, 0, 0, 1], [0, 0, 0, 1], [0, 0, 0, 1]];\n  this.zeroLineWidth = [2, 2, 2];\n  this.backgroundEnable = [false, false, false];\n  this.backgroundColor = [[0.8, 0.8, 0.8, 0.5], [0.8, 0.8, 0.8, 0.5], [0.8, 0.8, 0.8, 0.5]];\n  this._firstInit = true;\n  this._text = null;\n  this._lines = null;\n  this._background = createBackground(gl);\n}\n\nvar proto = Axes.prototype;\n\nproto.update = function (options) {\n  options = options || {}; //Option parsing helper functions\n\n  function parseOption(nest, cons, name) {\n    if (name in options) {\n      var opt = options[name];\n      var prev = this[name];\n      var next;\n\n      if (nest ? Array.isArray(opt) && Array.isArray(opt[0]) : Array.isArray(opt)) {\n        this[name] = next = [cons(opt[0]), cons(opt[1]), cons(opt[2])];\n      } else {\n        this[name] = next = [cons(opt), cons(opt), cons(opt)];\n      }\n\n      for (var i = 0; i < 3; ++i) {\n        if (next[i] !== prev[i]) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  var NUMBER = parseOption.bind(this, false, Number);\n  var BOOLEAN = parseOption.bind(this, false, Boolean);\n  var STRING = parseOption.bind(this, false, String);\n  var COLOR = parseOption.bind(this, true, function (v) {\n    if (Array.isArray(v)) {\n      if (v.length === 3) {\n        return [+v[0], +v[1], +v[2], 1.0];\n      } else if (v.length === 4) {\n        return [+v[0], +v[1], +v[2], +v[3]];\n      }\n    }\n\n    return [0, 0, 0, 1];\n  }); //Tick marks and bounds\n\n  var nextTicks;\n  var ticksUpdate = false;\n  var boundsChanged = false;\n\n  if ('bounds' in options) {\n    var bounds = options.bounds;\n\n    i_loop: for (var i = 0; i < 2; ++i) {\n      for (var j = 0; j < 3; ++j) {\n        if (bounds[i][j] !== this.bounds[i][j]) {\n          boundsChanged = true;\n        }\n\n        this.bounds[i][j] = bounds[i][j];\n      }\n    }\n  }\n\n  if ('ticks' in options) {\n    nextTicks = options.ticks;\n    ticksUpdate = true;\n    this.autoTicks = false;\n\n    for (var i = 0; i < 3; ++i) {\n      this.tickSpacing[i] = 0.0;\n    }\n  } else if (NUMBER('tickSpacing')) {\n    this.autoTicks = true;\n    boundsChanged = true;\n  }\n\n  if (this._firstInit) {\n    if (!('ticks' in options || 'tickSpacing' in options)) {\n      this.autoTicks = true;\n    } //Force tick recomputation on first update\n\n\n    boundsChanged = true;\n    ticksUpdate = true;\n    this._firstInit = false;\n  }\n\n  if (boundsChanged && this.autoTicks) {\n    nextTicks = Ticks.create(this.bounds, this.tickSpacing);\n    ticksUpdate = true;\n  } //Compare next ticks to previous ticks, only update if needed\n\n\n  if (ticksUpdate) {\n    for (var i = 0; i < 3; ++i) {\n      nextTicks[i].sort(function (a, b) {\n        return a.x - b.x;\n      });\n    }\n\n    if (Ticks.equal(nextTicks, this.ticks)) {\n      ticksUpdate = false;\n    } else {\n      this.ticks = nextTicks;\n    }\n  } //Parse tick properties\n\n\n  BOOLEAN('tickEnable');\n\n  if (STRING('tickFont')) {\n    ticksUpdate = true; //If font changes, must rebuild vbo\n  }\n\n  NUMBER('tickSize');\n  NUMBER('tickAngle');\n  NUMBER('tickPad');\n  COLOR('tickColor'); //Axis labels\n\n  var labelUpdate = STRING('labels');\n\n  if (STRING('labelFont')) {\n    labelUpdate = true;\n  }\n\n  BOOLEAN('labelEnable');\n  NUMBER('labelSize');\n  NUMBER('labelPad');\n  COLOR('labelColor'); //Axis lines\n\n  BOOLEAN('lineEnable');\n  BOOLEAN('lineMirror');\n  NUMBER('lineWidth');\n  COLOR('lineColor'); //Axis line ticks\n\n  BOOLEAN('lineTickEnable');\n  BOOLEAN('lineTickMirror');\n  NUMBER('lineTickLength');\n  NUMBER('lineTickWidth');\n  COLOR('lineTickColor'); //Grid lines\n\n  BOOLEAN('gridEnable');\n  NUMBER('gridWidth');\n  COLOR('gridColor'); //Zero line\n\n  BOOLEAN('zeroEnable');\n  COLOR('zeroLineColor');\n  NUMBER('zeroLineWidth'); //Background\n\n  BOOLEAN('backgroundEnable');\n  COLOR('backgroundColor'); //Update text if necessary\n\n  if (!this._text) {\n    this._text = createText(this.gl, this.bounds, this.labels, this.labelFont, this.ticks, this.tickFont);\n  } else if (this._text && (labelUpdate || ticksUpdate)) {\n    this._text.update(this.bounds, this.labels, this.labelFont, this.ticks, this.tickFont);\n  } //Update lines if necessary\n\n\n  if (this._lines && ticksUpdate) {\n    this._lines.dispose();\n\n    this._lines = null;\n  }\n\n  if (!this._lines) {\n    this._lines = createLines(this.gl, this.bounds, this.ticks);\n  }\n};\n\nfunction OffsetInfo() {\n  this.primalOffset = [0, 0, 0];\n  this.primalMinor = [0, 0, 0];\n  this.mirrorOffset = [0, 0, 0];\n  this.mirrorMinor = [0, 0, 0];\n}\n\nvar LINE_OFFSET = [new OffsetInfo(), new OffsetInfo(), new OffsetInfo()];\n\nfunction computeLineOffset(result, i, bounds, cubeEdges, cubeAxis) {\n  var primalOffset = result.primalOffset;\n  var primalMinor = result.primalMinor;\n  var dualOffset = result.mirrorOffset;\n  var dualMinor = result.mirrorMinor;\n  var e = cubeEdges[i]; //Calculate offsets\n\n  for (var j = 0; j < 3; ++j) {\n    if (i === j) {\n      continue;\n    }\n\n    var a = primalOffset,\n        b = dualOffset,\n        c = primalMinor,\n        d = dualMinor;\n\n    if (e & 1 << j) {\n      a = dualOffset;\n      b = primalOffset;\n      c = dualMinor;\n      d = primalMinor;\n    }\n\n    a[j] = bounds[0][j];\n    b[j] = bounds[1][j];\n\n    if (cubeAxis[j] > 0) {\n      c[j] = -1;\n      d[j] = 0;\n    } else {\n      c[j] = 0;\n      d[j] = +1;\n    }\n  }\n}\n\nvar CUBE_ENABLE = [0, 0, 0];\nvar DEFAULT_PARAMS = {\n  model: identity,\n  view: identity,\n  projection: identity,\n  _ortho: false\n};\n\nproto.isOpaque = function () {\n  return true;\n};\n\nproto.isTransparent = function () {\n  return false;\n};\n\nproto.drawTransparent = function (params) {};\n\nvar ALIGN_OPTION_AUTO = 0; // i.e. as defined in the shader the text would rotate to stay upwards range: [-90,90]\n\nvar PRIMAL_MINOR = [0, 0, 0];\nvar MIRROR_MINOR = [0, 0, 0];\nvar PRIMAL_OFFSET = [0, 0, 0];\n\nproto.draw = function (params) {\n  params = params || DEFAULT_PARAMS;\n  var gl = this.gl; //Geometry for camera and axes\n\n  var model = params.model || identity;\n  var view = params.view || identity;\n  var projection = params.projection || identity;\n  var bounds = this.bounds;\n  var isOrtho = params._ortho || false; //Unpack axis info\n\n  var cubeParams = getCubeProperties(model, view, projection, bounds, isOrtho);\n  var cubeEdges = cubeParams.cubeEdges;\n  var cubeAxis = cubeParams.axis;\n  var cx = view[12];\n  var cy = view[13];\n  var cz = view[14];\n  var cw = view[15];\n  var orthoFix = isOrtho ? 2 : 1; // double up padding for orthographic ticks & labels\n\n  var pixelScaleF = orthoFix * this.pixelRatio * (projection[3] * cx + projection[7] * cy + projection[11] * cz + projection[15] * cw) / gl.drawingBufferHeight;\n\n  for (var i = 0; i < 3; ++i) {\n    this.lastCubeProps.cubeEdges[i] = cubeEdges[i];\n    this.lastCubeProps.axis[i] = cubeAxis[i];\n  } //Compute axis info\n\n\n  var lineOffset = LINE_OFFSET;\n\n  for (var i = 0; i < 3; ++i) {\n    computeLineOffset(LINE_OFFSET[i], i, this.bounds, cubeEdges, cubeAxis);\n  } //Set up state parameters\n\n\n  var gl = this.gl; //Draw background first\n\n  var cubeEnable = CUBE_ENABLE;\n\n  for (var i = 0; i < 3; ++i) {\n    if (this.backgroundEnable[i]) {\n      cubeEnable[i] = cubeAxis[i];\n    } else {\n      cubeEnable[i] = 0;\n    }\n  }\n\n  this._background.draw(model, view, projection, bounds, cubeEnable, this.backgroundColor); //Draw lines\n\n\n  this._lines.bind(model, view, projection, this); //First draw grid lines and zero lines\n\n\n  for (var i = 0; i < 3; ++i) {\n    var x = [0, 0, 0];\n\n    if (cubeAxis[i] > 0) {\n      x[i] = bounds[1][i];\n    } else {\n      x[i] = bounds[0][i];\n    } //Draw grid lines\n\n\n    for (var j = 0; j < 2; ++j) {\n      var u = (i + 1 + j) % 3;\n      var v = (i + 1 + (j ^ 1)) % 3;\n\n      if (this.gridEnable[u]) {\n        this._lines.drawGrid(u, v, this.bounds, x, this.gridColor[u], this.gridWidth[u] * this.pixelRatio);\n      }\n    } //Draw zero lines (need to do this AFTER all grid lines are drawn)\n\n\n    for (var j = 0; j < 2; ++j) {\n      var u = (i + 1 + j) % 3;\n      var v = (i + 1 + (j ^ 1)) % 3;\n\n      if (this.zeroEnable[v]) {\n        //Check if zero line in bounds\n        if (Math.min(bounds[0][v], bounds[1][v]) <= 0 && Math.max(bounds[0][v], bounds[1][v]) >= 0) {\n          this._lines.drawZero(u, v, this.bounds, x, this.zeroLineColor[v], this.zeroLineWidth[v] * this.pixelRatio);\n        }\n      }\n    }\n  } //Then draw axis lines and tick marks\n\n\n  for (var i = 0; i < 3; ++i) {\n    //Draw axis lines\n    if (this.lineEnable[i]) {\n      this._lines.drawAxisLine(i, this.bounds, lineOffset[i].primalOffset, this.lineColor[i], this.lineWidth[i] * this.pixelRatio);\n    }\n\n    if (this.lineMirror[i]) {\n      this._lines.drawAxisLine(i, this.bounds, lineOffset[i].mirrorOffset, this.lineColor[i], this.lineWidth[i] * this.pixelRatio);\n    } //Compute minor axes\n\n\n    var primalMinor = copyVec3(PRIMAL_MINOR, lineOffset[i].primalMinor);\n    var mirrorMinor = copyVec3(MIRROR_MINOR, lineOffset[i].mirrorMinor);\n    var tickLength = this.lineTickLength;\n\n    for (var j = 0; j < 3; ++j) {\n      var scaleFactor = pixelScaleF / model[5 * j];\n      primalMinor[j] *= tickLength[j] * scaleFactor;\n      mirrorMinor[j] *= tickLength[j] * scaleFactor;\n    } //Draw axis line ticks\n\n\n    if (this.lineTickEnable[i]) {\n      this._lines.drawAxisTicks(i, lineOffset[i].primalOffset, primalMinor, this.lineTickColor[i], this.lineTickWidth[i] * this.pixelRatio);\n    }\n\n    if (this.lineTickMirror[i]) {\n      this._lines.drawAxisTicks(i, lineOffset[i].mirrorOffset, mirrorMinor, this.lineTickColor[i], this.lineTickWidth[i] * this.pixelRatio);\n    }\n  }\n\n  this._lines.unbind(); //Draw text sprites\n\n\n  this._text.bind(model, view, projection, this.pixelRatio);\n\n  var alignOpt; // options in shader are from this list {-1, 0, 1, 2, 3, ..., n}\n  // -1: backward compatible\n  //  0: raw data\n  //  1: auto align, free angles\n  //  2: auto align, horizontal or vertical\n  //3-n: auto align, round to n directions e.g. 12 -> round to angles with 30-degree steps\n\n  var hv_ratio = 0.5; // can have an effect on the ratio between horizontals and verticals when using option 2\n\n  var enableAlign;\n  var alignDir;\n\n  function alignTo(i) {\n    alignDir = [0, 0, 0];\n    alignDir[i] = 1;\n  }\n\n  function solveTickAlignments(i, minor, major) {\n    var i1 = (i + 1) % 3;\n    var i2 = (i + 2) % 3;\n    var A = minor[i1];\n    var B = minor[i2];\n    var C = major[i1];\n    var D = major[i2];\n\n    if (A > 0 && D > 0) {\n      alignTo(i1);\n      return;\n    } else if (A > 0 && D < 0) {\n      alignTo(i1);\n      return;\n    } else if (A < 0 && D > 0) {\n      alignTo(i1);\n      return;\n    } else if (A < 0 && D < 0) {\n      alignTo(i1);\n      return;\n    } else if (B > 0 && C > 0) {\n      alignTo(i2);\n      return;\n    } else if (B > 0 && C < 0) {\n      alignTo(i2);\n      return;\n    } else if (B < 0 && C > 0) {\n      alignTo(i2);\n      return;\n    } else if (B < 0 && C < 0) {\n      alignTo(i2);\n      return;\n    }\n  }\n\n  for (var i = 0; i < 3; ++i) {\n    var minor = lineOffset[i].primalMinor;\n    var major = lineOffset[i].mirrorMinor;\n    var offset = copyVec3(PRIMAL_OFFSET, lineOffset[i].primalOffset);\n\n    for (var j = 0; j < 3; ++j) {\n      if (this.lineTickEnable[i]) {\n        offset[j] += pixelScaleF * minor[j] * Math.max(this.lineTickLength[j], 0) / model[5 * j];\n      }\n    }\n\n    var axis = [0, 0, 0];\n    axis[i] = 1; //Draw tick text\n\n    if (this.tickEnable[i]) {\n      if (this.tickAngle[i] === -3600) {\n        this.tickAngle[i] = 0;\n        this.tickAlign[i] = 'auto';\n      } else {\n        this.tickAlign[i] = -1;\n      }\n\n      enableAlign = 1;\n      alignOpt = [this.tickAlign[i], hv_ratio, enableAlign];\n      if (alignOpt[0] === 'auto') alignOpt[0] = ALIGN_OPTION_AUTO;else alignOpt[0] = parseInt('' + alignOpt[0]);\n      alignDir = [0, 0, 0];\n      solveTickAlignments(i, minor, major); //Add tick padding\n\n      for (var j = 0; j < 3; ++j) {\n        offset[j] += pixelScaleF * minor[j] * this.tickPad[j] / model[5 * j];\n      } //Draw axis\n\n\n      this._text.drawTicks(i, this.tickSize[i], this.tickAngle[i], offset, this.tickColor[i], axis, alignDir, alignOpt);\n    } //Draw labels\n\n\n    if (this.labelEnable[i]) {\n      enableAlign = 0;\n      alignDir = [0, 0, 0];\n\n      if (this.labels[i].length > 4) {\n        // for large label axis enable alignDir to axis\n        alignTo(i);\n        enableAlign = 1;\n      }\n\n      alignOpt = [this.labelAlign[i], hv_ratio, enableAlign];\n      if (alignOpt[0] === 'auto') alignOpt[0] = ALIGN_OPTION_AUTO;else alignOpt[0] = parseInt('' + alignOpt[0]); //Add label padding\n\n      for (var j = 0; j < 3; ++j) {\n        offset[j] += pixelScaleF * minor[j] * this.labelPad[j] / model[5 * j];\n      }\n\n      offset[i] += 0.5 * (bounds[0][i] + bounds[1][i]); //Draw axis\n\n      this._text.drawLabel(i, this.labelSize[i], this.labelAngle[i], offset, this.labelColor[i], [0, 0, 0], alignDir, alignOpt);\n    }\n  }\n\n  this._text.unbind();\n};\n\nproto.dispose = function () {\n  this._text.dispose();\n\n  this._lines.dispose();\n\n  this._background.dispose();\n\n  this._lines = null;\n  this._text = null;\n  this._background = null;\n  this.gl = null;\n};\n\nfunction createAxes(gl, options) {\n  var axes = new Axes(gl);\n  axes.update(options);\n  return axes;\n}","map":{"version":3,"sources":["C:/Projects/reactApp/frontend/node_modules/gl-axes3d/axes.js"],"names":["module","exports","createAxes","createText","require","createLines","createBackground","getCubeProperties","Ticks","identity","Float32Array","copyVec3","a","b","Axes","gl","pixelRatio","bounds","ticks","autoTicks","tickSpacing","tickEnable","tickFont","tickSize","tickAngle","tickAlign","tickColor","tickPad","lastCubeProps","cubeEdges","axis","labels","labelEnable","labelFont","labelSize","labelAngle","labelAlign","labelColor","labelPad","lineEnable","lineMirror","lineWidth","lineColor","lineTickEnable","lineTickMirror","lineTickLength","lineTickWidth","lineTickColor","gridEnable","gridWidth","gridColor","zeroEnable","zeroLineColor","zeroLineWidth","backgroundEnable","backgroundColor","_firstInit","_text","_lines","_background","proto","prototype","update","options","parseOption","nest","cons","name","opt","prev","next","Array","isArray","i","NUMBER","bind","Number","BOOLEAN","Boolean","STRING","String","COLOR","v","length","nextTicks","ticksUpdate","boundsChanged","i_loop","j","create","sort","x","equal","labelUpdate","dispose","OffsetInfo","primalOffset","primalMinor","mirrorOffset","mirrorMinor","LINE_OFFSET","computeLineOffset","result","cubeAxis","dualOffset","dualMinor","e","c","d","CUBE_ENABLE","DEFAULT_PARAMS","model","view","projection","_ortho","isOpaque","isTransparent","drawTransparent","params","ALIGN_OPTION_AUTO","PRIMAL_MINOR","MIRROR_MINOR","PRIMAL_OFFSET","draw","isOrtho","cubeParams","cx","cy","cz","cw","orthoFix","pixelScaleF","drawingBufferHeight","lineOffset","cubeEnable","u","drawGrid","Math","min","max","drawZero","drawAxisLine","tickLength","scaleFactor","drawAxisTicks","unbind","alignOpt","hv_ratio","enableAlign","alignDir","alignTo","solveTickAlignments","minor","major","i1","i2","A","B","C","D","offset","parseInt","drawTicks","drawLabel","axes"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,OAAP,GAAiBC,UAAjB;;AAEA,IAAIC,UAAU,GAAUC,OAAO,CAAC,eAAD,CAA/B;;AACA,IAAIC,WAAW,GAASD,OAAO,CAAC,gBAAD,CAA/B;;AACA,IAAIE,gBAAgB,GAAIF,OAAO,CAAC,qBAAD,CAA/B;;AACA,IAAIG,iBAAiB,GAAGH,OAAO,CAAC,eAAD,CAA/B;;AACA,IAAII,KAAK,GAAeJ,OAAO,CAAC,gBAAD,CAA/B;;AAEA,IAAIK,QAAQ,GAAG,IAAIC,YAAJ,CAAiB,CAC9B,CAD8B,EAC3B,CAD2B,EACxB,CADwB,EACrB,CADqB,EAE9B,CAF8B,EAE3B,CAF2B,EAExB,CAFwB,EAErB,CAFqB,EAG9B,CAH8B,EAG3B,CAH2B,EAGxB,CAHwB,EAGrB,CAHqB,EAI9B,CAJ8B,EAI3B,CAJ2B,EAIxB,CAJwB,EAIrB,CAJqB,CAAjB,CAAf;;AAMA,SAASC,QAAT,CAAkBC,CAAlB,EAAqBC,CAArB,EAAwB;AACtBD,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAAR;AACAD,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAAR;AACAD,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAAR;AACA,SAAOD,CAAP;AACD;;AAED,SAASE,IAAT,CAAcC,EAAd,EAAkB;AAChB,OAAKA,EAAL,GAAsBA,EAAtB;AAEA,OAAKC,UAAL,GAAsB,CAAtB;AAEA,OAAKC,MAAL,GAAsB,CAAE,CAAC,CAAC,EAAF,EAAM,CAAC,EAAP,EAAW,CAAC,EAAZ,CAAF,EACE,CAAE,EAAF,EAAO,EAAP,EAAY,EAAZ,CADF,CAAtB;AAEA,OAAKC,KAAL,GAAsB,CAAE,EAAF,EAAM,EAAN,EAAU,EAAV,CAAtB;AACA,OAAKC,SAAL,GAAsB,IAAtB;AACA,OAAKC,WAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AAEA,OAAKC,UAAL,GAAsB,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,CAAtB;AACA,OAAKC,QAAL,GAAsB,CAAE,YAAF,EAAgB,YAAhB,EAA8B,YAA9B,CAAtB;AACA,OAAKC,QAAL,GAAsB,CAAE,EAAF,EAAM,EAAN,EAAU,EAAV,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,MAAF,EAAU,MAAV,EAAkB,MAAlB,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAF,EAAa,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAb,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAxB,CAAtB;AACA,OAAKC,OAAL,GAAsB,CAAE,EAAF,EAAM,EAAN,EAAU,EAAV,CAAtB;AAEA,OAAKC,aAAL,GAAsB;AACpBC,IAAAA,SAAS,EAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CADS;AAEpBC,IAAAA,IAAI,EAAO,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL;AAFS,GAAtB;AAKA,OAAKC,MAAL,GAAsB,CAAE,GAAF,EAAO,GAAP,EAAY,GAAZ,CAAtB;AACA,OAAKC,WAAL,GAAsB,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,CAAtB;AACA,OAAKC,SAAL,GAAsB,YAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,EAAF,EAAM,EAAN,EAAU,EAAV,CAAtB;AACA,OAAKC,UAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AACA,OAAKC,UAAL,GAAsB,CAAE,MAAF,EAAU,MAAV,EAAkB,MAAlB,CAAtB;AACA,OAAKC,UAAL,GAAsB,CAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAF,EAAa,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAb,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAxB,CAAtB;AACA,OAAKC,QAAL,GAAsB,CAAE,EAAF,EAAM,EAAN,EAAU,EAAV,CAAtB;AAEA,OAAKC,UAAL,GAAsB,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,CAAtB;AACA,OAAKC,UAAL,GAAsB,CAAE,KAAF,EAAS,KAAT,EAAgB,KAAhB,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAF,EAAa,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAb,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAxB,CAAtB;AAEA,OAAKC,cAAL,GAAsB,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,CAAtB;AACA,OAAKC,cAAL,GAAsB,CAAE,KAAF,EAAS,KAAT,EAAgB,KAAhB,CAAtB;AACA,OAAKC,cAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AACA,OAAKC,aAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AACA,OAAKC,aAAL,GAAsB,CAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAF,EAAa,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAb,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAxB,CAAtB;AAEA,OAAKC,UAAL,GAAsB,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AACA,OAAKC,SAAL,GAAsB,CAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAF,EAAa,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAb,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAxB,CAAtB;AAEA,OAAKC,UAAL,GAAsB,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,CAAtB;AACA,OAAKC,aAAL,GAAsB,CAAE,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAF,EAAa,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAb,EAAwB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,CAAxB,CAAtB;AACA,OAAKC,aAAL,GAAsB,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAtB;AAEA,OAAKC,gBAAL,GAAwB,CAAE,KAAF,EAAS,KAAT,EAAgB,KAAhB,CAAxB;AACA,OAAKC,eAAL,GAAwB,CAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAAF,EACE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CADF,EAEE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAFF,CAAxB;AAIA,OAAKC,UAAL,GAAkB,IAAlB;AACA,OAAKC,KAAL,GAAc,IAAd;AACA,OAAKC,MAAL,GAAc,IAAd;AACA,OAAKC,WAAL,GAAmBrD,gBAAgB,CAACS,EAAD,CAAnC;AACD;;AAED,IAAI6C,KAAK,GAAG9C,IAAI,CAAC+C,SAAjB;;AAEAD,KAAK,CAACE,MAAN,GAAe,UAASC,OAAT,EAAkB;AAC/BA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB,CAD+B,CAG/B;;AACA,WAASC,WAAT,CAAqBC,IAArB,EAA2BC,IAA3B,EAAiCC,IAAjC,EAAuC;AACrC,QAAGA,IAAI,IAAIJ,OAAX,EAAoB;AAClB,UAAIK,GAAG,GAAGL,OAAO,CAACI,IAAD,CAAjB;AACA,UAAIE,IAAI,GAAG,KAAKF,IAAL,CAAX;AACA,UAAIG,IAAJ;;AACA,UAAGL,IAAI,GAAIM,KAAK,CAACC,OAAN,CAAcJ,GAAd,KAAsBG,KAAK,CAACC,OAAN,CAAcJ,GAAG,CAAC,CAAD,CAAjB,CAA1B,GACIG,KAAK,CAACC,OAAN,CAAcJ,GAAd,CADX,EACgC;AAC9B,aAAKD,IAAL,IAAaG,IAAI,GAAG,CAAEJ,IAAI,CAACE,GAAG,CAAC,CAAD,CAAJ,CAAN,EAAgBF,IAAI,CAACE,GAAG,CAAC,CAAD,CAAJ,CAApB,EAA8BF,IAAI,CAACE,GAAG,CAAC,CAAD,CAAJ,CAAlC,CAApB;AACD,OAHD,MAGO;AACL,aAAKD,IAAL,IAAaG,IAAI,GAAG,CAAEJ,IAAI,CAACE,GAAD,CAAN,EAAaF,IAAI,CAACE,GAAD,CAAjB,EAAwBF,IAAI,CAACE,GAAD,CAA5B,CAApB;AACD;;AACD,WAAI,IAAIK,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,YAAGH,IAAI,CAACG,CAAD,CAAJ,KAAYJ,IAAI,CAACI,CAAD,CAAnB,EAAwB;AACtB,iBAAO,IAAP;AACD;AACF;AACF;;AACD,WAAO,KAAP;AACD;;AAED,MAAIC,MAAM,GAAIV,WAAW,CAACW,IAAZ,CAAiB,IAAjB,EAAuB,KAAvB,EAA8BC,MAA9B,CAAd;AACA,MAAIC,OAAO,GAAGb,WAAW,CAACW,IAAZ,CAAiB,IAAjB,EAAuB,KAAvB,EAA8BG,OAA9B,CAAd;AACA,MAAIC,MAAM,GAAIf,WAAW,CAACW,IAAZ,CAAiB,IAAjB,EAAuB,KAAvB,EAA8BK,MAA9B,CAAd;AACA,MAAIC,KAAK,GAAKjB,WAAW,CAACW,IAAZ,CAAiB,IAAjB,EAAuB,IAAvB,EAA6B,UAASO,CAAT,EAAY;AACrD,QAAGX,KAAK,CAACC,OAAN,CAAcU,CAAd,CAAH,EAAqB;AACnB,UAAGA,CAAC,CAACC,MAAF,KAAa,CAAhB,EAAmB;AACjB,eAAO,CAAE,CAACD,CAAC,CAAC,CAAD,CAAJ,EAAS,CAACA,CAAC,CAAC,CAAD,CAAX,EAAgB,CAACA,CAAC,CAAC,CAAD,CAAlB,EAAuB,GAAvB,CAAP;AACD,OAFD,MAEO,IAAGA,CAAC,CAACC,MAAF,KAAa,CAAhB,EAAmB;AACxB,eAAO,CAAE,CAACD,CAAC,CAAC,CAAD,CAAJ,EAAS,CAACA,CAAC,CAAC,CAAD,CAAX,EAAgB,CAACA,CAAC,CAAC,CAAD,CAAlB,EAAuB,CAACA,CAAC,CAAC,CAAD,CAAzB,CAAP;AACD;AACF;;AACD,WAAO,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,CAAP;AACD,GATa,CAAd,CA3B+B,CAsC/B;;AACA,MAAIE,SAAJ;AACA,MAAIC,WAAW,GAAK,KAApB;AACA,MAAIC,aAAa,GAAG,KAApB;;AACA,MAAG,YAAYvB,OAAf,EAAwB;AACtB,QAAI9C,MAAM,GAAG8C,OAAO,CAAC9C,MAArB;;AACJsE,IAAAA,MAAM,EACF,KAAI,IAAId,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,WAAI,IAAIe,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,YAAGvE,MAAM,CAACwD,CAAD,CAAN,CAAUe,CAAV,MAAiB,KAAKvE,MAAL,CAAYwD,CAAZ,EAAee,CAAf,CAApB,EAAuC;AACrCF,UAAAA,aAAa,GAAG,IAAhB;AACD;;AACD,aAAKrE,MAAL,CAAYwD,CAAZ,EAAee,CAAf,IAAoBvE,MAAM,CAACwD,CAAD,CAAN,CAAUe,CAAV,CAApB;AACD;AACF;AACF;;AACD,MAAG,WAAWzB,OAAd,EAAuB;AACrBqB,IAAAA,SAAS,GAAQrB,OAAO,CAAC7C,KAAzB;AACAmE,IAAAA,WAAW,GAAM,IAAjB;AACA,SAAKlE,SAAL,GAAiB,KAAjB;;AACA,SAAI,IAAIsD,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,WAAKrD,WAAL,CAAiBqD,CAAjB,IAAsB,GAAtB;AACD;AACF,GAPD,MAOO,IAAGC,MAAM,CAAC,aAAD,CAAT,EAA0B;AAC/B,SAAKvD,SAAL,GAAkB,IAAlB;AACAmE,IAAAA,aAAa,GAAK,IAAlB;AACD;;AAED,MAAG,KAAK9B,UAAR,EAAoB;AAClB,QAAG,EAAE,WAAWO,OAAX,IAAsB,iBAAiBA,OAAzC,CAAH,EAAsD;AACpD,WAAK5C,SAAL,GAAiB,IAAjB;AACD,KAHiB,CAKlB;;;AACAmE,IAAAA,aAAa,GAAK,IAAlB;AACAD,IAAAA,WAAW,GAAO,IAAlB;AACA,SAAK7B,UAAL,GAAkB,KAAlB;AACD;;AAED,MAAG8B,aAAa,IAAI,KAAKnE,SAAzB,EAAoC;AAClCiE,IAAAA,SAAS,GAAG5E,KAAK,CAACiF,MAAN,CAAa,KAAKxE,MAAlB,EAA0B,KAAKG,WAA/B,CAAZ;AACAiE,IAAAA,WAAW,GAAG,IAAd;AACD,GAhF8B,CAkF/B;;;AACA,MAAGA,WAAH,EAAgB;AACd,SAAI,IAAIZ,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrBW,MAAAA,SAAS,CAACX,CAAD,CAAT,CAAaiB,IAAb,CAAkB,UAAS9E,CAAT,EAAWC,CAAX,EAAc;AAC9B,eAAOD,CAAC,CAAC+E,CAAF,GAAI9E,CAAC,CAAC8E,CAAb;AACD,OAFD;AAGD;;AACD,QAAGnF,KAAK,CAACoF,KAAN,CAAYR,SAAZ,EAAuB,KAAKlE,KAA5B,CAAH,EAAuC;AACrCmE,MAAAA,WAAW,GAAG,KAAd;AACD,KAFD,MAEO;AACL,WAAKnE,KAAL,GAAakE,SAAb;AACD;AACF,GA9F8B,CAgG/B;;;AACAP,EAAAA,OAAO,CAAC,YAAD,CAAP;;AACA,MAAGE,MAAM,CAAC,UAAD,CAAT,EAAuB;AACrBM,IAAAA,WAAW,GAAG,IAAd,CADqB,CACD;AACrB;;AACDX,EAAAA,MAAM,CAAC,UAAD,CAAN;AACAA,EAAAA,MAAM,CAAC,WAAD,CAAN;AACAA,EAAAA,MAAM,CAAC,SAAD,CAAN;AACAO,EAAAA,KAAK,CAAC,WAAD,CAAL,CAxG+B,CA0G/B;;AACA,MAAIY,WAAW,GAAGd,MAAM,CAAC,QAAD,CAAxB;;AACA,MAAGA,MAAM,CAAC,WAAD,CAAT,EAAwB;AACtBc,IAAAA,WAAW,GAAG,IAAd;AACD;;AACDhB,EAAAA,OAAO,CAAC,aAAD,CAAP;AACAH,EAAAA,MAAM,CAAC,WAAD,CAAN;AACAA,EAAAA,MAAM,CAAC,UAAD,CAAN;AACAO,EAAAA,KAAK,CAAC,YAAD,CAAL,CAlH+B,CAoH/B;;AACAJ,EAAAA,OAAO,CAAC,YAAD,CAAP;AACAA,EAAAA,OAAO,CAAC,YAAD,CAAP;AACAH,EAAAA,MAAM,CAAC,WAAD,CAAN;AACAO,EAAAA,KAAK,CAAC,WAAD,CAAL,CAxH+B,CA0H/B;;AACAJ,EAAAA,OAAO,CAAC,gBAAD,CAAP;AACAA,EAAAA,OAAO,CAAC,gBAAD,CAAP;AACAH,EAAAA,MAAM,CAAC,gBAAD,CAAN;AACAA,EAAAA,MAAM,CAAC,eAAD,CAAN;AACAO,EAAAA,KAAK,CAAC,eAAD,CAAL,CA/H+B,CAiI/B;;AACAJ,EAAAA,OAAO,CAAC,YAAD,CAAP;AACAH,EAAAA,MAAM,CAAC,WAAD,CAAN;AACAO,EAAAA,KAAK,CAAC,WAAD,CAAL,CApI+B,CAsI/B;;AACAJ,EAAAA,OAAO,CAAC,YAAD,CAAP;AACAI,EAAAA,KAAK,CAAC,eAAD,CAAL;AACAP,EAAAA,MAAM,CAAC,eAAD,CAAN,CAzI+B,CA2I/B;;AACAG,EAAAA,OAAO,CAAC,kBAAD,CAAP;AACAI,EAAAA,KAAK,CAAC,iBAAD,CAAL,CA7I+B,CA+I/B;;AACA,MAAG,CAAC,KAAKxB,KAAT,EAAgB;AACd,SAAKA,KAAL,GAAatD,UAAU,CACrB,KAAKY,EADgB,EAErB,KAAKE,MAFgB,EAGrB,KAAKc,MAHgB,EAIrB,KAAKE,SAJgB,EAKrB,KAAKf,KALgB,EAMrB,KAAKI,QANgB,CAAvB;AAOD,GARD,MAQO,IAAG,KAAKmC,KAAL,KAAeoC,WAAW,IAAIR,WAA9B,CAAH,EAA+C;AACpD,SAAK5B,KAAL,CAAWK,MAAX,CACE,KAAK7C,MADP,EAEE,KAAKc,MAFP,EAGE,KAAKE,SAHP,EAIE,KAAKf,KAJP,EAKE,KAAKI,QALP;AAMD,GA/J8B,CAiK/B;;;AACA,MAAG,KAAKoC,MAAL,IAAe2B,WAAlB,EAA+B;AAC7B,SAAK3B,MAAL,CAAYoC,OAAZ;;AACA,SAAKpC,MAAL,GAAc,IAAd;AACD;;AACD,MAAG,CAAC,KAAKA,MAAT,EAAiB;AACf,SAAKA,MAAL,GAAcrD,WAAW,CAAC,KAAKU,EAAN,EAAU,KAAKE,MAAf,EAAuB,KAAKC,KAA5B,CAAzB;AACD;AACF,CAzKD;;AA2KA,SAAS6E,UAAT,GAAsB;AACpB,OAAKC,YAAL,GAAoB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;AACA,OAAKC,WAAL,GAAoB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;AACA,OAAKC,YAAL,GAAoB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;AACA,OAAKC,WAAL,GAAoB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;AACD;;AAED,IAAIC,WAAW,GAAG,CAAE,IAAIL,UAAJ,EAAF,EAAoB,IAAIA,UAAJ,EAApB,EAAsC,IAAIA,UAAJ,EAAtC,CAAlB;;AAEA,SAASM,iBAAT,CAA2BC,MAA3B,EAAmC7B,CAAnC,EAAsCxD,MAAtC,EAA8CY,SAA9C,EAAyD0E,QAAzD,EAAmE;AACjE,MAAIP,YAAY,GAAGM,MAAM,CAACN,YAA1B;AACA,MAAIC,WAAW,GAAIK,MAAM,CAACL,WAA1B;AACA,MAAIO,UAAU,GAAKF,MAAM,CAACJ,YAA1B;AACA,MAAIO,SAAS,GAAMH,MAAM,CAACH,WAA1B;AACA,MAAIO,CAAC,GAAG7E,SAAS,CAAC4C,CAAD,CAAjB,CALiE,CAOjE;;AACA,OAAI,IAAIe,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,QAAGf,CAAC,KAAKe,CAAT,EAAY;AACV;AACD;;AACD,QAAI5E,CAAC,GAAGoF,YAAR;AAAA,QACInF,CAAC,GAAG2F,UADR;AAAA,QAEIG,CAAC,GAAGV,WAFR;AAAA,QAGIW,CAAC,GAAGH,SAHR;;AAIA,QAAGC,CAAC,GAAI,KAAGlB,CAAX,EAAe;AACb5E,MAAAA,CAAC,GAAG4F,UAAJ;AACA3F,MAAAA,CAAC,GAAGmF,YAAJ;AACAW,MAAAA,CAAC,GAAGF,SAAJ;AACAG,MAAAA,CAAC,GAAGX,WAAJ;AACD;;AACDrF,IAAAA,CAAC,CAAC4E,CAAD,CAAD,GAAOvE,MAAM,CAAC,CAAD,CAAN,CAAUuE,CAAV,CAAP;AACA3E,IAAAA,CAAC,CAAC2E,CAAD,CAAD,GAAOvE,MAAM,CAAC,CAAD,CAAN,CAAUuE,CAAV,CAAP;;AACA,QAAGe,QAAQ,CAACf,CAAD,CAAR,GAAc,CAAjB,EAAoB;AAClBmB,MAAAA,CAAC,CAACnB,CAAD,CAAD,GAAO,CAAC,CAAR;AACAoB,MAAAA,CAAC,CAACpB,CAAD,CAAD,GAAO,CAAP;AACD,KAHD,MAGO;AACLmB,MAAAA,CAAC,CAACnB,CAAD,CAAD,GAAO,CAAP;AACAoB,MAAAA,CAAC,CAACpB,CAAD,CAAD,GAAO,CAAC,CAAR;AACD;AACF;AACF;;AAED,IAAIqB,WAAW,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAlB;AACA,IAAIC,cAAc,GAAG;AACnBC,EAAAA,KAAK,EAAOtG,QADO;AAEnBuG,EAAAA,IAAI,EAAQvG,QAFO;AAGnBwG,EAAAA,UAAU,EAAExG,QAHO;AAInByG,EAAAA,MAAM,EAAO;AAJM,CAArB;;AAOAtD,KAAK,CAACuD,QAAN,GAAiB,YAAW;AAC1B,SAAO,IAAP;AACD,CAFD;;AAIAvD,KAAK,CAACwD,aAAN,GAAsB,YAAW;AAC/B,SAAO,KAAP;AACD,CAFD;;AAIAxD,KAAK,CAACyD,eAAN,GAAwB,UAASC,MAAT,EAAiB,CAAE,CAA3C;;AAEA,IAAIC,iBAAiB,GAAG,CAAxB,C,CAA0B;;AAE1B,IAAIC,YAAY,GAAI,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;AACA,IAAIC,YAAY,GAAI,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;AACA,IAAIC,aAAa,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAApB;;AAEA9D,KAAK,CAAC+D,IAAN,GAAa,UAASL,MAAT,EAAiB;AAC5BA,EAAAA,MAAM,GAAGA,MAAM,IAAIR,cAAnB;AAEA,MAAI/F,EAAE,GAAG,KAAKA,EAAd,CAH4B,CAK5B;;AACA,MAAIgG,KAAK,GAASO,MAAM,CAACP,KAAP,IAAgBtG,QAAlC;AACA,MAAIuG,IAAI,GAAUM,MAAM,CAACN,IAAP,IAAevG,QAAjC;AACA,MAAIwG,UAAU,GAAIK,MAAM,CAACL,UAAP,IAAqBxG,QAAvC;AACA,MAAIQ,MAAM,GAAQ,KAAKA,MAAvB;AACA,MAAI2G,OAAO,GAAON,MAAM,CAACJ,MAAP,IAAiB,KAAnC,CAV4B,CAY5B;;AACA,MAAIW,UAAU,GAAItH,iBAAiB,CAACwG,KAAD,EAAQC,IAAR,EAAcC,UAAd,EAA0BhG,MAA1B,EAAkC2G,OAAlC,CAAnC;AACA,MAAI/F,SAAS,GAAKgG,UAAU,CAAChG,SAA7B;AACA,MAAI0E,QAAQ,GAAMsB,UAAU,CAAC/F,IAA7B;AAEA,MAAIgG,EAAE,GAAGd,IAAI,CAAC,EAAD,CAAb;AACA,MAAIe,EAAE,GAAGf,IAAI,CAAC,EAAD,CAAb;AACA,MAAIgB,EAAE,GAAGhB,IAAI,CAAC,EAAD,CAAb;AACA,MAAIiB,EAAE,GAAGjB,IAAI,CAAC,EAAD,CAAb;AAEA,MAAIkB,QAAQ,GAAIN,OAAD,GAAY,CAAZ,GAAgB,CAA/B,CAtB4B,CAsBK;;AACjC,MAAIO,WAAW,GAAGD,QAAQ,GAAG,KAAKlH,UAAhB,IAA8BiG,UAAU,CAAC,CAAD,CAAV,GAAca,EAAd,GAAmBb,UAAU,CAAC,CAAD,CAAV,GAAcc,EAAjC,GAAsCd,UAAU,CAAC,EAAD,CAAV,GAAee,EAArD,GAA0Df,UAAU,CAAC,EAAD,CAAV,GAAegB,EAAvG,IAA6GlH,EAAE,CAACqH,mBAAlI;;AAEA,OAAI,IAAI3D,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,SAAK7C,aAAL,CAAmBC,SAAnB,CAA6B4C,CAA7B,IAAkC5C,SAAS,CAAC4C,CAAD,CAA3C;AACA,SAAK7C,aAAL,CAAmBE,IAAnB,CAAwB2C,CAAxB,IAA6B8B,QAAQ,CAAC9B,CAAD,CAArC;AACD,GA5B2B,CA8B5B;;;AACA,MAAI4D,UAAU,GAAIjC,WAAlB;;AACA,OAAI,IAAI3B,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB4B,IAAAA,iBAAiB,CACfD,WAAW,CAAC3B,CAAD,CADI,EAEfA,CAFe,EAGf,KAAKxD,MAHU,EAIfY,SAJe,EAKf0E,QALe,CAAjB;AAMD,GAvC2B,CAyC5B;;;AACA,MAAIxF,EAAE,GAAG,KAAKA,EAAd,CA1C4B,CA4C5B;;AACA,MAAIuH,UAAU,GAAGzB,WAAjB;;AACA,OAAI,IAAIpC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,QAAG,KAAKnB,gBAAL,CAAsBmB,CAAtB,CAAH,EAA6B;AAC3B6D,MAAAA,UAAU,CAAC7D,CAAD,CAAV,GAAgB8B,QAAQ,CAAC9B,CAAD,CAAxB;AACD,KAFD,MAEO;AACL6D,MAAAA,UAAU,CAAC7D,CAAD,CAAV,GAAgB,CAAhB;AACD;AACF;;AAED,OAAKd,WAAL,CAAiBgE,IAAjB,CACEZ,KADF,EAEEC,IAFF,EAGEC,UAHF,EAIEhG,MAJF,EAKEqH,UALF,EAME,KAAK/E,eANP,EAtD4B,CA8D5B;;;AACA,OAAKG,MAAL,CAAYiB,IAAZ,CACEoC,KADF,EAEEC,IAFF,EAGEC,UAHF,EAIE,IAJF,EA/D4B,CAqE5B;;;AACA,OAAI,IAAIxC,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,QAAIkB,CAAC,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAR;;AACA,QAAGY,QAAQ,CAAC9B,CAAD,CAAR,GAAc,CAAjB,EAAoB;AAClBkB,MAAAA,CAAC,CAAClB,CAAD,CAAD,GAAOxD,MAAM,CAAC,CAAD,CAAN,CAAUwD,CAAV,CAAP;AACD,KAFD,MAEO;AACLkB,MAAAA,CAAC,CAAClB,CAAD,CAAD,GAAOxD,MAAM,CAAC,CAAD,CAAN,CAAUwD,CAAV,CAAP;AACD,KANoB,CAQrB;;;AACA,SAAI,IAAIe,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,UAAI+C,CAAC,GAAG,CAAC9D,CAAC,GAAG,CAAJ,GAAQe,CAAT,IAAc,CAAtB;AACA,UAAIN,CAAC,GAAG,CAACT,CAAC,GAAG,CAAJ,IAASe,CAAC,GAAC,CAAX,CAAD,IAAkB,CAA1B;;AACA,UAAG,KAAKxC,UAAL,CAAgBuF,CAAhB,CAAH,EAAuB;AACrB,aAAK7E,MAAL,CAAY8E,QAAZ,CAAqBD,CAArB,EAAwBrD,CAAxB,EAA2B,KAAKjE,MAAhC,EAAwC0E,CAAxC,EAA2C,KAAKzC,SAAL,CAAeqF,CAAf,CAA3C,EAA8D,KAAKtF,SAAL,CAAesF,CAAf,IAAkB,KAAKvH,UAArF;AACD;AACF,KAfoB,CAiBrB;;;AACA,SAAI,IAAIwE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,UAAI+C,CAAC,GAAG,CAAC9D,CAAC,GAAG,CAAJ,GAAQe,CAAT,IAAc,CAAtB;AACA,UAAIN,CAAC,GAAG,CAACT,CAAC,GAAG,CAAJ,IAASe,CAAC,GAAC,CAAX,CAAD,IAAkB,CAA1B;;AACA,UAAG,KAAKrC,UAAL,CAAgB+B,CAAhB,CAAH,EAAuB;AACrB;AACA,YAAGuD,IAAI,CAACC,GAAL,CAASzH,MAAM,CAAC,CAAD,CAAN,CAAUiE,CAAV,CAAT,EAAuBjE,MAAM,CAAC,CAAD,CAAN,CAAUiE,CAAV,CAAvB,KAAwC,CAAxC,IAA6CuD,IAAI,CAACE,GAAL,CAAS1H,MAAM,CAAC,CAAD,CAAN,CAAUiE,CAAV,CAAT,EAAuBjE,MAAM,CAAC,CAAD,CAAN,CAAUiE,CAAV,CAAvB,KAAwC,CAAxF,EAA2F;AACzF,eAAKxB,MAAL,CAAYkF,QAAZ,CAAqBL,CAArB,EAAwBrD,CAAxB,EAA2B,KAAKjE,MAAhC,EAAwC0E,CAAxC,EAA2C,KAAKvC,aAAL,CAAmB8B,CAAnB,CAA3C,EAAkE,KAAK7B,aAAL,CAAmB6B,CAAnB,IAAsB,KAAKlE,UAA7F;AACD;AACF;AACF;AACF,GAlG2B,CAoG5B;;;AACA,OAAI,IAAIyD,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AAErB;AACA,QAAG,KAAKlC,UAAL,CAAgBkC,CAAhB,CAAH,EAAuB;AACrB,WAAKf,MAAL,CAAYmF,YAAZ,CAAyBpE,CAAzB,EAA4B,KAAKxD,MAAjC,EAAyCoH,UAAU,CAAC5D,CAAD,CAAV,CAAcuB,YAAvD,EAAqE,KAAKtD,SAAL,CAAe+B,CAAf,CAArE,EAAwF,KAAKhC,SAAL,CAAegC,CAAf,IAAkB,KAAKzD,UAA/G;AACD;;AACD,QAAG,KAAKwB,UAAL,CAAgBiC,CAAhB,CAAH,EAAuB;AACrB,WAAKf,MAAL,CAAYmF,YAAZ,CAAyBpE,CAAzB,EAA4B,KAAKxD,MAAjC,EAAyCoH,UAAU,CAAC5D,CAAD,CAAV,CAAcyB,YAAvD,EAAqE,KAAKxD,SAAL,CAAe+B,CAAf,CAArE,EAAwF,KAAKhC,SAAL,CAAegC,CAAf,IAAkB,KAAKzD,UAA/G;AACD,KARoB,CAUrB;;;AACA,QAAIiF,WAAW,GAAGtF,QAAQ,CAAC6G,YAAD,EAAea,UAAU,CAAC5D,CAAD,CAAV,CAAcwB,WAA7B,CAA1B;AACA,QAAIE,WAAW,GAAGxF,QAAQ,CAAC8G,YAAD,EAAeY,UAAU,CAAC5D,CAAD,CAAV,CAAc0B,WAA7B,CAA1B;AACA,QAAI2C,UAAU,GAAI,KAAKjG,cAAvB;;AACA,SAAI,IAAI2C,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,UAAIuD,WAAW,GAAGZ,WAAW,GAAGpB,KAAK,CAAC,IAAEvB,CAAH,CAArC;AACAS,MAAAA,WAAW,CAACT,CAAD,CAAX,IAAkBsD,UAAU,CAACtD,CAAD,CAAV,GAAgBuD,WAAlC;AACA5C,MAAAA,WAAW,CAACX,CAAD,CAAX,IAAkBsD,UAAU,CAACtD,CAAD,CAAV,GAAgBuD,WAAlC;AACD,KAlBoB,CAsBrB;;;AACA,QAAG,KAAKpG,cAAL,CAAoB8B,CAApB,CAAH,EAA2B;AACzB,WAAKf,MAAL,CAAYsF,aAAZ,CAA0BvE,CAA1B,EAA6B4D,UAAU,CAAC5D,CAAD,CAAV,CAAcuB,YAA3C,EAAyDC,WAAzD,EAAsE,KAAKlD,aAAL,CAAmB0B,CAAnB,CAAtE,EAA6F,KAAK3B,aAAL,CAAmB2B,CAAnB,IAAsB,KAAKzD,UAAxH;AACD;;AACD,QAAG,KAAK4B,cAAL,CAAoB6B,CAApB,CAAH,EAA2B;AACzB,WAAKf,MAAL,CAAYsF,aAAZ,CAA0BvE,CAA1B,EAA6B4D,UAAU,CAAC5D,CAAD,CAAV,CAAcyB,YAA3C,EAAyDC,WAAzD,EAAsE,KAAKpD,aAAL,CAAmB0B,CAAnB,CAAtE,EAA6F,KAAK3B,aAAL,CAAmB2B,CAAnB,IAAsB,KAAKzD,UAAxH;AACD;AACF;;AACD,OAAK0C,MAAL,CAAYuF,MAAZ,GAnI4B,CAqI5B;;;AACA,OAAKxF,KAAL,CAAWkB,IAAX,CACEoC,KADF,EAEEC,IAFF,EAGEC,UAHF,EAIE,KAAKjG,UAJP;;AAMA,MAAIkI,QAAJ,CA5I4B,CA4If;AACb;AACA;AACA;AACA;AACA;;AAEA,MAAIC,QAAQ,GAAG,GAAf,CAnJ4B,CAmJT;;AAEnB,MAAIC,WAAJ;AACA,MAAIC,QAAJ;;AAEA,WAASC,OAAT,CAAiB7E,CAAjB,EAAoB;AAClB4E,IAAAA,QAAQ,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAX;AACAA,IAAAA,QAAQ,CAAC5E,CAAD,CAAR,GAAc,CAAd;AACD;;AAED,WAAS8E,mBAAT,CAA6B9E,CAA7B,EAAgC+E,KAAhC,EAAuCC,KAAvC,EAA8C;AAE5C,QAAIC,EAAE,GAAG,CAACjF,CAAC,GAAG,CAAL,IAAU,CAAnB;AACA,QAAIkF,EAAE,GAAG,CAAClF,CAAC,GAAG,CAAL,IAAU,CAAnB;AAEA,QAAImF,CAAC,GAAGJ,KAAK,CAACE,EAAD,CAAb;AACA,QAAIG,CAAC,GAAGL,KAAK,CAACG,EAAD,CAAb;AACA,QAAIG,CAAC,GAAGL,KAAK,CAACC,EAAD,CAAb;AACA,QAAIK,CAAC,GAAGN,KAAK,CAACE,EAAD,CAAb;;AAEK,QAAKC,CAAC,GAAG,CAAL,IAAYG,CAAC,GAAG,CAApB,EAAwB;AAAET,MAAAA,OAAO,CAACI,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKE,CAAC,GAAG,CAAL,IAAYG,CAAC,GAAG,CAApB,EAAwB;AAAET,MAAAA,OAAO,CAACI,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKE,CAAC,GAAG,CAAL,IAAYG,CAAC,GAAG,CAApB,EAAwB;AAAET,MAAAA,OAAO,CAACI,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKE,CAAC,GAAG,CAAL,IAAYG,CAAC,GAAG,CAApB,EAAwB;AAAET,MAAAA,OAAO,CAACI,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKG,CAAC,GAAG,CAAL,IAAYC,CAAC,GAAG,CAApB,EAAwB;AAAER,MAAAA,OAAO,CAACK,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKE,CAAC,GAAG,CAAL,IAAYC,CAAC,GAAG,CAApB,EAAwB;AAAER,MAAAA,OAAO,CAACK,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKE,CAAC,GAAG,CAAL,IAAYC,CAAC,GAAG,CAApB,EAAwB;AAAER,MAAAA,OAAO,CAACK,EAAD,CAAP;AAAa;AAAS,KAAhD,MACA,IAAKE,CAAC,GAAG,CAAL,IAAYC,CAAC,GAAG,CAApB,EAAwB;AAAER,MAAAA,OAAO,CAACK,EAAD,CAAP;AAAa;AAAS;AACtD;;AAED,OAAI,IAAIlF,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AAErB,QAAI+E,KAAK,GAAQnB,UAAU,CAAC5D,CAAD,CAAV,CAAcwB,WAA/B;AACA,QAAIwD,KAAK,GAAQpB,UAAU,CAAC5D,CAAD,CAAV,CAAc0B,WAA/B;AAEA,QAAI6D,MAAM,GAAOrJ,QAAQ,CAAC+G,aAAD,EAAgBW,UAAU,CAAC5D,CAAD,CAAV,CAAcuB,YAA9B,CAAzB;;AAEA,SAAI,IAAIR,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrB,UAAG,KAAK7C,cAAL,CAAoB8B,CAApB,CAAH,EAA2B;AACzBuF,QAAAA,MAAM,CAACxE,CAAD,CAAN,IAAa2C,WAAW,GAAGqB,KAAK,CAAChE,CAAD,CAAnB,GAAyBiD,IAAI,CAACE,GAAL,CAAS,KAAK9F,cAAL,CAAoB2C,CAApB,CAAT,EAAiC,CAAjC,CAAzB,GAAgEuB,KAAK,CAAC,IAAEvB,CAAH,CAAlF;AACD;AACF;;AAED,QAAI1D,IAAI,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAX;AACAA,IAAAA,IAAI,CAAC2C,CAAD,CAAJ,GAAU,CAAV,CAdqB,CAgBrB;;AACA,QAAG,KAAKpD,UAAL,CAAgBoD,CAAhB,CAAH,EAAuB;AAErB,UAAG,KAAKjD,SAAL,CAAeiD,CAAf,MAAsB,CAAC,IAA1B,EAAgC;AAC9B,aAAKjD,SAAL,CAAeiD,CAAf,IAAoB,CAApB;AACA,aAAKhD,SAAL,CAAegD,CAAf,IAAoB,MAApB;AACD,OAHD,MAGO;AACL,aAAKhD,SAAL,CAAegD,CAAf,IAAoB,CAAC,CAArB;AACD;;AAED2E,MAAAA,WAAW,GAAG,CAAd;AAEAF,MAAAA,QAAQ,GAAG,CAAC,KAAKzH,SAAL,CAAegD,CAAf,CAAD,EAAoB0E,QAApB,EAA8BC,WAA9B,CAAX;AACA,UAAGF,QAAQ,CAAC,CAAD,CAAR,KAAgB,MAAnB,EAA2BA,QAAQ,CAAC,CAAD,CAAR,GAAc3B,iBAAd,CAA3B,KACK2B,QAAQ,CAAC,CAAD,CAAR,GAAce,QAAQ,CAAC,KAAKf,QAAQ,CAAC,CAAD,CAAd,CAAtB;AAELG,MAAAA,QAAQ,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAX;AACAE,MAAAA,mBAAmB,CAAC9E,CAAD,EAAI+E,KAAJ,EAAWC,KAAX,CAAnB,CAhBqB,CAkBrB;;AACA,WAAI,IAAIjE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrBwE,QAAAA,MAAM,CAACxE,CAAD,CAAN,IAAa2C,WAAW,GAAGqB,KAAK,CAAChE,CAAD,CAAnB,GAAyB,KAAK7D,OAAL,CAAa6D,CAAb,CAAzB,GAA2CuB,KAAK,CAAC,IAAEvB,CAAH,CAA7D;AACD,OArBoB,CAuBrB;;;AACA,WAAK/B,KAAL,CAAWyG,SAAX,CACEzF,CADF,EAEE,KAAKlD,QAAL,CAAckD,CAAd,CAFF,EAGE,KAAKjD,SAAL,CAAeiD,CAAf,CAHF,EAIEuF,MAJF,EAKE,KAAKtI,SAAL,CAAe+C,CAAf,CALF,EAME3C,IANF,EAOEuH,QAPF,EAQEH,QARF;AASD,KAlDoB,CAoDrB;;;AACA,QAAG,KAAKlH,WAAL,CAAiByC,CAAjB,CAAH,EAAwB;AAEtB2E,MAAAA,WAAW,GAAG,CAAd;AACAC,MAAAA,QAAQ,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAX;;AACA,UAAG,KAAKtH,MAAL,CAAY0C,CAAZ,EAAeU,MAAf,GAAwB,CAA3B,EAA8B;AAAE;AAC9BmE,QAAAA,OAAO,CAAC7E,CAAD,CAAP;AACA2E,QAAAA,WAAW,GAAG,CAAd;AACD;;AAEDF,MAAAA,QAAQ,GAAG,CAAC,KAAK9G,UAAL,CAAgBqC,CAAhB,CAAD,EAAqB0E,QAArB,EAA+BC,WAA/B,CAAX;AACA,UAAGF,QAAQ,CAAC,CAAD,CAAR,KAAgB,MAAnB,EAA2BA,QAAQ,CAAC,CAAD,CAAR,GAAc3B,iBAAd,CAA3B,KACK2B,QAAQ,CAAC,CAAD,CAAR,GAAce,QAAQ,CAAC,KAAKf,QAAQ,CAAC,CAAD,CAAd,CAAtB,CAXiB,CAatB;;AACA,WAAI,IAAI1D,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAC,CAAf,EAAkB,EAAEA,CAApB,EAAuB;AACrBwE,QAAAA,MAAM,CAACxE,CAAD,CAAN,IAAa2C,WAAW,GAAGqB,KAAK,CAAChE,CAAD,CAAnB,GAAyB,KAAKlD,QAAL,CAAckD,CAAd,CAAzB,GAA4CuB,KAAK,CAAC,IAAEvB,CAAH,CAA9D;AACD;;AACDwE,MAAAA,MAAM,CAACvF,CAAD,CAAN,IAAa,OAAOxD,MAAM,CAAC,CAAD,CAAN,CAAUwD,CAAV,IAAexD,MAAM,CAAC,CAAD,CAAN,CAAUwD,CAAV,CAAtB,CAAb,CAjBsB,CAmBtB;;AACA,WAAKhB,KAAL,CAAW0G,SAAX,CACE1F,CADF,EAEE,KAAKvC,SAAL,CAAeuC,CAAf,CAFF,EAGE,KAAKtC,UAAL,CAAgBsC,CAAhB,CAHF,EAIEuF,MAJF,EAKE,KAAK3H,UAAL,CAAgBoC,CAAhB,CALF,EAME,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CANF,EAOE4E,QAPF,EAQEH,QARF;AASD;AACF;;AAED,OAAKzF,KAAL,CAAWwF,MAAX;AACD,CAvQD;;AAyQArF,KAAK,CAACkC,OAAN,GAAgB,YAAW;AACzB,OAAKrC,KAAL,CAAWqC,OAAX;;AACA,OAAKpC,MAAL,CAAYoC,OAAZ;;AACA,OAAKnC,WAAL,CAAiBmC,OAAjB;;AACA,OAAKpC,MAAL,GAAc,IAAd;AACA,OAAKD,KAAL,GAAa,IAAb;AACA,OAAKE,WAAL,GAAmB,IAAnB;AACA,OAAK5C,EAAL,GAAU,IAAV;AACD,CARD;;AAUA,SAASb,UAAT,CAAoBa,EAApB,EAAwBgD,OAAxB,EAAiC;AAC/B,MAAIqG,IAAI,GAAG,IAAItJ,IAAJ,CAASC,EAAT,CAAX;AACAqJ,EAAAA,IAAI,CAACtG,MAAL,CAAYC,OAAZ;AACA,SAAOqG,IAAP;AACD","sourcesContent":["'use strict'\n\nmodule.exports = createAxes\n\nvar createText        = require('./lib/text.js')\nvar createLines       = require('./lib/lines.js')\nvar createBackground  = require('./lib/background.js')\nvar getCubeProperties = require('./lib/cube.js')\nvar Ticks             = require('./lib/ticks.js')\n\nvar identity = new Float32Array([\n  1, 0, 0, 0,\n  0, 1, 0, 0,\n  0, 0, 1, 0,\n  0, 0, 0, 1])\n\nfunction copyVec3(a, b) {\n  a[0] = b[0]\n  a[1] = b[1]\n  a[2] = b[2]\n  return a\n}\n\nfunction Axes(gl) {\n  this.gl             = gl\n\n  this.pixelRatio     = 1\n\n  this.bounds         = [ [-10, -10, -10],\n                          [ 10,  10,  10] ]\n  this.ticks          = [ [], [], [] ]\n  this.autoTicks      = true\n  this.tickSpacing    = [ 1, 1, 1 ]\n\n  this.tickEnable     = [ true, true, true ]\n  this.tickFont       = [ 'sans-serif', 'sans-serif', 'sans-serif' ]\n  this.tickSize       = [ 12, 12, 12 ]\n  this.tickAngle      = [ 0, 0, 0 ]\n  this.tickAlign      = [ 'auto', 'auto', 'auto' ]\n  this.tickColor      = [ [0,0,0,1], [0,0,0,1], [0,0,0,1] ]\n  this.tickPad        = [ 10, 10, 10 ]\n\n  this.lastCubeProps  = {\n    cubeEdges: [0,0,0],\n    axis:      [0,0,0]\n  }\n\n  this.labels         = [ 'x', 'y', 'z' ]\n  this.labelEnable    = [ true, true, true ]\n  this.labelFont      = 'sans-serif'\n  this.labelSize      = [ 20, 20, 20 ]\n  this.labelAngle     = [ 0, 0, 0 ]\n  this.labelAlign     = [ 'auto', 'auto', 'auto' ]\n  this.labelColor     = [ [0,0,0,1], [0,0,0,1], [0,0,0,1] ]\n  this.labelPad       = [ 10, 10, 10 ]\n\n  this.lineEnable     = [ true, true, true ]\n  this.lineMirror     = [ false, false, false ]\n  this.lineWidth      = [ 1, 1, 1 ]\n  this.lineColor      = [ [0,0,0,1], [0,0,0,1], [0,0,0,1] ]\n\n  this.lineTickEnable = [ true, true, true ]\n  this.lineTickMirror = [ false, false, false ]\n  this.lineTickLength = [ 0, 0, 0 ]\n  this.lineTickWidth  = [ 1, 1, 1 ]\n  this.lineTickColor  = [ [0,0,0,1], [0,0,0,1], [0,0,0,1] ]\n\n  this.gridEnable     = [ true, true, true ]\n  this.gridWidth      = [ 1, 1, 1 ]\n  this.gridColor      = [ [0,0,0,1], [0,0,0,1], [0,0,0,1] ]\n\n  this.zeroEnable     = [ true, true, true ]\n  this.zeroLineColor  = [ [0,0,0,1], [0,0,0,1], [0,0,0,1] ]\n  this.zeroLineWidth  = [ 2, 2, 2 ]\n\n  this.backgroundEnable = [ false, false, false ]\n  this.backgroundColor  = [ [0.8, 0.8, 0.8, 0.5],\n                            [0.8, 0.8, 0.8, 0.5],\n                            [0.8, 0.8, 0.8, 0.5] ]\n\n  this._firstInit = true\n  this._text  = null\n  this._lines = null\n  this._background = createBackground(gl)\n}\n\nvar proto = Axes.prototype\n\nproto.update = function(options) {\n  options = options || {}\n\n  //Option parsing helper functions\n  function parseOption(nest, cons, name) {\n    if(name in options) {\n      var opt = options[name]\n      var prev = this[name]\n      var next\n      if(nest ? (Array.isArray(opt) && Array.isArray(opt[0])) :\n                 Array.isArray(opt) ) {\n        this[name] = next = [ cons(opt[0]), cons(opt[1]), cons(opt[2]) ]\n      } else {\n        this[name] = next = [ cons(opt), cons(opt), cons(opt) ]\n      }\n      for(var i=0; i<3; ++i) {\n        if(next[i] !== prev[i]) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n\n  var NUMBER  = parseOption.bind(this, false, Number)\n  var BOOLEAN = parseOption.bind(this, false, Boolean)\n  var STRING  = parseOption.bind(this, false, String)\n  var COLOR   = parseOption.bind(this, true, function(v) {\n    if(Array.isArray(v)) {\n      if(v.length === 3) {\n        return [ +v[0], +v[1], +v[2], 1.0 ]\n      } else if(v.length === 4) {\n        return [ +v[0], +v[1], +v[2], +v[3] ]\n      }\n    }\n    return [ 0, 0, 0, 1 ]\n  })\n\n  //Tick marks and bounds\n  var nextTicks\n  var ticksUpdate   = false\n  var boundsChanged = false\n  if('bounds' in options) {\n    var bounds = options.bounds\ni_loop:\n    for(var i=0; i<2; ++i) {\n      for(var j=0; j<3; ++j) {\n        if(bounds[i][j] !== this.bounds[i][j]) {\n          boundsChanged = true\n        }\n        this.bounds[i][j] = bounds[i][j]\n      }\n    }\n  }\n  if('ticks' in options) {\n    nextTicks      = options.ticks\n    ticksUpdate    = true\n    this.autoTicks = false\n    for(var i=0; i<3; ++i) {\n      this.tickSpacing[i] = 0.0\n    }\n  } else if(NUMBER('tickSpacing')) {\n    this.autoTicks  = true\n    boundsChanged   = true\n  }\n\n  if(this._firstInit) {\n    if(!('ticks' in options || 'tickSpacing' in options)) {\n      this.autoTicks = true\n    }\n\n    //Force tick recomputation on first update\n    boundsChanged   = true\n    ticksUpdate     = true\n    this._firstInit = false\n  }\n\n  if(boundsChanged && this.autoTicks) {\n    nextTicks = Ticks.create(this.bounds, this.tickSpacing)\n    ticksUpdate = true\n  }\n\n  //Compare next ticks to previous ticks, only update if needed\n  if(ticksUpdate) {\n    for(var i=0; i<3; ++i) {\n      nextTicks[i].sort(function(a,b) {\n        return a.x-b.x\n      })\n    }\n    if(Ticks.equal(nextTicks, this.ticks)) {\n      ticksUpdate = false\n    } else {\n      this.ticks = nextTicks\n    }\n  }\n\n  //Parse tick properties\n  BOOLEAN('tickEnable')\n  if(STRING('tickFont')) {\n    ticksUpdate = true  //If font changes, must rebuild vbo\n  }\n  NUMBER('tickSize')\n  NUMBER('tickAngle')\n  NUMBER('tickPad')\n  COLOR('tickColor')\n\n  //Axis labels\n  var labelUpdate = STRING('labels')\n  if(STRING('labelFont')) {\n    labelUpdate = true\n  }\n  BOOLEAN('labelEnable')\n  NUMBER('labelSize')\n  NUMBER('labelPad')\n  COLOR('labelColor')\n\n  //Axis lines\n  BOOLEAN('lineEnable')\n  BOOLEAN('lineMirror')\n  NUMBER('lineWidth')\n  COLOR('lineColor')\n\n  //Axis line ticks\n  BOOLEAN('lineTickEnable')\n  BOOLEAN('lineTickMirror')\n  NUMBER('lineTickLength')\n  NUMBER('lineTickWidth')\n  COLOR('lineTickColor')\n\n  //Grid lines\n  BOOLEAN('gridEnable')\n  NUMBER('gridWidth')\n  COLOR('gridColor')\n\n  //Zero line\n  BOOLEAN('zeroEnable')\n  COLOR('zeroLineColor')\n  NUMBER('zeroLineWidth')\n\n  //Background\n  BOOLEAN('backgroundEnable')\n  COLOR('backgroundColor')\n\n  //Update text if necessary\n  if(!this._text) {\n    this._text = createText(\n      this.gl,\n      this.bounds,\n      this.labels,\n      this.labelFont,\n      this.ticks,\n      this.tickFont)\n  } else if(this._text && (labelUpdate || ticksUpdate)) {\n    this._text.update(\n      this.bounds,\n      this.labels,\n      this.labelFont,\n      this.ticks,\n      this.tickFont)\n  }\n\n  //Update lines if necessary\n  if(this._lines && ticksUpdate) {\n    this._lines.dispose()\n    this._lines = null\n  }\n  if(!this._lines) {\n    this._lines = createLines(this.gl, this.bounds, this.ticks)\n  }\n}\n\nfunction OffsetInfo() {\n  this.primalOffset = [0,0,0]\n  this.primalMinor  = [0,0,0]\n  this.mirrorOffset = [0,0,0]\n  this.mirrorMinor  = [0,0,0]\n}\n\nvar LINE_OFFSET = [ new OffsetInfo(), new OffsetInfo(), new OffsetInfo() ]\n\nfunction computeLineOffset(result, i, bounds, cubeEdges, cubeAxis) {\n  var primalOffset = result.primalOffset\n  var primalMinor  = result.primalMinor\n  var dualOffset   = result.mirrorOffset\n  var dualMinor    = result.mirrorMinor\n  var e = cubeEdges[i]\n\n  //Calculate offsets\n  for(var j=0; j<3; ++j) {\n    if(i === j) {\n      continue\n    }\n    var a = primalOffset,\n        b = dualOffset,\n        c = primalMinor,\n        d = dualMinor\n    if(e & (1<<j)) {\n      a = dualOffset\n      b = primalOffset\n      c = dualMinor\n      d = primalMinor\n    }\n    a[j] = bounds[0][j]\n    b[j] = bounds[1][j]\n    if(cubeAxis[j] > 0) {\n      c[j] = -1\n      d[j] = 0\n    } else {\n      c[j] = 0\n      d[j] = +1\n    }\n  }\n}\n\nvar CUBE_ENABLE = [0,0,0]\nvar DEFAULT_PARAMS = {\n  model:      identity,\n  view:       identity,\n  projection: identity,\n  _ortho:      false\n}\n\nproto.isOpaque = function() {\n  return true\n}\n\nproto.isTransparent = function() {\n  return false\n}\n\nproto.drawTransparent = function(params) {}\n\nvar ALIGN_OPTION_AUTO = 0 // i.e. as defined in the shader the text would rotate to stay upwards range: [-90,90]\n\nvar PRIMAL_MINOR  = [0,0,0]\nvar MIRROR_MINOR  = [0,0,0]\nvar PRIMAL_OFFSET = [0,0,0]\n\nproto.draw = function(params) {\n  params = params || DEFAULT_PARAMS\n\n  var gl = this.gl\n\n  //Geometry for camera and axes\n  var model       = params.model || identity\n  var view        = params.view || identity\n  var projection  = params.projection || identity\n  var bounds      = this.bounds\n  var isOrtho     = params._ortho || false\n\n  //Unpack axis info\n  var cubeParams  = getCubeProperties(model, view, projection, bounds, isOrtho)\n  var cubeEdges   = cubeParams.cubeEdges\n  var cubeAxis    = cubeParams.axis\n\n  var cx = view[12]\n  var cy = view[13]\n  var cz = view[14]\n  var cw = view[15]\n\n  var orthoFix = (isOrtho) ? 2 : 1 // double up padding for orthographic ticks & labels\n  var pixelScaleF = orthoFix * this.pixelRatio * (projection[3]*cx + projection[7]*cy + projection[11]*cz + projection[15]*cw) / gl.drawingBufferHeight\n\n  for(var i=0; i<3; ++i) {\n    this.lastCubeProps.cubeEdges[i] = cubeEdges[i]\n    this.lastCubeProps.axis[i] = cubeAxis[i]\n  }\n\n  //Compute axis info\n  var lineOffset  = LINE_OFFSET\n  for(var i=0; i<3; ++i) {\n    computeLineOffset(\n      LINE_OFFSET[i],\n      i,\n      this.bounds,\n      cubeEdges,\n      cubeAxis)\n  }\n\n  //Set up state parameters\n  var gl = this.gl\n\n  //Draw background first\n  var cubeEnable = CUBE_ENABLE\n  for(var i=0; i<3; ++i) {\n    if(this.backgroundEnable[i]) {\n      cubeEnable[i] = cubeAxis[i]\n    } else {\n      cubeEnable[i] = 0\n    }\n  }\n\n  this._background.draw(\n    model,\n    view,\n    projection,\n    bounds,\n    cubeEnable,\n    this.backgroundColor)\n\n  //Draw lines\n  this._lines.bind(\n    model,\n    view,\n    projection,\n    this)\n\n  //First draw grid lines and zero lines\n  for(var i=0; i<3; ++i) {\n    var x = [0,0,0]\n    if(cubeAxis[i] > 0) {\n      x[i] = bounds[1][i]\n    } else {\n      x[i] = bounds[0][i]\n    }\n\n    //Draw grid lines\n    for(var j=0; j<2; ++j) {\n      var u = (i + 1 + j) % 3\n      var v = (i + 1 + (j^1)) % 3\n      if(this.gridEnable[u]) {\n        this._lines.drawGrid(u, v, this.bounds, x, this.gridColor[u], this.gridWidth[u]*this.pixelRatio)\n      }\n    }\n\n    //Draw zero lines (need to do this AFTER all grid lines are drawn)\n    for(var j=0; j<2; ++j) {\n      var u = (i + 1 + j) % 3\n      var v = (i + 1 + (j^1)) % 3\n      if(this.zeroEnable[v]) {\n        //Check if zero line in bounds\n        if(Math.min(bounds[0][v], bounds[1][v]) <= 0 && Math.max(bounds[0][v], bounds[1][v]) >= 0) {\n          this._lines.drawZero(u, v, this.bounds, x, this.zeroLineColor[v], this.zeroLineWidth[v]*this.pixelRatio)\n        }\n      }\n    }\n  }\n\n  //Then draw axis lines and tick marks\n  for(var i=0; i<3; ++i) {\n\n    //Draw axis lines\n    if(this.lineEnable[i]) {\n      this._lines.drawAxisLine(i, this.bounds, lineOffset[i].primalOffset, this.lineColor[i], this.lineWidth[i]*this.pixelRatio)\n    }\n    if(this.lineMirror[i]) {\n      this._lines.drawAxisLine(i, this.bounds, lineOffset[i].mirrorOffset, this.lineColor[i], this.lineWidth[i]*this.pixelRatio)\n    }\n\n    //Compute minor axes\n    var primalMinor = copyVec3(PRIMAL_MINOR, lineOffset[i].primalMinor)\n    var mirrorMinor = copyVec3(MIRROR_MINOR, lineOffset[i].mirrorMinor)\n    var tickLength  = this.lineTickLength\n    for(var j=0; j<3; ++j) {\n      var scaleFactor = pixelScaleF / model[5*j]\n      primalMinor[j] *= tickLength[j] * scaleFactor\n      mirrorMinor[j] *= tickLength[j] * scaleFactor\n    }\n\n\n\n    //Draw axis line ticks\n    if(this.lineTickEnable[i]) {\n      this._lines.drawAxisTicks(i, lineOffset[i].primalOffset, primalMinor, this.lineTickColor[i], this.lineTickWidth[i]*this.pixelRatio)\n    }\n    if(this.lineTickMirror[i]) {\n      this._lines.drawAxisTicks(i, lineOffset[i].mirrorOffset, mirrorMinor, this.lineTickColor[i], this.lineTickWidth[i]*this.pixelRatio)\n    }\n  }\n  this._lines.unbind()\n\n  //Draw text sprites\n  this._text.bind(\n    model,\n    view,\n    projection,\n    this.pixelRatio)\n\n  var alignOpt // options in shader are from this list {-1, 0, 1, 2, 3, ..., n}\n  // -1: backward compatible\n  //  0: raw data\n  //  1: auto align, free angles\n  //  2: auto align, horizontal or vertical\n  //3-n: auto align, round to n directions e.g. 12 -> round to angles with 30-degree steps\n\n  var hv_ratio = 0.5 // can have an effect on the ratio between horizontals and verticals when using option 2\n\n  var enableAlign\n  var alignDir\n\n  function alignTo(i) {\n    alignDir = [0,0,0]\n    alignDir[i] = 1\n  }\n\n  function solveTickAlignments(i, minor, major) {\n\n    var i1 = (i + 1) % 3\n    var i2 = (i + 2) % 3\n\n    var A = minor[i1]\n    var B = minor[i2]\n    var C = major[i1]\n    var D = major[i2]\n\n         if ((A > 0) && (D > 0)) { alignTo(i1); return; }\n    else if ((A > 0) && (D < 0)) { alignTo(i1); return; }\n    else if ((A < 0) && (D > 0)) { alignTo(i1); return; }\n    else if ((A < 0) && (D < 0)) { alignTo(i1); return; }\n    else if ((B > 0) && (C > 0)) { alignTo(i2); return; }\n    else if ((B > 0) && (C < 0)) { alignTo(i2); return; }\n    else if ((B < 0) && (C > 0)) { alignTo(i2); return; }\n    else if ((B < 0) && (C < 0)) { alignTo(i2); return; }\n  }\n\n  for(var i=0; i<3; ++i) {\n\n    var minor      = lineOffset[i].primalMinor\n    var major      = lineOffset[i].mirrorMinor\n\n    var offset     = copyVec3(PRIMAL_OFFSET, lineOffset[i].primalOffset)\n\n    for(var j=0; j<3; ++j) {\n      if(this.lineTickEnable[i]) {\n        offset[j] += pixelScaleF * minor[j] * Math.max(this.lineTickLength[j], 0)  / model[5*j]\n      }\n    }\n\n    var axis = [0,0,0]\n    axis[i] = 1\n\n    //Draw tick text\n    if(this.tickEnable[i]) {\n\n      if(this.tickAngle[i] === -3600) {\n        this.tickAngle[i] = 0\n        this.tickAlign[i] = 'auto'\n      } else {\n        this.tickAlign[i] = -1\n      }\n\n      enableAlign = 1;\n\n      alignOpt = [this.tickAlign[i], hv_ratio, enableAlign]\n      if(alignOpt[0] === 'auto') alignOpt[0] = ALIGN_OPTION_AUTO\n      else alignOpt[0] = parseInt('' + alignOpt[0])\n\n      alignDir = [0,0,0]\n      solveTickAlignments(i, minor, major)\n\n      //Add tick padding\n      for(var j=0; j<3; ++j) {\n        offset[j] += pixelScaleF * minor[j] * this.tickPad[j] / model[5*j]\n      }\n\n      //Draw axis\n      this._text.drawTicks(\n        i,\n        this.tickSize[i],\n        this.tickAngle[i],\n        offset,\n        this.tickColor[i],\n        axis,\n        alignDir,\n        alignOpt)\n    }\n\n    //Draw labels\n    if(this.labelEnable[i]) {\n\n      enableAlign = 0\n      alignDir = [0,0,0]\n      if(this.labels[i].length > 4) { // for large label axis enable alignDir to axis\n        alignTo(i)\n        enableAlign = 1\n      }\n\n      alignOpt = [this.labelAlign[i], hv_ratio, enableAlign]\n      if(alignOpt[0] === 'auto') alignOpt[0] = ALIGN_OPTION_AUTO\n      else alignOpt[0] = parseInt('' + alignOpt[0])\n\n      //Add label padding\n      for(var j=0; j<3; ++j) {\n        offset[j] += pixelScaleF * minor[j] * this.labelPad[j] / model[5*j]\n      }\n      offset[i] += 0.5 * (bounds[0][i] + bounds[1][i])\n\n      //Draw axis\n      this._text.drawLabel(\n        i,\n        this.labelSize[i],\n        this.labelAngle[i],\n        offset,\n        this.labelColor[i],\n        [0,0,0],\n        alignDir,\n        alignOpt)\n    }\n  }\n\n  this._text.unbind()\n}\n\nproto.dispose = function() {\n  this._text.dispose()\n  this._lines.dispose()\n  this._background.dispose()\n  this._lines = null\n  this._text = null\n  this._background = null\n  this.gl = null\n}\n\nfunction createAxes(gl, options) {\n  var axes = new Axes(gl)\n  axes.update(options)\n  return axes\n}\n"]},"metadata":{},"sourceType":"script"}