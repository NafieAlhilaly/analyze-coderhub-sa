{"ast":null,"code":"'use strict';\n\nvar createHeatmap2D = require('gl-heatmap2d');\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar str2RGBArray = require('../../lib/str2rgbarray');\n\nfunction Heatmap(scene, uid) {\n  this.scene = scene;\n  this.uid = uid;\n  this.type = 'heatmapgl';\n  this.name = '';\n  this.hoverinfo = 'all';\n  this.xData = [];\n  this.yData = [];\n  this.zData = [];\n  this.textLabels = [];\n  this.idToIndex = [];\n  this.bounds = [0, 0, 0, 0];\n  this.options = {\n    zsmooth: 'fast',\n    z: [],\n    x: [],\n    y: [],\n    shape: [0, 0],\n    colorLevels: [0],\n    colorValues: [0, 0, 0, 1]\n  };\n  this.heatmap = createHeatmap2D(scene.glplot, this.options);\n  this.heatmap._trace = this;\n}\n\nvar proto = Heatmap.prototype;\n\nproto.handlePick = function (pickResult) {\n  var options = this.options;\n  var shape = options.shape;\n  var index = pickResult.pointId;\n  var xIndex = index % shape[0];\n  var yIndex = Math.floor(index / shape[0]);\n  var zIndex = index;\n  return {\n    trace: this,\n    dataCoord: pickResult.dataCoord,\n    traceCoord: [options.x[xIndex], options.y[yIndex], options.z[zIndex]],\n    textLabel: this.textLabels[index],\n    name: this.name,\n    pointIndex: [yIndex, xIndex],\n    hoverinfo: this.hoverinfo\n  };\n};\n\nproto.update = function (fullTrace, calcTrace) {\n  var calcPt = calcTrace[0];\n  this.index = fullTrace.index;\n  this.name = fullTrace.name;\n  this.hoverinfo = fullTrace.hoverinfo; // convert z from 2D -> 1D\n\n  var z = calcPt.z;\n  this.options.z = [].concat.apply([], z);\n  var rowLen = z[0].length;\n  var colLen = z.length;\n  this.options.shape = [rowLen, colLen];\n  this.options.x = calcPt.x;\n  this.options.y = calcPt.y;\n  this.options.zsmooth = fullTrace.zsmooth;\n  var colorOptions = convertColorscale(fullTrace);\n  this.options.colorLevels = colorOptions.colorLevels;\n  this.options.colorValues = colorOptions.colorValues; // convert text from 2D -> 1D\n\n  this.textLabels = [].concat.apply([], fullTrace.text);\n  this.heatmap.update(this.options);\n  var xa = this.scene.xaxis;\n  var ya = this.scene.yaxis;\n  var xOpts, yOpts;\n\n  if (fullTrace.zsmooth === false) {\n    // increase padding for discretised heatmap as suggested by Louise Ord\n    xOpts = {\n      ppad: calcPt.x[1] - calcPt.x[0]\n    };\n    yOpts = {\n      ppad: calcPt.y[1] - calcPt.y[0]\n    };\n  }\n\n  fullTrace._extremes[xa._id] = Axes.findExtremes(xa, calcPt.x, xOpts);\n  fullTrace._extremes[ya._id] = Axes.findExtremes(ya, calcPt.y, yOpts);\n};\n\nproto.dispose = function () {\n  this.heatmap.dispose();\n};\n\nfunction convertColorscale(fullTrace) {\n  var scl = fullTrace.colorscale;\n  var zmin = fullTrace.zmin;\n  var zmax = fullTrace.zmax;\n  var N = scl.length;\n  var domain = new Array(N);\n  var range = new Array(4 * N);\n\n  for (var i = 0; i < N; i++) {\n    var si = scl[i];\n    var color = str2RGBArray(si[1]);\n    domain[i] = zmin + si[0] * (zmax - zmin);\n\n    for (var j = 0; j < 4; j++) {\n      range[4 * i + j] = color[j];\n    }\n  }\n\n  return {\n    colorLevels: domain,\n    colorValues: range\n  };\n}\n\nfunction createHeatmap(scene, fullTrace, calcTrace) {\n  var plot = new Heatmap(scene, fullTrace.uid);\n  plot.update(fullTrace, calcTrace);\n  return plot;\n}\n\nmodule.exports = createHeatmap;","map":{"version":3,"sources":["C:/Projects/reactApp/analyse_coderhub/node_modules/plotly.js/src/traces/heatmapgl/convert.js"],"names":["createHeatmap2D","require","Axes","str2RGBArray","Heatmap","scene","uid","type","name","hoverinfo","xData","yData","zData","textLabels","idToIndex","bounds","options","zsmooth","z","x","y","shape","colorLevels","colorValues","heatmap","glplot","_trace","proto","prototype","handlePick","pickResult","index","pointId","xIndex","yIndex","Math","floor","zIndex","trace","dataCoord","traceCoord","textLabel","pointIndex","update","fullTrace","calcTrace","calcPt","concat","apply","rowLen","length","colLen","colorOptions","convertColorscale","text","xa","xaxis","ya","yaxis","xOpts","yOpts","ppad","_extremes","_id","findExtremes","dispose","scl","colorscale","zmin","zmax","N","domain","Array","range","i","si","color","j","createHeatmap","plot","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar createHeatmap2D = require('gl-heatmap2d');\nvar Axes = require('../../plots/cartesian/axes');\nvar str2RGBArray = require('../../lib/str2rgbarray');\n\n\nfunction Heatmap(scene, uid) {\n    this.scene = scene;\n    this.uid = uid;\n    this.type = 'heatmapgl';\n\n    this.name = '';\n    this.hoverinfo = 'all';\n\n    this.xData = [];\n    this.yData = [];\n    this.zData = [];\n    this.textLabels = [];\n\n    this.idToIndex = [];\n    this.bounds = [0, 0, 0, 0];\n\n    this.options = {\n        zsmooth: 'fast',\n        z: [],\n        x: [],\n        y: [],\n        shape: [0, 0],\n        colorLevels: [0],\n        colorValues: [0, 0, 0, 1]\n    };\n\n    this.heatmap = createHeatmap2D(scene.glplot, this.options);\n    this.heatmap._trace = this;\n}\n\nvar proto = Heatmap.prototype;\n\nproto.handlePick = function(pickResult) {\n    var options = this.options;\n    var shape = options.shape;\n    var index = pickResult.pointId;\n    var xIndex = index % shape[0];\n    var yIndex = Math.floor(index / shape[0]);\n    var zIndex = index;\n\n    return {\n        trace: this,\n        dataCoord: pickResult.dataCoord,\n        traceCoord: [\n            options.x[xIndex],\n            options.y[yIndex],\n            options.z[zIndex]\n        ],\n        textLabel: this.textLabels[index],\n        name: this.name,\n        pointIndex: [yIndex, xIndex],\n        hoverinfo: this.hoverinfo\n    };\n};\n\nproto.update = function(fullTrace, calcTrace) {\n    var calcPt = calcTrace[0];\n\n    this.index = fullTrace.index;\n    this.name = fullTrace.name;\n    this.hoverinfo = fullTrace.hoverinfo;\n\n    // convert z from 2D -> 1D\n    var z = calcPt.z;\n    this.options.z = [].concat.apply([], z);\n\n    var rowLen = z[0].length;\n    var colLen = z.length;\n    this.options.shape = [rowLen, colLen];\n\n    this.options.x = calcPt.x;\n    this.options.y = calcPt.y;\n    this.options.zsmooth = fullTrace.zsmooth;\n\n    var colorOptions = convertColorscale(fullTrace);\n    this.options.colorLevels = colorOptions.colorLevels;\n    this.options.colorValues = colorOptions.colorValues;\n\n    // convert text from 2D -> 1D\n    this.textLabels = [].concat.apply([], fullTrace.text);\n\n    this.heatmap.update(this.options);\n\n    var xa = this.scene.xaxis;\n    var ya = this.scene.yaxis;\n\n    var xOpts, yOpts;\n    if(fullTrace.zsmooth === false) {\n        // increase padding for discretised heatmap as suggested by Louise Ord\n        xOpts = { ppad: calcPt.x[1] - calcPt.x[0] };\n        yOpts = { ppad: calcPt.y[1] - calcPt.y[0] };\n    }\n\n    fullTrace._extremes[xa._id] = Axes.findExtremes(xa, calcPt.x, xOpts);\n    fullTrace._extremes[ya._id] = Axes.findExtremes(ya, calcPt.y, yOpts);\n};\n\nproto.dispose = function() {\n    this.heatmap.dispose();\n};\n\nfunction convertColorscale(fullTrace) {\n    var scl = fullTrace.colorscale;\n    var zmin = fullTrace.zmin;\n    var zmax = fullTrace.zmax;\n\n    var N = scl.length;\n    var domain = new Array(N);\n    var range = new Array(4 * N);\n\n    for(var i = 0; i < N; i++) {\n        var si = scl[i];\n        var color = str2RGBArray(si[1]);\n\n        domain[i] = zmin + si[0] * (zmax - zmin);\n\n        for(var j = 0; j < 4; j++) {\n            range[(4 * i) + j] = color[j];\n        }\n    }\n\n    return {\n        colorLevels: domain,\n        colorValues: range\n    };\n}\n\nfunction createHeatmap(scene, fullTrace, calcTrace) {\n    var plot = new Heatmap(scene, fullTrace.uid);\n    plot.update(fullTrace, calcTrace);\n    return plot;\n}\n\nmodule.exports = createHeatmap;\n"]},"metadata":{},"sourceType":"script"}