{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../../lib');\n\nvar numberFormat = Lib.numberFormat;\n\nvar rgba = require('color-rgba');\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar strRotate = Lib.strRotate;\nvar strTranslate = Lib.strTranslate;\n\nvar svgTextUtils = require('../../lib/svg_text_utils');\n\nvar Drawing = require('../../components/drawing');\n\nvar Colorscale = require('../../components/colorscale');\n\nvar gup = require('../../lib/gup');\n\nvar keyFun = gup.keyFun;\nvar repeat = gup.repeat;\nvar unwrap = gup.unwrap;\n\nvar helpers = require('./helpers');\n\nvar c = require('./constants');\n\nvar brush = require('./axisbrush');\n\nvar lineLayerMaker = require('./lines');\n\nfunction findExtreme(fn, values, len) {\n  return Lib.aggNums(fn, null, values, len);\n}\n\nfunction findExtremes(values, len) {\n  return fixExtremes(findExtreme(Math.min, values, len), findExtreme(Math.max, values, len));\n}\n\nfunction dimensionExtent(dimension) {\n  var range = dimension.range;\n  return range ? fixExtremes(range[0], range[1]) : findExtremes(dimension.values, dimension._length);\n}\n\nfunction fixExtremes(lo, hi) {\n  if (isNaN(lo) || !isFinite(lo)) {\n    lo = 0;\n  }\n\n  if (isNaN(hi) || !isFinite(hi)) {\n    hi = 0;\n  } // avoid a degenerate (zero-width) domain\n\n\n  if (lo === hi) {\n    if (lo === 0) {\n      // no use to multiplying zero, so add/subtract in this case\n      lo -= 1;\n      hi += 1;\n    } else {\n      // this keeps the range in the order of magnitude of the data\n      lo *= 0.9;\n      hi *= 1.1;\n    }\n  }\n\n  return [lo, hi];\n}\n\nfunction toText(formatter, texts) {\n  if (texts) {\n    return function (v, i) {\n      var text = texts[i];\n      if (text === null || text === undefined) return formatter(v);\n      return text;\n    };\n  }\n\n  return formatter;\n}\n\nfunction domainScale(height, padding, dimension, tickvals, ticktext) {\n  var extent = dimensionExtent(dimension);\n\n  if (tickvals) {\n    return d3.scale.ordinal().domain(tickvals.map(toText(numberFormat(dimension.tickformat), ticktext))).range(tickvals.map(function (d) {\n      var unitVal = (d - extent[0]) / (extent[1] - extent[0]);\n      return height - padding + unitVal * (2 * padding - height);\n    }));\n  }\n\n  return d3.scale.linear().domain(extent).range([height - padding, padding]);\n}\n\nfunction unitToPaddedPx(height, padding) {\n  return d3.scale.linear().range([padding, height - padding]);\n}\n\nfunction domainToPaddedUnitScale(dimension, padFraction) {\n  return d3.scale.linear().domain(dimensionExtent(dimension)).range([padFraction, 1 - padFraction]);\n}\n\nfunction ordinalScale(dimension) {\n  if (!dimension.tickvals) return;\n  var extent = dimensionExtent(dimension);\n  return d3.scale.ordinal().domain(dimension.tickvals).range(dimension.tickvals.map(function (d) {\n    return (d - extent[0]) / (extent[1] - extent[0]);\n  }));\n}\n\nfunction unitToColorScale(cscale) {\n  var colorStops = cscale.map(function (d) {\n    return d[0];\n  });\n  var colorTuples = cscale.map(function (d) {\n    var RGBA = rgba(d[1]);\n    return d3.rgb('rgb(' + RGBA[0] + ',' + RGBA[1] + ',' + RGBA[2] + ')');\n  });\n\n  var prop = function (n) {\n    return function (o) {\n      return o[n];\n    };\n  }; // We can't use d3 color interpolation as we may have non-uniform color palette raster\n  // (various color stop distances).\n\n\n  var polylinearUnitScales = 'rgb'.split('').map(function (key) {\n    return d3.scale.linear().clamp(true).domain(colorStops).range(colorTuples.map(prop(key)));\n  });\n  return function (d) {\n    return polylinearUnitScales.map(function (s) {\n      return s(d);\n    });\n  };\n}\n\nfunction someFiltersActive(view) {\n  return view.dimensions.some(function (p) {\n    return p.brush.filterSpecified;\n  });\n}\n\nfunction model(layout, d, i) {\n  var cd0 = unwrap(d);\n  var trace = cd0.trace;\n  var lineColor = helpers.convertTypedArray(cd0.lineColor);\n  var line = trace.line;\n  var deselectedLines = {\n    color: rgba(c.deselectedLineColor)\n  };\n  var cOpts = Colorscale.extractOpts(line);\n  var cscale = cOpts.reversescale ? Colorscale.flipScale(cd0.cscale) : cd0.cscale;\n  var domain = trace.domain;\n  var dimensions = trace.dimensions;\n  var width = layout.width;\n  var labelAngle = trace.labelangle;\n  var labelSide = trace.labelside;\n  var labelFont = trace.labelfont;\n  var tickFont = trace.tickfont;\n  var rangeFont = trace.rangefont;\n  var lines = Lib.extendDeepNoArrays({}, line, {\n    color: lineColor.map(d3.scale.linear().domain(dimensionExtent({\n      values: lineColor,\n      range: [cOpts.min, cOpts.max],\n      _length: trace._length\n    }))),\n    blockLineCount: c.blockLineCount,\n    canvasOverdrag: c.overdrag * c.canvasPixelRatio\n  });\n  var groupWidth = Math.floor(width * (domain.x[1] - domain.x[0]));\n  var groupHeight = Math.floor(layout.height * (domain.y[1] - domain.y[0]));\n  var pad = layout.margin || {\n    l: 80,\n    r: 80,\n    t: 100,\n    b: 80\n  };\n  var rowContentWidth = groupWidth;\n  var rowHeight = groupHeight;\n  return {\n    key: i,\n    colCount: dimensions.filter(helpers.isVisible).length,\n    dimensions: dimensions,\n    tickDistance: c.tickDistance,\n    unitToColor: unitToColorScale(cscale),\n    lines: lines,\n    deselectedLines: deselectedLines,\n    labelAngle: labelAngle,\n    labelSide: labelSide,\n    labelFont: labelFont,\n    tickFont: tickFont,\n    rangeFont: rangeFont,\n    layoutWidth: width,\n    layoutHeight: layout.height,\n    domain: domain,\n    translateX: domain.x[0] * width,\n    translateY: layout.height - domain.y[1] * layout.height,\n    pad: pad,\n    canvasWidth: rowContentWidth * c.canvasPixelRatio + 2 * lines.canvasOverdrag,\n    canvasHeight: rowHeight * c.canvasPixelRatio,\n    width: rowContentWidth,\n    height: rowHeight,\n    canvasPixelRatio: c.canvasPixelRatio\n  };\n}\n\nfunction viewModel(state, callbacks, model) {\n  var width = model.width;\n  var height = model.height;\n  var dimensions = model.dimensions;\n  var canvasPixelRatio = model.canvasPixelRatio;\n\n  var xScale = function (d) {\n    return width * d / Math.max(1, model.colCount - 1);\n  };\n\n  var unitPad = c.verticalPadding / height;\n\n  var _unitToPaddedPx = unitToPaddedPx(height, c.verticalPadding);\n\n  var vm = {\n    key: model.key,\n    xScale: xScale,\n    model: model,\n    inBrushDrag: false // consider factoring it out and putting it in a centralized global-ish gesture state object\n\n  };\n  var uniqueKeys = {};\n  vm.dimensions = dimensions.filter(helpers.isVisible).map(function (dimension, i) {\n    var domainToPaddedUnit = domainToPaddedUnitScale(dimension, unitPad);\n    var foundKey = uniqueKeys[dimension.label];\n    uniqueKeys[dimension.label] = (foundKey || 0) + 1;\n    var key = dimension.label + (foundKey ? '__' + foundKey : '');\n    var specifiedConstraint = dimension.constraintrange;\n    var filterRangeSpecified = specifiedConstraint && specifiedConstraint.length;\n\n    if (filterRangeSpecified && !Array.isArray(specifiedConstraint[0])) {\n      specifiedConstraint = [specifiedConstraint];\n    }\n\n    var filterRange = filterRangeSpecified ? specifiedConstraint.map(function (d) {\n      return d.map(domainToPaddedUnit);\n    }) : [[-Infinity, Infinity]];\n\n    var brushMove = function () {\n      var p = vm;\n      p.focusLayer && p.focusLayer.render(p.panels, true);\n      var filtersActive = someFiltersActive(p);\n\n      if (!state.contextShown() && filtersActive) {\n        p.contextLayer && p.contextLayer.render(p.panels, true);\n        state.contextShown(true);\n      } else if (state.contextShown() && !filtersActive) {\n        p.contextLayer && p.contextLayer.render(p.panels, true, true);\n        state.contextShown(false);\n      }\n    };\n\n    var truncatedValues = dimension.values;\n\n    if (truncatedValues.length > dimension._length) {\n      truncatedValues = truncatedValues.slice(0, dimension._length);\n    }\n\n    var tickvals = dimension.tickvals;\n    var ticktext;\n\n    function makeTickItem(v, i) {\n      return {\n        val: v,\n        text: ticktext[i]\n      };\n    }\n\n    function sortTickItem(a, b) {\n      return a.val - b.val;\n    }\n\n    if (Array.isArray(tickvals) && tickvals.length) {\n      ticktext = dimension.ticktext; // ensure ticktext and tickvals have same length\n\n      if (!Array.isArray(ticktext) || !ticktext.length) {\n        ticktext = tickvals.map(numberFormat(dimension.tickformat));\n      } else if (ticktext.length > tickvals.length) {\n        ticktext = ticktext.slice(0, tickvals.length);\n      } else if (tickvals.length > ticktext.length) {\n        tickvals = tickvals.slice(0, ticktext.length);\n      } // check if we need to sort tickvals/ticktext\n\n\n      for (var j = 1; j < tickvals.length; j++) {\n        if (tickvals[j] < tickvals[j - 1]) {\n          var tickItems = tickvals.map(makeTickItem).sort(sortTickItem);\n\n          for (var k = 0; k < tickvals.length; k++) {\n            tickvals[k] = tickItems[k].val;\n            ticktext[k] = tickItems[k].text;\n          }\n\n          break;\n        }\n      }\n    } else tickvals = undefined;\n\n    truncatedValues = helpers.convertTypedArray(truncatedValues);\n    return {\n      key: key,\n      label: dimension.label,\n      tickFormat: dimension.tickformat,\n      tickvals: tickvals,\n      ticktext: ticktext,\n      ordinal: helpers.isOrdinal(dimension),\n      multiselect: dimension.multiselect,\n      xIndex: i,\n      crossfilterDimensionIndex: i,\n      visibleIndex: dimension._index,\n      height: height,\n      values: truncatedValues,\n      paddedUnitValues: truncatedValues.map(domainToPaddedUnit),\n      unitTickvals: tickvals && tickvals.map(domainToPaddedUnit),\n      xScale: xScale,\n      x: xScale(i),\n      canvasX: xScale(i) * canvasPixelRatio,\n      unitToPaddedPx: _unitToPaddedPx,\n      domainScale: domainScale(height, c.verticalPadding, dimension, tickvals, ticktext),\n      ordinalScale: ordinalScale(dimension),\n      parent: vm,\n      model: model,\n      brush: brush.makeBrush(state, filterRangeSpecified, filterRange, function () {\n        state.linePickActive(false);\n      }, brushMove, function (f) {\n        vm.focusLayer.render(vm.panels, true);\n        vm.pickLayer && vm.pickLayer.render(vm.panels, true);\n        state.linePickActive(true);\n\n        if (callbacks && callbacks.filterChanged) {\n          var invScale = domainToPaddedUnit.invert; // update gd.data as if a Plotly.restyle were fired\n\n          var newRanges = f.map(function (r) {\n            return r.map(invScale).sort(Lib.sorterAsc);\n          }).sort(function (a, b) {\n            return a[0] - b[0];\n          });\n          callbacks.filterChanged(vm.key, dimension._index, newRanges);\n        }\n      })\n    };\n  });\n  return vm;\n}\n\nfunction styleExtentTexts(selection) {\n  selection.classed(c.cn.axisExtentText, true).attr('text-anchor', 'middle').style('cursor', 'default');\n}\n\nfunction parcoordsInteractionState() {\n  var linePickActive = true;\n  var contextShown = false;\n  return {\n    linePickActive: function (val) {\n      return arguments.length ? linePickActive = !!val : linePickActive;\n    },\n    contextShown: function (val) {\n      return arguments.length ? contextShown = !!val : contextShown;\n    }\n  };\n}\n\nfunction calcTilt(angle, position) {\n  var dir = position === 'top' ? 1 : -1;\n  var radians = angle * Math.PI / 180;\n  var dx = Math.sin(radians);\n  var dy = Math.cos(radians);\n  return {\n    dir: dir,\n    dx: dx,\n    dy: dy,\n    degrees: angle\n  };\n}\n\nfunction updatePanelLayout(yAxis, vm, plotGlPixelRatio) {\n  var panels = vm.panels || (vm.panels = []);\n  var data = yAxis.data();\n\n  for (var i = 0; i < data.length - 1; i++) {\n    var p = panels[i] || (panels[i] = {});\n    var dim0 = data[i];\n    var dim1 = data[i + 1];\n    p.dim0 = dim0;\n    p.dim1 = dim1;\n    p.canvasX = dim0.canvasX;\n    p.panelSizeX = dim1.canvasX - dim0.canvasX;\n    p.panelSizeY = vm.model.canvasHeight;\n    p.y = 0;\n    p.canvasY = 0;\n    p.plotGlPixelRatio = plotGlPixelRatio;\n  }\n}\n\nfunction calcAllTicks(cd) {\n  for (var i = 0; i < cd.length; i++) {\n    for (var j = 0; j < cd[i].length; j++) {\n      var trace = cd[i][j].trace;\n      var dimensions = trace.dimensions;\n\n      for (var k = 0; k < dimensions.length; k++) {\n        var values = dimensions[k].values;\n        var dim = dimensions[k]._ax;\n\n        if (dim) {\n          if (!dim.range) {\n            dim.range = findExtremes(values, trace._length);\n          } else {\n            dim.range = fixExtremes(dim.range[0], dim.range[1]);\n          }\n\n          if (!dim.dtick) {\n            dim.dtick = 0.01 * (Math.abs(dim.range[1] - dim.range[0]) || 1);\n          }\n\n          dim.tickformat = dimensions[k].tickformat;\n          Axes.calcTicks(dim);\n          dim.cleanRange();\n        }\n      }\n    }\n  }\n}\n\nfunction linearFormat(dim, v) {\n  return Axes.tickText(dim._ax, v, false).text;\n}\n\nfunction extremeText(d, isTop) {\n  if (d.ordinal) return '';\n  var domain = d.domainScale.domain();\n  var v = domain[isTop ? domain.length - 1 : 0];\n  return linearFormat(d.model.dimensions[d.visibleIndex], v);\n}\n\nmodule.exports = function parcoords(gd, cdModule, layout, callbacks) {\n  var fullLayout = gd._fullLayout;\n  var svg = fullLayout._toppaper;\n  var glContainer = fullLayout._glcontainer;\n  var plotGlPixelRatio = gd._context.plotGlPixelRatio;\n  var paperColor = gd._fullLayout.paper_bgcolor;\n  calcAllTicks(cdModule);\n  var state = parcoordsInteractionState();\n  var vm = cdModule.filter(function (d) {\n    return unwrap(d).trace.visible;\n  }).map(model.bind(0, layout)).map(viewModel.bind(0, state, callbacks));\n  glContainer.each(function (d, i) {\n    return Lib.extendFlat(d, vm[i]);\n  });\n  var glLayers = glContainer.selectAll('.gl-canvas').each(function (d) {\n    // FIXME: figure out how to handle multiple instances\n    d.viewModel = vm[0];\n    d.viewModel.plotGlPixelRatio = plotGlPixelRatio;\n    d.viewModel.paperColor = paperColor;\n    d.model = d.viewModel ? d.viewModel.model : null;\n  });\n  var lastHovered = null;\n  var pickLayer = glLayers.filter(function (d) {\n    return d.pick;\n  }); // emit hover / unhover event\n\n  pickLayer.style('pointer-events', 'auto').on('mousemove', function (d) {\n    if (state.linePickActive() && d.lineLayer && callbacks && callbacks.hover) {\n      var event = d3.event;\n      var cw = this.width;\n      var ch = this.height;\n      var pointer = d3.mouse(this);\n      var x = pointer[0];\n      var y = pointer[1];\n\n      if (x < 0 || y < 0 || x >= cw || y >= ch) {\n        return;\n      }\n\n      var pixel = d.lineLayer.readPixel(x, ch - 1 - y);\n      var found = pixel[3] !== 0; // inverse of the calcPickColor in `lines.js`; detailed comment there\n\n      var curveNumber = found ? pixel[2] + 256 * (pixel[1] + 256 * pixel[0]) : null;\n      var eventData = {\n        x: x,\n        y: y,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        dataIndex: d.model.key,\n        curveNumber: curveNumber\n      };\n\n      if (curveNumber !== lastHovered) {\n        // don't unnecessarily repeat the same hit (or miss)\n        if (found) {\n          callbacks.hover(eventData);\n        } else if (callbacks.unhover) {\n          callbacks.unhover(eventData);\n        }\n\n        lastHovered = curveNumber;\n      }\n    }\n  });\n  glLayers.style('opacity', function (d) {\n    return d.pick ? 0 : 1;\n  });\n  svg.style('background', 'rgba(255, 255, 255, 0)');\n  var controlOverlay = svg.selectAll('.' + c.cn.parcoords).data(vm, keyFun);\n  controlOverlay.exit().remove();\n  controlOverlay.enter().append('g').classed(c.cn.parcoords, true).style('shape-rendering', 'crispEdges').style('pointer-events', 'none');\n  controlOverlay.attr('transform', function (d) {\n    return strTranslate(d.model.translateX, d.model.translateY);\n  });\n  var parcoordsControlView = controlOverlay.selectAll('.' + c.cn.parcoordsControlView).data(repeat, keyFun);\n  parcoordsControlView.enter().append('g').classed(c.cn.parcoordsControlView, true);\n  parcoordsControlView.attr('transform', function (d) {\n    return strTranslate(d.model.pad.l, d.model.pad.t);\n  });\n  var yAxis = parcoordsControlView.selectAll('.' + c.cn.yAxis).data(function (p) {\n    return p.dimensions;\n  }, keyFun);\n  yAxis.enter().append('g').classed(c.cn.yAxis, true);\n  parcoordsControlView.each(function (p) {\n    updatePanelLayout(yAxis, p, plotGlPixelRatio);\n  });\n  glLayers.each(function (d) {\n    if (d.viewModel) {\n      if (!d.lineLayer || callbacks) {\n        // recreate in case of having callbacks e.g. restyle. Should we test for callback to be a restyle?\n        d.lineLayer = lineLayerMaker(this, d);\n      } else d.lineLayer.update(d);\n\n      if (d.key || d.key === 0) d.viewModel[d.key] = d.lineLayer;\n      var setChanged = !d.context || // don't update background\n      callbacks; // unless there is a callback on the context layer. Should we test the callback?\n\n      d.lineLayer.render(d.viewModel.panels, setChanged);\n    }\n  });\n  yAxis.attr('transform', function (d) {\n    return strTranslate(d.xScale(d.xIndex), 0);\n  }); // drag column for reordering columns\n\n  yAxis.call(d3.behavior.drag().origin(function (d) {\n    return d;\n  }).on('drag', function (d) {\n    var p = d.parent;\n    state.linePickActive(false);\n    d.x = Math.max(-c.overdrag, Math.min(d.model.width + c.overdrag, d3.event.x));\n    d.canvasX = d.x * d.model.canvasPixelRatio;\n    yAxis.sort(function (a, b) {\n      return a.x - b.x;\n    }).each(function (e, i) {\n      e.xIndex = i;\n      e.x = d === e ? e.x : e.xScale(e.xIndex);\n      e.canvasX = e.x * e.model.canvasPixelRatio;\n    });\n    updatePanelLayout(yAxis, p, plotGlPixelRatio);\n    yAxis.filter(function (e) {\n      return Math.abs(d.xIndex - e.xIndex) !== 0;\n    }).attr('transform', function (d) {\n      return strTranslate(d.xScale(d.xIndex), 0);\n    });\n    d3.select(this).attr('transform', strTranslate(d.x, 0));\n    yAxis.each(function (e, i0, i1) {\n      if (i1 === d.parent.key) p.dimensions[i0] = e;\n    });\n    p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n    p.focusLayer.render && p.focusLayer.render(p.panels);\n  }).on('dragend', function (d) {\n    var p = d.parent;\n    d.x = d.xScale(d.xIndex);\n    d.canvasX = d.x * d.model.canvasPixelRatio;\n    updatePanelLayout(yAxis, p, plotGlPixelRatio);\n    d3.select(this).attr('transform', function (d) {\n      return strTranslate(d.x, 0);\n    });\n    p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n    p.focusLayer && p.focusLayer.render(p.panels);\n    p.pickLayer && p.pickLayer.render(p.panels, true);\n    state.linePickActive(true);\n\n    if (callbacks && callbacks.axesMoved) {\n      callbacks.axesMoved(p.key, p.dimensions.map(function (e) {\n        return e.crossfilterDimensionIndex;\n      }));\n    }\n  }));\n  yAxis.exit().remove();\n  var axisOverlays = yAxis.selectAll('.' + c.cn.axisOverlays).data(repeat, keyFun);\n  axisOverlays.enter().append('g').classed(c.cn.axisOverlays, true);\n  axisOverlays.selectAll('.' + c.cn.axis).remove();\n  var axis = axisOverlays.selectAll('.' + c.cn.axis).data(repeat, keyFun);\n  axis.enter().append('g').classed(c.cn.axis, true);\n  axis.each(function (d) {\n    var wantedTickCount = d.model.height / d.model.tickDistance;\n    var scale = d.domainScale;\n    var sdom = scale.domain();\n    d3.select(this).call(d3.svg.axis().orient('left').tickSize(4).outerTickSize(2).ticks(wantedTickCount, d.tickFormat) // works for continuous scales only...\n    .tickValues(d.ordinal ? // and this works for ordinal scales\n    sdom : null).tickFormat(function (v) {\n      return helpers.isOrdinal(d) ? v : linearFormat(d.model.dimensions[d.visibleIndex], v);\n    }).scale(scale));\n    Drawing.font(axis.selectAll('text'), d.model.tickFont);\n  });\n  axis.selectAll('.domain, .tick>line').attr('fill', 'none').attr('stroke', 'black').attr('stroke-opacity', 0.25).attr('stroke-width', '1px');\n  axis.selectAll('text').style('text-shadow', svgTextUtils.makeTextShadow(paperColor)).style('cursor', 'default');\n  var axisHeading = axisOverlays.selectAll('.' + c.cn.axisHeading).data(repeat, keyFun);\n  axisHeading.enter().append('g').classed(c.cn.axisHeading, true);\n  var axisTitle = axisHeading.selectAll('.' + c.cn.axisTitle).data(repeat, keyFun);\n  axisTitle.enter().append('text').classed(c.cn.axisTitle, true).attr('text-anchor', 'middle').style('cursor', 'ew-resize').style('pointer-events', 'auto');\n  axisTitle.text(function (d) {\n    return d.label;\n  }).each(function (d) {\n    var e = d3.select(this);\n    Drawing.font(e, d.model.labelFont);\n    svgTextUtils.convertToTspans(e, gd);\n  }).attr('transform', function (d) {\n    var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n    var r = c.axisTitleOffset;\n    return (tilt.dir > 0 ? '' : strTranslate(0, 2 * r + d.model.height)) + strRotate(tilt.degrees) + strTranslate(-r * tilt.dx, -r * tilt.dy);\n  }).attr('text-anchor', function (d) {\n    var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n    var adx = Math.abs(tilt.dx);\n    var ady = Math.abs(tilt.dy);\n\n    if (2 * adx > ady) {\n      return tilt.dir * tilt.dx < 0 ? 'start' : 'end';\n    } else {\n      return 'middle';\n    }\n  });\n  var axisExtent = axisOverlays.selectAll('.' + c.cn.axisExtent).data(repeat, keyFun);\n  axisExtent.enter().append('g').classed(c.cn.axisExtent, true);\n  var axisExtentTop = axisExtent.selectAll('.' + c.cn.axisExtentTop).data(repeat, keyFun);\n  axisExtentTop.enter().append('g').classed(c.cn.axisExtentTop, true);\n  axisExtentTop.attr('transform', strTranslate(0, -c.axisExtentOffset));\n  var axisExtentTopText = axisExtentTop.selectAll('.' + c.cn.axisExtentTopText).data(repeat, keyFun);\n  axisExtentTopText.enter().append('text').classed(c.cn.axisExtentTopText, true).call(styleExtentTexts);\n  axisExtentTopText.text(function (d) {\n    return extremeText(d, true);\n  }).each(function (d) {\n    Drawing.font(d3.select(this), d.model.rangeFont);\n  });\n  var axisExtentBottom = axisExtent.selectAll('.' + c.cn.axisExtentBottom).data(repeat, keyFun);\n  axisExtentBottom.enter().append('g').classed(c.cn.axisExtentBottom, true);\n  axisExtentBottom.attr('transform', function (d) {\n    return strTranslate(0, d.model.height + c.axisExtentOffset);\n  });\n  var axisExtentBottomText = axisExtentBottom.selectAll('.' + c.cn.axisExtentBottomText).data(repeat, keyFun);\n  axisExtentBottomText.enter().append('text').classed(c.cn.axisExtentBottomText, true).attr('dy', '0.75em').call(styleExtentTexts);\n  axisExtentBottomText.text(function (d) {\n    return extremeText(d, false);\n  }).each(function (d) {\n    Drawing.font(d3.select(this), d.model.rangeFont);\n  });\n  brush.ensureAxisBrush(axisOverlays, paperColor);\n};","map":{"version":3,"sources":["C:/Projects/reactApp/analyse_coderhub/node_modules/plotly.js/src/traces/parcoords/parcoords.js"],"names":["d3","require","Lib","numberFormat","rgba","Axes","strRotate","strTranslate","svgTextUtils","Drawing","Colorscale","gup","keyFun","repeat","unwrap","helpers","c","brush","lineLayerMaker","findExtreme","fn","values","len","aggNums","findExtremes","fixExtremes","Math","min","max","dimensionExtent","dimension","range","_length","lo","hi","isNaN","isFinite","toText","formatter","texts","v","i","text","undefined","domainScale","height","padding","tickvals","ticktext","extent","scale","ordinal","domain","map","tickformat","d","unitVal","linear","unitToPaddedPx","domainToPaddedUnitScale","padFraction","ordinalScale","unitToColorScale","cscale","colorStops","colorTuples","RGBA","rgb","prop","n","o","polylinearUnitScales","split","key","clamp","s","someFiltersActive","view","dimensions","some","p","filterSpecified","model","layout","cd0","trace","lineColor","convertTypedArray","line","deselectedLines","color","deselectedLineColor","cOpts","extractOpts","reversescale","flipScale","width","labelAngle","labelangle","labelSide","labelside","labelFont","labelfont","tickFont","tickfont","rangeFont","rangefont","lines","extendDeepNoArrays","blockLineCount","canvasOverdrag","overdrag","canvasPixelRatio","groupWidth","floor","x","groupHeight","y","pad","margin","l","r","t","b","rowContentWidth","rowHeight","colCount","filter","isVisible","length","tickDistance","unitToColor","layoutWidth","layoutHeight","translateX","translateY","canvasWidth","canvasHeight","viewModel","state","callbacks","xScale","unitPad","verticalPadding","_unitToPaddedPx","vm","inBrushDrag","uniqueKeys","domainToPaddedUnit","foundKey","label","specifiedConstraint","constraintrange","filterRangeSpecified","Array","isArray","filterRange","Infinity","brushMove","focusLayer","render","panels","filtersActive","contextShown","contextLayer","truncatedValues","slice","makeTickItem","val","sortTickItem","a","j","tickItems","sort","k","tickFormat","isOrdinal","multiselect","xIndex","crossfilterDimensionIndex","visibleIndex","_index","paddedUnitValues","unitTickvals","canvasX","parent","makeBrush","linePickActive","f","pickLayer","filterChanged","invScale","invert","newRanges","sorterAsc","styleExtentTexts","selection","classed","cn","axisExtentText","attr","style","parcoordsInteractionState","arguments","calcTilt","angle","position","dir","radians","PI","dx","sin","dy","cos","degrees","updatePanelLayout","yAxis","plotGlPixelRatio","data","dim0","dim1","panelSizeX","panelSizeY","canvasY","calcAllTicks","cd","dim","_ax","dtick","abs","calcTicks","cleanRange","linearFormat","tickText","extremeText","isTop","module","exports","parcoords","gd","cdModule","fullLayout","_fullLayout","svg","_toppaper","glContainer","_glcontainer","_context","paperColor","paper_bgcolor","visible","bind","each","extendFlat","glLayers","selectAll","lastHovered","pick","on","lineLayer","hover","event","cw","ch","pointer","mouse","pixel","readPixel","found","curveNumber","eventData","clientX","clientY","dataIndex","unhover","controlOverlay","exit","remove","enter","append","parcoordsControlView","update","setChanged","context","call","behavior","drag","origin","e","select","i0","i1","axesMoved","axisOverlays","axis","wantedTickCount","sdom","orient","tickSize","outerTickSize","ticks","tickValues","font","makeTextShadow","axisHeading","axisTitle","convertToTspans","tilt","axisTitleOffset","adx","ady","axisExtent","axisExtentTop","axisExtentOffset","axisExtentTopText","axisExtentBottom","axisExtentBottomText","ensureAxisBrush"],"mappings":"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","sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\nvar Lib = require('../../lib');\nvar numberFormat = Lib.numberFormat;\nvar rgba = require('color-rgba');\n\nvar Axes = require('../../plots/cartesian/axes');\nvar strRotate = Lib.strRotate;\nvar strTranslate = Lib.strTranslate;\nvar svgTextUtils = require('../../lib/svg_text_utils');\nvar Drawing = require('../../components/drawing');\nvar Colorscale = require('../../components/colorscale');\n\nvar gup = require('../../lib/gup');\nvar keyFun = gup.keyFun;\nvar repeat = gup.repeat;\nvar unwrap = gup.unwrap;\n\nvar helpers = require('./helpers');\nvar c = require('./constants');\nvar brush = require('./axisbrush');\nvar lineLayerMaker = require('./lines');\n\nfunction findExtreme(fn, values, len) {\n    return Lib.aggNums(fn, null, values, len);\n}\n\nfunction findExtremes(values, len) {\n    return fixExtremes(\n        findExtreme(Math.min, values, len),\n        findExtreme(Math.max, values, len)\n    );\n}\n\nfunction dimensionExtent(dimension) {\n    var range = dimension.range;\n    return range ?\n        fixExtremes(range[0], range[1]) :\n        findExtremes(dimension.values, dimension._length);\n}\n\nfunction fixExtremes(lo, hi) {\n    if(isNaN(lo) || !isFinite(lo)) {\n        lo = 0;\n    }\n\n    if(isNaN(hi) || !isFinite(hi)) {\n        hi = 0;\n    }\n\n    // avoid a degenerate (zero-width) domain\n    if(lo === hi) {\n        if(lo === 0) {\n            // no use to multiplying zero, so add/subtract in this case\n            lo -= 1;\n            hi += 1;\n        } else {\n            // this keeps the range in the order of magnitude of the data\n            lo *= 0.9;\n            hi *= 1.1;\n        }\n    }\n\n    return [lo, hi];\n}\n\nfunction toText(formatter, texts) {\n    if(texts) {\n        return function(v, i) {\n            var text = texts[i];\n            if(text === null || text === undefined) return formatter(v);\n            return text;\n        };\n    }\n    return formatter;\n}\n\nfunction domainScale(height, padding, dimension, tickvals, ticktext) {\n    var extent = dimensionExtent(dimension);\n    if(tickvals) {\n        return d3.scale.ordinal()\n            .domain(tickvals.map(toText(numberFormat(dimension.tickformat), ticktext)))\n            .range(tickvals\n                .map(function(d) {\n                    var unitVal = (d - extent[0]) / (extent[1] - extent[0]);\n                    return (height - padding + unitVal * (2 * padding - height));\n                })\n            );\n    }\n    return d3.scale.linear()\n        .domain(extent)\n        .range([height - padding, padding]);\n}\n\nfunction unitToPaddedPx(height, padding) {\n    return d3.scale.linear().range([padding, height - padding]);\n}\n\nfunction domainToPaddedUnitScale(dimension, padFraction) {\n    return d3.scale.linear()\n        .domain(dimensionExtent(dimension))\n        .range([padFraction, 1 - padFraction]);\n}\n\nfunction ordinalScale(dimension) {\n    if(!dimension.tickvals) return;\n\n    var extent = dimensionExtent(dimension);\n    return d3.scale.ordinal()\n        .domain(dimension.tickvals)\n        .range(dimension.tickvals.map(function(d) {\n            return (d - extent[0]) / (extent[1] - extent[0]);\n        }));\n}\n\nfunction unitToColorScale(cscale) {\n    var colorStops = cscale.map(function(d) { return d[0]; });\n    var colorTuples = cscale.map(function(d) {\n        var RGBA = rgba(d[1]);\n        return d3.rgb('rgb(' + RGBA[0] + ',' + RGBA[1] + ',' + RGBA[2] + ')');\n    });\n    var prop = function(n) { return function(o) { return o[n]; }; };\n\n    // We can't use d3 color interpolation as we may have non-uniform color palette raster\n    // (various color stop distances).\n    var polylinearUnitScales = 'rgb'.split('').map(function(key) {\n        return d3.scale.linear()\n            .clamp(true)\n            .domain(colorStops)\n            .range(colorTuples.map(prop(key)));\n    });\n\n    return function(d) {\n        return polylinearUnitScales.map(function(s) {\n            return s(d);\n        });\n    };\n}\n\nfunction someFiltersActive(view) {\n    return view.dimensions.some(function(p) {\n        return p.brush.filterSpecified;\n    });\n}\n\nfunction model(layout, d, i) {\n    var cd0 = unwrap(d);\n    var trace = cd0.trace;\n    var lineColor = helpers.convertTypedArray(cd0.lineColor);\n    var line = trace.line;\n    var deselectedLines = {color: rgba(c.deselectedLineColor)};\n    var cOpts = Colorscale.extractOpts(line);\n    var cscale = cOpts.reversescale ? Colorscale.flipScale(cd0.cscale) : cd0.cscale;\n    var domain = trace.domain;\n    var dimensions = trace.dimensions;\n    var width = layout.width;\n    var labelAngle = trace.labelangle;\n    var labelSide = trace.labelside;\n    var labelFont = trace.labelfont;\n    var tickFont = trace.tickfont;\n    var rangeFont = trace.rangefont;\n\n    var lines = Lib.extendDeepNoArrays({}, line, {\n        color: lineColor.map(d3.scale.linear().domain(\n            dimensionExtent({\n                values: lineColor,\n                range: [cOpts.min, cOpts.max],\n                _length: trace._length\n            })\n        )),\n        blockLineCount: c.blockLineCount,\n        canvasOverdrag: c.overdrag * c.canvasPixelRatio\n    });\n\n    var groupWidth = Math.floor(width * (domain.x[1] - domain.x[0]));\n    var groupHeight = Math.floor(layout.height * (domain.y[1] - domain.y[0]));\n\n    var pad = layout.margin || {l: 80, r: 80, t: 100, b: 80};\n    var rowContentWidth = groupWidth;\n    var rowHeight = groupHeight;\n\n    return {\n        key: i,\n        colCount: dimensions.filter(helpers.isVisible).length,\n        dimensions: dimensions,\n        tickDistance: c.tickDistance,\n        unitToColor: unitToColorScale(cscale),\n        lines: lines,\n        deselectedLines: deselectedLines,\n        labelAngle: labelAngle,\n        labelSide: labelSide,\n        labelFont: labelFont,\n        tickFont: tickFont,\n        rangeFont: rangeFont,\n        layoutWidth: width,\n        layoutHeight: layout.height,\n        domain: domain,\n        translateX: domain.x[0] * width,\n        translateY: layout.height - domain.y[1] * layout.height,\n        pad: pad,\n        canvasWidth: rowContentWidth * c.canvasPixelRatio + 2 * lines.canvasOverdrag,\n        canvasHeight: rowHeight * c.canvasPixelRatio,\n        width: rowContentWidth,\n        height: rowHeight,\n        canvasPixelRatio: c.canvasPixelRatio\n    };\n}\n\nfunction viewModel(state, callbacks, model) {\n    var width = model.width;\n    var height = model.height;\n    var dimensions = model.dimensions;\n    var canvasPixelRatio = model.canvasPixelRatio;\n\n    var xScale = function(d) {return width * d / Math.max(1, model.colCount - 1);};\n\n    var unitPad = c.verticalPadding / height;\n    var _unitToPaddedPx = unitToPaddedPx(height, c.verticalPadding);\n\n    var vm = {\n        key: model.key,\n        xScale: xScale,\n        model: model,\n        inBrushDrag: false // consider factoring it out and putting it in a centralized global-ish gesture state object\n    };\n\n    var uniqueKeys = {};\n\n    vm.dimensions = dimensions.filter(helpers.isVisible).map(function(dimension, i) {\n        var domainToPaddedUnit = domainToPaddedUnitScale(dimension, unitPad);\n        var foundKey = uniqueKeys[dimension.label];\n        uniqueKeys[dimension.label] = (foundKey || 0) + 1;\n        var key = dimension.label + (foundKey ? '__' + foundKey : '');\n        var specifiedConstraint = dimension.constraintrange;\n        var filterRangeSpecified = specifiedConstraint && specifiedConstraint.length;\n        if(filterRangeSpecified && !Array.isArray(specifiedConstraint[0])) {\n            specifiedConstraint = [specifiedConstraint];\n        }\n        var filterRange = filterRangeSpecified ?\n            specifiedConstraint.map(function(d) { return d.map(domainToPaddedUnit); }) :\n            [[-Infinity, Infinity]];\n        var brushMove = function() {\n            var p = vm;\n            p.focusLayer && p.focusLayer.render(p.panels, true);\n            var filtersActive = someFiltersActive(p);\n            if(!state.contextShown() && filtersActive) {\n                p.contextLayer && p.contextLayer.render(p.panels, true);\n                state.contextShown(true);\n            } else if(state.contextShown() && !filtersActive) {\n                p.contextLayer && p.contextLayer.render(p.panels, true, true);\n                state.contextShown(false);\n            }\n        };\n\n        var truncatedValues = dimension.values;\n        if(truncatedValues.length > dimension._length) {\n            truncatedValues = truncatedValues.slice(0, dimension._length);\n        }\n\n        var tickvals = dimension.tickvals;\n        var ticktext;\n        function makeTickItem(v, i) { return {val: v, text: ticktext[i]}; }\n        function sortTickItem(a, b) { return a.val - b.val; }\n        if(Array.isArray(tickvals) && tickvals.length) {\n            ticktext = dimension.ticktext;\n\n            // ensure ticktext and tickvals have same length\n            if(!Array.isArray(ticktext) || !ticktext.length) {\n                ticktext = tickvals.map(numberFormat(dimension.tickformat));\n            } else if(ticktext.length > tickvals.length) {\n                ticktext = ticktext.slice(0, tickvals.length);\n            } else if(tickvals.length > ticktext.length) {\n                tickvals = tickvals.slice(0, ticktext.length);\n            }\n\n            // check if we need to sort tickvals/ticktext\n            for(var j = 1; j < tickvals.length; j++) {\n                if(tickvals[j] < tickvals[j - 1]) {\n                    var tickItems = tickvals.map(makeTickItem).sort(sortTickItem);\n                    for(var k = 0; k < tickvals.length; k++) {\n                        tickvals[k] = tickItems[k].val;\n                        ticktext[k] = tickItems[k].text;\n                    }\n                    break;\n                }\n            }\n        } else tickvals = undefined;\n\n        truncatedValues = helpers.convertTypedArray(truncatedValues);\n\n        return {\n            key: key,\n            label: dimension.label,\n            tickFormat: dimension.tickformat,\n            tickvals: tickvals,\n            ticktext: ticktext,\n            ordinal: helpers.isOrdinal(dimension),\n            multiselect: dimension.multiselect,\n            xIndex: i,\n            crossfilterDimensionIndex: i,\n            visibleIndex: dimension._index,\n            height: height,\n            values: truncatedValues,\n            paddedUnitValues: truncatedValues.map(domainToPaddedUnit),\n            unitTickvals: tickvals && tickvals.map(domainToPaddedUnit),\n            xScale: xScale,\n            x: xScale(i),\n            canvasX: xScale(i) * canvasPixelRatio,\n            unitToPaddedPx: _unitToPaddedPx,\n            domainScale: domainScale(height, c.verticalPadding, dimension, tickvals, ticktext),\n            ordinalScale: ordinalScale(dimension),\n            parent: vm,\n            model: model,\n            brush: brush.makeBrush(\n                state,\n                filterRangeSpecified,\n                filterRange,\n                function() {\n                    state.linePickActive(false);\n                },\n                brushMove,\n                function(f) {\n                    vm.focusLayer.render(vm.panels, true);\n                    vm.pickLayer && vm.pickLayer.render(vm.panels, true);\n                    state.linePickActive(true);\n                    if(callbacks && callbacks.filterChanged) {\n                        var invScale = domainToPaddedUnit.invert;\n\n                        // update gd.data as if a Plotly.restyle were fired\n                        var newRanges = f.map(function(r) {\n                            return r.map(invScale).sort(Lib.sorterAsc);\n                        }).sort(function(a, b) { return a[0] - b[0]; });\n                        callbacks.filterChanged(vm.key, dimension._index, newRanges);\n                    }\n                }\n            )\n        };\n    });\n\n    return vm;\n}\n\nfunction styleExtentTexts(selection) {\n    selection\n        .classed(c.cn.axisExtentText, true)\n        .attr('text-anchor', 'middle')\n        .style('cursor', 'default');\n}\n\nfunction parcoordsInteractionState() {\n    var linePickActive = true;\n    var contextShown = false;\n    return {\n        linePickActive: function(val) {return arguments.length ? linePickActive = !!val : linePickActive;},\n        contextShown: function(val) {return arguments.length ? contextShown = !!val : contextShown;}\n    };\n}\n\nfunction calcTilt(angle, position) {\n    var dir = (position === 'top') ? 1 : -1;\n    var radians = angle * Math.PI / 180;\n    var dx = Math.sin(radians);\n    var dy = Math.cos(radians);\n    return {\n        dir: dir,\n        dx: dx,\n        dy: dy,\n        degrees: angle\n    };\n}\n\nfunction updatePanelLayout(yAxis, vm, plotGlPixelRatio) {\n    var panels = vm.panels || (vm.panels = []);\n    var data = yAxis.data();\n    for(var i = 0; i < data.length - 1; i++) {\n        var p = panels[i] || (panels[i] = {});\n        var dim0 = data[i];\n        var dim1 = data[i + 1];\n        p.dim0 = dim0;\n        p.dim1 = dim1;\n        p.canvasX = dim0.canvasX;\n        p.panelSizeX = dim1.canvasX - dim0.canvasX;\n        p.panelSizeY = vm.model.canvasHeight;\n        p.y = 0;\n        p.canvasY = 0;\n        p.plotGlPixelRatio = plotGlPixelRatio;\n    }\n}\n\nfunction calcAllTicks(cd) {\n    for(var i = 0; i < cd.length; i++) {\n        for(var j = 0; j < cd[i].length; j++) {\n            var trace = cd[i][j].trace;\n            var dimensions = trace.dimensions;\n\n            for(var k = 0; k < dimensions.length; k++) {\n                var values = dimensions[k].values;\n                var dim = dimensions[k]._ax;\n\n                if(dim) {\n                    if(!dim.range) {\n                        dim.range = findExtremes(values, trace._length);\n                    } else {\n                        dim.range = fixExtremes(dim.range[0], dim.range[1]);\n                    }\n\n                    if(!dim.dtick) {\n                        dim.dtick = 0.01 * (Math.abs(dim.range[1] - dim.range[0]) || 1);\n                    }\n\n                    dim.tickformat = dimensions[k].tickformat;\n                    Axes.calcTicks(dim);\n                    dim.cleanRange();\n                }\n            }\n        }\n    }\n}\n\nfunction linearFormat(dim, v) {\n    return Axes.tickText(dim._ax, v, false).text;\n}\n\nfunction extremeText(d, isTop) {\n    if(d.ordinal) return '';\n    var domain = d.domainScale.domain();\n    var v = (domain[isTop ? domain.length - 1 : 0]);\n\n    return linearFormat(d.model.dimensions[d.visibleIndex], v);\n}\n\n\nmodule.exports = function parcoords(gd, cdModule, layout, callbacks) {\n    var fullLayout = gd._fullLayout;\n    var svg = fullLayout._toppaper;\n    var glContainer = fullLayout._glcontainer;\n    var plotGlPixelRatio = gd._context.plotGlPixelRatio;\n    var paperColor = gd._fullLayout.paper_bgcolor;\n\n    calcAllTicks(cdModule);\n\n    var state = parcoordsInteractionState();\n\n    var vm = cdModule\n        .filter(function(d) { return unwrap(d).trace.visible; })\n        .map(model.bind(0, layout))\n        .map(viewModel.bind(0, state, callbacks));\n\n    glContainer.each(function(d, i) {\n        return Lib.extendFlat(d, vm[i]);\n    });\n\n    var glLayers = glContainer.selectAll('.gl-canvas')\n        .each(function(d) {\n            // FIXME: figure out how to handle multiple instances\n            d.viewModel = vm[0];\n            d.viewModel.plotGlPixelRatio = plotGlPixelRatio;\n            d.viewModel.paperColor = paperColor;\n            d.model = d.viewModel ? d.viewModel.model : null;\n        });\n\n    var lastHovered = null;\n\n    var pickLayer = glLayers.filter(function(d) {return d.pick;});\n\n    // emit hover / unhover event\n    pickLayer\n        .style('pointer-events', 'auto')\n        .on('mousemove', function(d) {\n            if(state.linePickActive() && d.lineLayer && callbacks && callbacks.hover) {\n                var event = d3.event;\n                var cw = this.width;\n                var ch = this.height;\n                var pointer = d3.mouse(this);\n                var x = pointer[0];\n                var y = pointer[1];\n\n                if(x < 0 || y < 0 || x >= cw || y >= ch) {\n                    return;\n                }\n                var pixel = d.lineLayer.readPixel(x, ch - 1 - y);\n                var found = pixel[3] !== 0;\n                // inverse of the calcPickColor in `lines.js`; detailed comment there\n                var curveNumber = found ? pixel[2] + 256 * (pixel[1] + 256 * pixel[0]) : null;\n                var eventData = {\n                    x: x,\n                    y: y,\n                    clientX: event.clientX,\n                    clientY: event.clientY,\n                    dataIndex: d.model.key,\n                    curveNumber: curveNumber\n                };\n                if(curveNumber !== lastHovered) { // don't unnecessarily repeat the same hit (or miss)\n                    if(found) {\n                        callbacks.hover(eventData);\n                    } else if(callbacks.unhover) {\n                        callbacks.unhover(eventData);\n                    }\n                    lastHovered = curveNumber;\n                }\n            }\n        });\n\n    glLayers\n        .style('opacity', function(d) {return d.pick ? 0 : 1;});\n\n    svg.style('background', 'rgba(255, 255, 255, 0)');\n    var controlOverlay = svg.selectAll('.' + c.cn.parcoords)\n        .data(vm, keyFun);\n\n    controlOverlay.exit().remove();\n\n    controlOverlay.enter()\n        .append('g')\n        .classed(c.cn.parcoords, true)\n        .style('shape-rendering', 'crispEdges')\n        .style('pointer-events', 'none');\n\n    controlOverlay.attr('transform', function(d) {\n        return strTranslate(d.model.translateX, d.model.translateY);\n    });\n\n    var parcoordsControlView = controlOverlay.selectAll('.' + c.cn.parcoordsControlView)\n        .data(repeat, keyFun);\n\n    parcoordsControlView.enter()\n        .append('g')\n        .classed(c.cn.parcoordsControlView, true);\n\n    parcoordsControlView.attr('transform', function(d) {\n        return strTranslate(d.model.pad.l, d.model.pad.t);\n    });\n\n    var yAxis = parcoordsControlView.selectAll('.' + c.cn.yAxis)\n        .data(function(p) { return p.dimensions; }, keyFun);\n\n    yAxis.enter()\n        .append('g')\n        .classed(c.cn.yAxis, true);\n\n    parcoordsControlView.each(function(p) {\n        updatePanelLayout(yAxis, p, plotGlPixelRatio);\n    });\n\n    glLayers\n        .each(function(d) {\n            if(d.viewModel) {\n                if(!d.lineLayer || callbacks) { // recreate in case of having callbacks e.g. restyle. Should we test for callback to be a restyle?\n                    d.lineLayer = lineLayerMaker(this, d);\n                } else d.lineLayer.update(d);\n\n                if(d.key || d.key === 0) d.viewModel[d.key] = d.lineLayer;\n\n                var setChanged = (!d.context || // don't update background\n                                  callbacks);   // unless there is a callback on the context layer. Should we test the callback?\n\n                d.lineLayer.render(d.viewModel.panels, setChanged);\n            }\n        });\n\n    yAxis.attr('transform', function(d) {\n        return strTranslate(d.xScale(d.xIndex), 0);\n    });\n\n    // drag column for reordering columns\n    yAxis.call(d3.behavior.drag()\n        .origin(function(d) { return d; })\n        .on('drag', function(d) {\n            var p = d.parent;\n            state.linePickActive(false);\n            d.x = Math.max(-c.overdrag, Math.min(d.model.width + c.overdrag, d3.event.x));\n            d.canvasX = d.x * d.model.canvasPixelRatio;\n            yAxis\n                .sort(function(a, b) { return a.x - b.x; })\n                .each(function(e, i) {\n                    e.xIndex = i;\n                    e.x = d === e ? e.x : e.xScale(e.xIndex);\n                    e.canvasX = e.x * e.model.canvasPixelRatio;\n                });\n\n            updatePanelLayout(yAxis, p, plotGlPixelRatio);\n\n            yAxis.filter(function(e) { return Math.abs(d.xIndex - e.xIndex) !== 0; })\n                .attr('transform', function(d) { return strTranslate(d.xScale(d.xIndex), 0); });\n            d3.select(this).attr('transform', strTranslate(d.x, 0));\n            yAxis.each(function(e, i0, i1) { if(i1 === d.parent.key) p.dimensions[i0] = e; });\n            p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n            p.focusLayer.render && p.focusLayer.render(p.panels);\n        })\n        .on('dragend', function(d) {\n            var p = d.parent;\n            d.x = d.xScale(d.xIndex);\n            d.canvasX = d.x * d.model.canvasPixelRatio;\n            updatePanelLayout(yAxis, p, plotGlPixelRatio);\n            d3.select(this)\n                .attr('transform', function(d) { return strTranslate(d.x, 0); });\n            p.contextLayer && p.contextLayer.render(p.panels, false, !someFiltersActive(p));\n            p.focusLayer && p.focusLayer.render(p.panels);\n            p.pickLayer && p.pickLayer.render(p.panels, true);\n            state.linePickActive(true);\n\n            if(callbacks && callbacks.axesMoved) {\n                callbacks.axesMoved(p.key, p.dimensions.map(function(e) {return e.crossfilterDimensionIndex;}));\n            }\n        })\n    );\n\n    yAxis.exit()\n        .remove();\n\n    var axisOverlays = yAxis.selectAll('.' + c.cn.axisOverlays)\n        .data(repeat, keyFun);\n\n    axisOverlays.enter()\n        .append('g')\n        .classed(c.cn.axisOverlays, true);\n\n    axisOverlays.selectAll('.' + c.cn.axis).remove();\n\n    var axis = axisOverlays.selectAll('.' + c.cn.axis)\n        .data(repeat, keyFun);\n\n    axis.enter()\n        .append('g')\n        .classed(c.cn.axis, true);\n\n    axis\n        .each(function(d) {\n            var wantedTickCount = d.model.height / d.model.tickDistance;\n            var scale = d.domainScale;\n            var sdom = scale.domain();\n            d3.select(this)\n                .call(d3.svg.axis()\n                    .orient('left')\n                    .tickSize(4)\n                    .outerTickSize(2)\n                    .ticks(wantedTickCount, d.tickFormat) // works for continuous scales only...\n                    .tickValues(d.ordinal ? // and this works for ordinal scales\n                        sdom :\n                        null)\n                    .tickFormat(function(v) {\n                        return helpers.isOrdinal(d) ? v : linearFormat(d.model.dimensions[d.visibleIndex], v);\n                    })\n                    .scale(scale));\n            Drawing.font(axis.selectAll('text'), d.model.tickFont);\n        });\n\n    axis.selectAll('.domain, .tick>line')\n        .attr('fill', 'none')\n        .attr('stroke', 'black')\n        .attr('stroke-opacity', 0.25)\n        .attr('stroke-width', '1px');\n\n    axis.selectAll('text')\n        .style('text-shadow', svgTextUtils.makeTextShadow(paperColor))\n        .style('cursor', 'default');\n\n    var axisHeading = axisOverlays.selectAll('.' + c.cn.axisHeading)\n        .data(repeat, keyFun);\n\n    axisHeading.enter()\n        .append('g')\n        .classed(c.cn.axisHeading, true);\n\n    var axisTitle = axisHeading.selectAll('.' + c.cn.axisTitle)\n        .data(repeat, keyFun);\n\n    axisTitle.enter()\n        .append('text')\n        .classed(c.cn.axisTitle, true)\n        .attr('text-anchor', 'middle')\n        .style('cursor', 'ew-resize')\n        .style('pointer-events', 'auto');\n\n    axisTitle\n        .text(function(d) { return d.label; })\n        .each(function(d) {\n            var e = d3.select(this);\n            Drawing.font(e, d.model.labelFont);\n            svgTextUtils.convertToTspans(e, gd);\n        })\n        .attr('transform', function(d) {\n            var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n            var r = c.axisTitleOffset;\n            return (\n                (tilt.dir > 0 ? '' : strTranslate(0, 2 * r + d.model.height)) +\n                strRotate(tilt.degrees) +\n                strTranslate(-r * tilt.dx, -r * tilt.dy)\n            );\n        })\n        .attr('text-anchor', function(d) {\n            var tilt = calcTilt(d.model.labelAngle, d.model.labelSide);\n            var adx = Math.abs(tilt.dx);\n            var ady = Math.abs(tilt.dy);\n\n            if(2 * adx > ady) {\n                return (tilt.dir * tilt.dx < 0) ? 'start' : 'end';\n            } else {\n                return 'middle';\n            }\n        });\n\n    var axisExtent = axisOverlays.selectAll('.' + c.cn.axisExtent)\n        .data(repeat, keyFun);\n\n    axisExtent.enter()\n        .append('g')\n        .classed(c.cn.axisExtent, true);\n\n    var axisExtentTop = axisExtent.selectAll('.' + c.cn.axisExtentTop)\n        .data(repeat, keyFun);\n\n    axisExtentTop.enter()\n        .append('g')\n        .classed(c.cn.axisExtentTop, true);\n\n    axisExtentTop\n        .attr('transform', strTranslate(0, -c.axisExtentOffset));\n\n    var axisExtentTopText = axisExtentTop.selectAll('.' + c.cn.axisExtentTopText)\n        .data(repeat, keyFun);\n\n    axisExtentTopText.enter()\n        .append('text')\n        .classed(c.cn.axisExtentTopText, true)\n        .call(styleExtentTexts);\n\n    axisExtentTopText\n        .text(function(d) { return extremeText(d, true); })\n        .each(function(d) { Drawing.font(d3.select(this), d.model.rangeFont); });\n\n    var axisExtentBottom = axisExtent.selectAll('.' + c.cn.axisExtentBottom)\n        .data(repeat, keyFun);\n\n    axisExtentBottom.enter()\n        .append('g')\n        .classed(c.cn.axisExtentBottom, true);\n\n    axisExtentBottom\n        .attr('transform', function(d) {\n            return strTranslate(0, d.model.height + c.axisExtentOffset);\n        });\n\n    var axisExtentBottomText = axisExtentBottom.selectAll('.' + c.cn.axisExtentBottomText)\n        .data(repeat, keyFun);\n\n    axisExtentBottomText.enter()\n        .append('text')\n        .classed(c.cn.axisExtentBottomText, true)\n        .attr('dy', '0.75em')\n        .call(styleExtentTexts);\n\n    axisExtentBottomText\n        .text(function(d) { return extremeText(d, false); })\n        .each(function(d) { Drawing.font(d3.select(this), d.model.rangeFont); });\n\n    brush.ensureAxisBrush(axisOverlays, paperColor);\n};\n"]},"metadata":{},"sourceType":"script"}