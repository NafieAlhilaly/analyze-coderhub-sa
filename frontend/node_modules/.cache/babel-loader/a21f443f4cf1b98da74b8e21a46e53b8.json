{"ast":null,"code":"'use strict';\n\nvar createLine = require('regl-line2d');\n\nvar Registry = require('../../registry');\n\nvar prepareRegl = require('../../lib/prepare_regl');\n\nvar getModuleCalcData = require('../../plots/get_data').getModuleCalcData;\n\nvar Cartesian = require('../../plots/cartesian');\n\nvar getFromId = require('../../plots/cartesian/axis_ids').getFromId;\n\nvar shouldShowZeroLine = require('../../plots/cartesian/axes').shouldShowZeroLine;\n\nvar SPLOM = 'splom';\n\nfunction plot(gd) {\n  var fullLayout = gd._fullLayout;\n\n  var _module = Registry.getModule(SPLOM);\n\n  var splomCalcData = getModuleCalcData(gd.calcdata, _module)[0];\n  var success = prepareRegl(gd, ['ANGLE_instanced_arrays', 'OES_element_index_uint']);\n  if (!success) return;\n\n  if (fullLayout._hasOnlyLargeSploms) {\n    updateGrid(gd);\n  }\n\n  _module.plot(gd, {}, splomCalcData);\n}\n\nfunction drag(gd) {\n  var cd = gd.calcdata;\n  var fullLayout = gd._fullLayout;\n\n  if (fullLayout._hasOnlyLargeSploms) {\n    updateGrid(gd);\n  }\n\n  for (var i = 0; i < cd.length; i++) {\n    var cd0 = cd[i][0];\n    var trace = cd0.trace;\n    var scene = fullLayout._splomScenes[trace.uid];\n\n    if (trace.type === 'splom' && scene && scene.matrix) {\n      dragOne(gd, trace, scene);\n    }\n  }\n}\n\nfunction dragOne(gd, trace, scene) {\n  var visibleLength = scene.matrixOptions.data.length;\n  var visibleDims = trace._visibleDims;\n  var ranges = scene.viewOpts.ranges = new Array(visibleLength);\n\n  for (var k = 0; k < visibleDims.length; k++) {\n    var i = visibleDims[k];\n    var rng = ranges[k] = new Array(4);\n    var xa = getFromId(gd, trace._diag[i][0]);\n\n    if (xa) {\n      rng[0] = xa.r2l(xa.range[0]);\n      rng[2] = xa.r2l(xa.range[1]);\n    }\n\n    var ya = getFromId(gd, trace._diag[i][1]);\n\n    if (ya) {\n      rng[1] = ya.r2l(ya.range[0]);\n      rng[3] = ya.r2l(ya.range[1]);\n    }\n  }\n\n  if (scene.selectBatch.length || scene.unselectBatch.length) {\n    scene.matrix.update({\n      ranges: ranges\n    }, {\n      ranges: ranges\n    });\n  } else {\n    scene.matrix.update({\n      ranges: ranges\n    });\n  }\n}\n\nfunction updateGrid(gd) {\n  var fullLayout = gd._fullLayout;\n\n  var regl = fullLayout._glcanvas.data()[0].regl;\n\n  var splomGrid = fullLayout._splomGrid;\n\n  if (!splomGrid) {\n    splomGrid = fullLayout._splomGrid = createLine(regl);\n  }\n\n  splomGrid.update(makeGridData(gd));\n}\n\nfunction makeGridData(gd) {\n  var plotGlPixelRatio = gd._context.plotGlPixelRatio;\n  var fullLayout = gd._fullLayout;\n  var gs = fullLayout._size;\n  var fullView = [0, 0, fullLayout.width * plotGlPixelRatio, fullLayout.height * plotGlPixelRatio];\n  var lookup = {};\n  var k;\n\n  function push(prefix, ax, x0, x1, y0, y1) {\n    x0 *= plotGlPixelRatio;\n    x1 *= plotGlPixelRatio;\n    y0 *= plotGlPixelRatio;\n    y1 *= plotGlPixelRatio;\n    var lcolor = ax[prefix + 'color'];\n    var lwidth = ax[prefix + 'width'];\n    var key = String(lcolor + lwidth);\n\n    if (key in lookup) {\n      lookup[key].data.push(NaN, NaN, x0, x1, y0, y1);\n    } else {\n      lookup[key] = {\n        data: [x0, x1, y0, y1],\n        join: 'rect',\n        thickness: lwidth * plotGlPixelRatio,\n        color: lcolor,\n        viewport: fullView,\n        range: fullView,\n        overlay: false\n      };\n    }\n  }\n\n  for (k in fullLayout._splomSubplots) {\n    var sp = fullLayout._plots[k];\n    var xa = sp.xaxis;\n    var ya = sp.yaxis;\n    var xVals = xa._gridVals;\n    var yVals = ya._gridVals;\n    var xOffset = xa._offset;\n    var xLength = xa._length;\n    var yLength = ya._length; // ya.l2p assumes top-to-bottom coordinate system (a la SVG),\n    // we need to compute bottom-to-top offsets and slopes:\n\n    var yOffset = gs.b + ya.domain[0] * gs.h;\n    var ym = -ya._m;\n    var yb = -ym * ya.r2l(ya.range[0], ya.calendar);\n    var x, y;\n\n    if (xa.showgrid) {\n      for (k = 0; k < xVals.length; k++) {\n        x = xOffset + xa.l2p(xVals[k].x);\n        push('grid', xa, x, yOffset, x, yOffset + yLength);\n      }\n    }\n\n    if (ya.showgrid) {\n      for (k = 0; k < yVals.length; k++) {\n        y = yOffset + yb + ym * yVals[k].x;\n        push('grid', ya, xOffset, y, xOffset + xLength, y);\n      }\n    }\n\n    if (shouldShowZeroLine(gd, xa, ya)) {\n      x = xOffset + xa.l2p(0);\n      push('zeroline', xa, x, yOffset, x, yOffset + yLength);\n    }\n\n    if (shouldShowZeroLine(gd, ya, xa)) {\n      y = yOffset + yb + 0;\n      push('zeroline', ya, xOffset, y, xOffset + xLength, y);\n    }\n  }\n\n  var gridBatches = [];\n\n  for (k in lookup) {\n    gridBatches.push(lookup[k]);\n  }\n\n  return gridBatches;\n}\n\nfunction clean(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n  var lookup = {};\n  var i;\n\n  if (oldFullLayout._splomScenes) {\n    for (i = 0; i < newFullData.length; i++) {\n      var newTrace = newFullData[i];\n\n      if (newTrace.type === 'splom') {\n        lookup[newTrace.uid] = 1;\n      }\n    }\n\n    for (i = 0; i < oldFullData.length; i++) {\n      var oldTrace = oldFullData[i];\n\n      if (!lookup[oldTrace.uid]) {\n        var scene = oldFullLayout._splomScenes[oldTrace.uid];\n        if (scene && scene.destroy) scene.destroy(); // must first set scene to null in order to get garbage collected\n\n        oldFullLayout._splomScenes[oldTrace.uid] = null;\n        delete oldFullLayout._splomScenes[oldTrace.uid];\n      }\n    }\n  }\n\n  if (Object.keys(oldFullLayout._splomScenes || {}).length === 0) {\n    delete oldFullLayout._splomScenes;\n  }\n\n  if (oldFullLayout._splomGrid && !newFullLayout._hasOnlyLargeSploms && oldFullLayout._hasOnlyLargeSploms) {\n    // must first set scene to null in order to get garbage collected\n    oldFullLayout._splomGrid.destroy();\n\n    oldFullLayout._splomGrid = null;\n    delete oldFullLayout._splomGrid;\n  }\n\n  Cartesian.clean(newFullData, newFullLayout, oldFullData, oldFullLayout);\n}\n\nmodule.exports = {\n  name: SPLOM,\n  attr: Cartesian.attr,\n  attrRegex: Cartesian.attrRegex,\n  layoutAttributes: Cartesian.layoutAttributes,\n  supplyLayoutDefaults: Cartesian.supplyLayoutDefaults,\n  drawFramework: Cartesian.drawFramework,\n  plot: plot,\n  drag: drag,\n  updateGrid: updateGrid,\n  clean: clean,\n  updateFx: Cartesian.updateFx,\n  toSVG: Cartesian.toSVG\n};","map":{"version":3,"sources":["C:/Projects/reactApp/analyse_coderhub/node_modules/plotly.js/src/traces/splom/base_plot.js"],"names":["createLine","require","Registry","prepareRegl","getModuleCalcData","Cartesian","getFromId","shouldShowZeroLine","SPLOM","plot","gd","fullLayout","_fullLayout","_module","getModule","splomCalcData","calcdata","success","_hasOnlyLargeSploms","updateGrid","drag","cd","i","length","cd0","trace","scene","_splomScenes","uid","type","matrix","dragOne","visibleLength","matrixOptions","data","visibleDims","_visibleDims","ranges","viewOpts","Array","k","rng","xa","_diag","r2l","range","ya","selectBatch","unselectBatch","update","regl","_glcanvas","splomGrid","_splomGrid","makeGridData","plotGlPixelRatio","_context","gs","_size","fullView","width","height","lookup","push","prefix","ax","x0","x1","y0","y1","lcolor","lwidth","key","String","NaN","join","thickness","color","viewport","overlay","_splomSubplots","sp","_plots","xaxis","yaxis","xVals","_gridVals","yVals","xOffset","_offset","xLength","_length","yLength","yOffset","b","domain","h","ym","_m","yb","calendar","x","y","showgrid","l2p","gridBatches","clean","newFullData","newFullLayout","oldFullData","oldFullLayout","newTrace","oldTrace","destroy","Object","keys","module","exports","name","attr","attrRegex","layoutAttributes","supplyLayoutDefaults","drawFramework","updateFx","toSVG"],"mappings":"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","sourcesContent":["'use strict';\n\nvar createLine = require('regl-line2d');\n\nvar Registry = require('../../registry');\nvar prepareRegl = require('../../lib/prepare_regl');\nvar getModuleCalcData = require('../../plots/get_data').getModuleCalcData;\nvar Cartesian = require('../../plots/cartesian');\nvar getFromId = require('../../plots/cartesian/axis_ids').getFromId;\nvar shouldShowZeroLine = require('../../plots/cartesian/axes').shouldShowZeroLine;\n\nvar SPLOM = 'splom';\n\nfunction plot(gd) {\n    var fullLayout = gd._fullLayout;\n    var _module = Registry.getModule(SPLOM);\n    var splomCalcData = getModuleCalcData(gd.calcdata, _module)[0];\n\n    var success = prepareRegl(gd, ['ANGLE_instanced_arrays', 'OES_element_index_uint']);\n    if(!success) return;\n\n    if(fullLayout._hasOnlyLargeSploms) {\n        updateGrid(gd);\n    }\n\n    _module.plot(gd, {}, splomCalcData);\n}\n\nfunction drag(gd) {\n    var cd = gd.calcdata;\n    var fullLayout = gd._fullLayout;\n\n    if(fullLayout._hasOnlyLargeSploms) {\n        updateGrid(gd);\n    }\n\n    for(var i = 0; i < cd.length; i++) {\n        var cd0 = cd[i][0];\n        var trace = cd0.trace;\n        var scene = fullLayout._splomScenes[trace.uid];\n\n        if(trace.type === 'splom' && scene && scene.matrix) {\n            dragOne(gd, trace, scene);\n        }\n    }\n}\n\nfunction dragOne(gd, trace, scene) {\n    var visibleLength = scene.matrixOptions.data.length;\n    var visibleDims = trace._visibleDims;\n    var ranges = scene.viewOpts.ranges = new Array(visibleLength);\n\n    for(var k = 0; k < visibleDims.length; k++) {\n        var i = visibleDims[k];\n        var rng = ranges[k] = new Array(4);\n\n        var xa = getFromId(gd, trace._diag[i][0]);\n        if(xa) {\n            rng[0] = xa.r2l(xa.range[0]);\n            rng[2] = xa.r2l(xa.range[1]);\n        }\n\n        var ya = getFromId(gd, trace._diag[i][1]);\n        if(ya) {\n            rng[1] = ya.r2l(ya.range[0]);\n            rng[3] = ya.r2l(ya.range[1]);\n        }\n    }\n\n    if(scene.selectBatch.length || scene.unselectBatch.length) {\n        scene.matrix.update({ranges: ranges}, {ranges: ranges});\n    } else {\n        scene.matrix.update({ranges: ranges});\n    }\n}\n\nfunction updateGrid(gd) {\n    var fullLayout = gd._fullLayout;\n    var regl = fullLayout._glcanvas.data()[0].regl;\n    var splomGrid = fullLayout._splomGrid;\n\n    if(!splomGrid) {\n        splomGrid = fullLayout._splomGrid = createLine(regl);\n    }\n    splomGrid.update(makeGridData(gd));\n}\n\nfunction makeGridData(gd) {\n    var plotGlPixelRatio = gd._context.plotGlPixelRatio;\n    var fullLayout = gd._fullLayout;\n    var gs = fullLayout._size;\n    var fullView = [\n        0, 0,\n        fullLayout.width * plotGlPixelRatio,\n        fullLayout.height * plotGlPixelRatio\n    ];\n    var lookup = {};\n    var k;\n\n    function push(prefix, ax, x0, x1, y0, y1) {\n        x0 *= plotGlPixelRatio;\n        x1 *= plotGlPixelRatio;\n        y0 *= plotGlPixelRatio;\n        y1 *= plotGlPixelRatio;\n\n        var lcolor = ax[prefix + 'color'];\n        var lwidth = ax[prefix + 'width'];\n        var key = String(lcolor + lwidth);\n\n        if(key in lookup) {\n            lookup[key].data.push(NaN, NaN, x0, x1, y0, y1);\n        } else {\n            lookup[key] = {\n                data: [x0, x1, y0, y1],\n                join: 'rect',\n                thickness: lwidth * plotGlPixelRatio,\n                color: lcolor,\n                viewport: fullView,\n                range: fullView,\n                overlay: false\n            };\n        }\n    }\n\n    for(k in fullLayout._splomSubplots) {\n        var sp = fullLayout._plots[k];\n        var xa = sp.xaxis;\n        var ya = sp.yaxis;\n        var xVals = xa._gridVals;\n        var yVals = ya._gridVals;\n        var xOffset = xa._offset;\n        var xLength = xa._length;\n        var yLength = ya._length;\n\n        // ya.l2p assumes top-to-bottom coordinate system (a la SVG),\n        // we need to compute bottom-to-top offsets and slopes:\n        var yOffset = gs.b + ya.domain[0] * gs.h;\n        var ym = -ya._m;\n        var yb = -ym * ya.r2l(ya.range[0], ya.calendar);\n        var x, y;\n\n        if(xa.showgrid) {\n            for(k = 0; k < xVals.length; k++) {\n                x = xOffset + xa.l2p(xVals[k].x);\n                push('grid', xa, x, yOffset, x, yOffset + yLength);\n            }\n        }\n        if(ya.showgrid) {\n            for(k = 0; k < yVals.length; k++) {\n                y = yOffset + yb + ym * yVals[k].x;\n                push('grid', ya, xOffset, y, xOffset + xLength, y);\n            }\n        }\n        if(shouldShowZeroLine(gd, xa, ya)) {\n            x = xOffset + xa.l2p(0);\n            push('zeroline', xa, x, yOffset, x, yOffset + yLength);\n        }\n        if(shouldShowZeroLine(gd, ya, xa)) {\n            y = yOffset + yb + 0;\n            push('zeroline', ya, xOffset, y, xOffset + xLength, y);\n        }\n    }\n\n    var gridBatches = [];\n    for(k in lookup) {\n        gridBatches.push(lookup[k]);\n    }\n\n    return gridBatches;\n}\n\nfunction clean(newFullData, newFullLayout, oldFullData, oldFullLayout) {\n    var lookup = {};\n    var i;\n\n    if(oldFullLayout._splomScenes) {\n        for(i = 0; i < newFullData.length; i++) {\n            var newTrace = newFullData[i];\n            if(newTrace.type === 'splom') {\n                lookup[newTrace.uid] = 1;\n            }\n        }\n        for(i = 0; i < oldFullData.length; i++) {\n            var oldTrace = oldFullData[i];\n            if(!lookup[oldTrace.uid]) {\n                var scene = oldFullLayout._splomScenes[oldTrace.uid];\n                if(scene && scene.destroy) scene.destroy();\n                // must first set scene to null in order to get garbage collected\n                oldFullLayout._splomScenes[oldTrace.uid] = null;\n                delete oldFullLayout._splomScenes[oldTrace.uid];\n            }\n        }\n    }\n\n    if(Object.keys(oldFullLayout._splomScenes || {}).length === 0) {\n        delete oldFullLayout._splomScenes;\n    }\n\n    if(oldFullLayout._splomGrid &&\n        (!newFullLayout._hasOnlyLargeSploms && oldFullLayout._hasOnlyLargeSploms)) {\n        // must first set scene to null in order to get garbage collected\n        oldFullLayout._splomGrid.destroy();\n        oldFullLayout._splomGrid = null;\n        delete oldFullLayout._splomGrid;\n    }\n\n    Cartesian.clean(newFullData, newFullLayout, oldFullData, oldFullLayout);\n}\n\nmodule.exports = {\n    name: SPLOM,\n    attr: Cartesian.attr,\n    attrRegex: Cartesian.attrRegex,\n    layoutAttributes: Cartesian.layoutAttributes,\n    supplyLayoutDefaults: Cartesian.supplyLayoutDefaults,\n    drawFramework: Cartesian.drawFramework,\n    plot: plot,\n    drag: drag,\n    updateGrid: updateGrid,\n    clean: clean,\n    updateFx: Cartesian.updateFx,\n    toSVG: Cartesian.toSVG\n};\n"]},"metadata":{},"sourceType":"script"}