{"ast":null,"code":"'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\n\nvar Lib = require('../../lib');\n\nvar strTranslate = Lib.strTranslate;\n\nvar Drawing = require('../drawing');\n\nvar Color = require('../color');\n\nvar extractOpts = require('../colorscale/helpers').extractOpts;\n\nvar subTypes = require('../../traces/scatter/subtypes');\n\nvar stylePie = require('../../traces/pie/style_one');\n\nvar pieCastOption = require('../../traces/pie/helpers').castOption;\n\nvar constants = require('./constants');\n\nvar CST_MARKER_SIZE = 12;\nvar CST_LINE_WIDTH = 5;\nvar CST_MARKER_LINE_WIDTH = 2;\nvar MAX_LINE_WIDTH = 10;\nvar MAX_MARKER_LINE_WIDTH = 5;\n\nmodule.exports = function style(s, gd, legend) {\n  var fullLayout = gd._fullLayout;\n  if (!legend) legend = fullLayout.legend;\n  var constantItemSizing = legend.itemsizing === 'constant';\n  var itemWidth = legend.itemwidth;\n  var centerPos = (itemWidth + constants.itemGap * 2) / 2;\n  var centerTransform = strTranslate(centerPos, 0);\n\n  var boundLineWidth = function (mlw, cont, max, cst) {\n    var v;\n\n    if (mlw + 1) {\n      v = mlw;\n    } else if (cont && cont.width > 0) {\n      v = cont.width;\n    } else {\n      return 0;\n    }\n\n    return constantItemSizing ? cst : Math.min(v, max);\n  };\n\n  s.each(function (d) {\n    var traceGroup = d3.select(this);\n    var layers = Lib.ensureSingle(traceGroup, 'g', 'layers');\n    layers.style('opacity', d[0].trace.opacity);\n    var valign = legend.valign;\n    var lineHeight = d[0].lineHeight;\n    var height = d[0].height;\n\n    if (valign === 'middle' || !lineHeight || !height) {\n      layers.attr('transform', null);\n    } else {\n      var factor = {\n        top: 1,\n        bottom: -1\n      }[valign];\n      var markerOffsetY = factor * (0.5 * (lineHeight - height + 3));\n      layers.attr('transform', strTranslate(0, markerOffsetY));\n    }\n\n    var fill = layers.selectAll('g.legendfill').data([d]);\n    fill.enter().append('g').classed('legendfill', true);\n    var line = layers.selectAll('g.legendlines').data([d]);\n    line.enter().append('g').classed('legendlines', true);\n    var symbol = layers.selectAll('g.legendsymbols').data([d]);\n    symbol.enter().append('g').classed('legendsymbols', true);\n    symbol.selectAll('g.legendpoints').data([d]).enter().append('g').classed('legendpoints', true);\n  }).each(styleSpatial).each(styleWaterfalls).each(styleFunnels).each(styleBars).each(styleBoxes).each(styleFunnelareas).each(stylePies).each(styleLines).each(stylePoints).each(styleCandles).each(styleOHLC);\n\n  function styleLines(d) {\n    var styleGuide = getStyleGuide(d);\n    var showFill = styleGuide.showFill;\n    var showLine = styleGuide.showLine;\n    var showGradientLine = styleGuide.showGradientLine;\n    var showGradientFill = styleGuide.showGradientFill;\n    var anyFill = styleGuide.anyFill;\n    var anyLine = styleGuide.anyLine;\n    var d0 = d[0];\n    var trace = d0.trace;\n    var dMod, tMod;\n    var cOpts = extractOpts(trace);\n    var colorscale = cOpts.colorscale;\n    var reversescale = cOpts.reversescale;\n\n    var fillGradient = function (s) {\n      if (s.size()) {\n        var gradientID = 'legendfill-' + trace.uid;\n        Drawing.gradient(s, gd, gradientID, getGradientDirection(reversescale), colorscale, 'fill');\n      }\n    };\n\n    var lineGradient = function (s) {\n      if (s.size()) {\n        var gradientID = 'legendline-' + trace.uid;\n        Drawing.lineGroupStyle(s);\n        Drawing.gradient(s, gd, gradientID, getGradientDirection(reversescale), colorscale, 'stroke');\n      }\n    }; // with fill and no markers or text, move the line and fill up a bit\n    // so it's more centered\n\n\n    var pathStart = subTypes.hasMarkers(trace) || !anyFill ? 'M5,0' : // with a line leave it slightly below center, to leave room for the\n    // line thickness and because the line is usually more prominent\n    anyLine ? 'M5,-2' : 'M5,-3';\n    var this3 = d3.select(this);\n    var fill = this3.select('.legendfill').selectAll('path').data(showFill || showGradientFill ? [d] : []);\n    fill.enter().append('path').classed('js-fill', true);\n    fill.exit().remove();\n    fill.attr('d', pathStart + 'h' + itemWidth + 'v6h-' + itemWidth + 'z').call(showFill ? Drawing.fillGroupStyle : fillGradient);\n\n    if (showLine || showGradientLine) {\n      var lw = boundLineWidth(undefined, trace.line, MAX_LINE_WIDTH, CST_LINE_WIDTH);\n      tMod = Lib.minExtend(trace, {\n        line: {\n          width: lw\n        }\n      });\n      dMod = [Lib.minExtend(d0, {\n        trace: tMod\n      })];\n    }\n\n    var line = this3.select('.legendlines').selectAll('path').data(showLine || showGradientLine ? [dMod] : []);\n    line.enter().append('path').classed('js-line', true);\n    line.exit().remove(); // this is ugly... but you can't apply a gradient to a perfectly\n    // horizontal or vertical line. Presumably because then\n    // the system doesn't know how to scale vertical variation, even\n    // though there *is* no vertical variation in this case.\n    // so add an invisibly small angle to the line\n    // This issue (and workaround) exist across (Mac) Chrome, FF, and Safari\n\n    line.attr('d', pathStart + (showGradientLine ? 'l' + itemWidth + ',0.0001' : 'h' + itemWidth)).call(showLine ? Drawing.lineGroupStyle : lineGradient);\n  }\n\n  function stylePoints(d) {\n    var styleGuide = getStyleGuide(d);\n    var anyFill = styleGuide.anyFill;\n    var anyLine = styleGuide.anyLine;\n    var showLine = styleGuide.showLine;\n    var showMarker = styleGuide.showMarker;\n    var d0 = d[0];\n    var trace = d0.trace;\n    var showText = !showMarker && !anyLine && !anyFill && subTypes.hasText(trace);\n    var dMod, tMod; // 'scatter3d' don't use gd.calcdata,\n    // use d0.trace to infer arrayOk attributes\n\n    function boundVal(attrIn, arrayToValFn, bounds, cst) {\n      var valIn = Lib.nestedProperty(trace, attrIn).get();\n      var valToBound = Lib.isArrayOrTypedArray(valIn) && arrayToValFn ? arrayToValFn(valIn) : valIn;\n\n      if (constantItemSizing && valToBound && cst !== undefined) {\n        valToBound = cst;\n      }\n\n      if (bounds) {\n        if (valToBound < bounds[0]) return bounds[0];else if (valToBound > bounds[1]) return bounds[1];\n      }\n\n      return valToBound;\n    }\n\n    function pickFirst(array) {\n      if (d0._distinct && d0.index && array[d0.index]) return array[d0.index];\n      return array[0];\n    } // constrain text, markers, etc so they'll fit on the legend\n\n\n    if (showMarker || showText || showLine) {\n      var dEdit = {};\n      var tEdit = {};\n\n      if (showMarker) {\n        dEdit.mc = boundVal('marker.color', pickFirst);\n        dEdit.mx = boundVal('marker.symbol', pickFirst);\n        dEdit.mo = boundVal('marker.opacity', Lib.mean, [0.2, 1]);\n        dEdit.mlc = boundVal('marker.line.color', pickFirst);\n        dEdit.mlw = boundVal('marker.line.width', Lib.mean, [0, 5], CST_MARKER_LINE_WIDTH);\n        tEdit.marker = {\n          sizeref: 1,\n          sizemin: 1,\n          sizemode: 'diameter'\n        };\n        var ms = boundVal('marker.size', Lib.mean, [2, 16], CST_MARKER_SIZE);\n        dEdit.ms = ms;\n        tEdit.marker.size = ms;\n      }\n\n      if (showLine) {\n        tEdit.line = {\n          width: boundVal('line.width', pickFirst, [0, 10], CST_LINE_WIDTH)\n        };\n      }\n\n      if (showText) {\n        dEdit.tx = 'Aa';\n        dEdit.tp = boundVal('textposition', pickFirst);\n        dEdit.ts = 10;\n        dEdit.tc = boundVal('textfont.color', pickFirst);\n        dEdit.tf = boundVal('textfont.family', pickFirst);\n      }\n\n      dMod = [Lib.minExtend(d0, dEdit)];\n      tMod = Lib.minExtend(trace, tEdit); // always show legend items in base state\n\n      tMod.selectedpoints = null; // never show texttemplate\n\n      tMod.texttemplate = null;\n    }\n\n    var ptgroup = d3.select(this).select('g.legendpoints');\n    var pts = ptgroup.selectAll('path.scatterpts').data(showMarker ? dMod : []); // make sure marker is on the bottom, in case it enters after text\n\n    pts.enter().insert('path', ':first-child').classed('scatterpts', true).attr('transform', centerTransform);\n    pts.exit().remove();\n    pts.call(Drawing.pointStyle, tMod, gd); // 'mrc' is set in pointStyle and used in textPointStyle:\n    // constrain it here\n\n    if (showMarker) dMod[0].mrc = 3;\n    var txt = ptgroup.selectAll('g.pointtext').data(showText ? dMod : []);\n    txt.enter().append('g').classed('pointtext', true).append('text').attr('transform', centerTransform);\n    txt.exit().remove();\n    txt.selectAll('text').call(Drawing.textPointStyle, tMod, gd);\n  }\n\n  function styleWaterfalls(d) {\n    var trace = d[0].trace;\n    var isWaterfall = trace.type === 'waterfall';\n\n    if (d[0]._distinct && isWaterfall) {\n      var cont = d[0].trace[d[0].dir].marker;\n      d[0].mc = cont.color;\n      d[0].mlw = cont.line.width;\n      d[0].mlc = cont.line.color;\n      return styleBarLike(d, this, 'waterfall');\n    }\n\n    var ptsData = [];\n\n    if (trace.visible && isWaterfall) {\n      ptsData = d[0].hasTotals ? [['increasing', 'M-6,-6V6H0Z'], ['totals', 'M6,6H0L-6,-6H-0Z'], ['decreasing', 'M6,6V-6H0Z']] : [['increasing', 'M-6,-6V6H6Z'], ['decreasing', 'M6,6V-6H-6Z']];\n    }\n\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendwaterfall').data(ptsData);\n    pts.enter().append('path').classed('legendwaterfall', true).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (dd) {\n      var pt = d3.select(this);\n      var cont = trace[dd[0]].marker;\n      var lw = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      pt.attr('d', dd[1]).style('stroke-width', lw + 'px').call(Color.fill, cont.color);\n\n      if (lw) {\n        pt.call(Color.stroke, cont.line.color);\n      }\n    });\n  }\n\n  function styleBars(d) {\n    styleBarLike(d, this);\n  }\n\n  function styleFunnels(d) {\n    styleBarLike(d, this, 'funnel');\n  }\n\n  function styleBarLike(d, lThis, desiredType) {\n    var trace = d[0].trace;\n    var marker = trace.marker || {};\n    var markerLine = marker.line || {};\n    var isVisible = !desiredType ? Registry.traceIs(trace, 'bar') : trace.visible && trace.type === desiredType;\n    var barpath = d3.select(lThis).select('g.legendpoints').selectAll('path.legend' + desiredType).data(isVisible ? [d] : []);\n    barpath.enter().append('path').classed('legend' + desiredType, true).attr('d', 'M6,6H-6V-6H6Z').attr('transform', centerTransform);\n    barpath.exit().remove();\n    barpath.each(function (d) {\n      var p = d3.select(this);\n      var d0 = d[0];\n      var w = boundLineWidth(d0.mlw, marker.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      p.style('stroke-width', w + 'px');\n      var mcc = d0.mcc;\n\n      if (!legend._inHover && 'mc' in d0) {\n        // not in unified hover but\n        // for legend use the color in the middle of scale\n        var cOpts = extractOpts(marker);\n        var mid = cOpts.mid;\n        if (mid === undefined) mid = (cOpts.max + cOpts.min) / 2;\n        mcc = Drawing.tryColorscale(marker, '')(mid);\n      }\n\n      var fillColor = mcc || d0.mc || marker.color;\n      var markerPattern = marker.pattern;\n      var patternShape = markerPattern && Drawing.getPatternAttr(markerPattern.shape, 0, '');\n\n      if (patternShape) {\n        var patternBGColor = Drawing.getPatternAttr(markerPattern.bgcolor, 0, null);\n        var patternFGColor = Drawing.getPatternAttr(markerPattern.fgcolor, 0, null);\n        var patternFGOpacity = markerPattern.fgopacity;\n        var patternSize = dimAttr(markerPattern.size, 8, 10);\n        var patternSolidity = dimAttr(markerPattern.solidity, 0.5, 1);\n        var patternID = 'legend-' + trace.uid;\n        p.call(Drawing.pattern, 'legend', gd, patternID, patternShape, patternSize, patternSolidity, mcc, markerPattern.fillmode, patternBGColor, patternFGColor, patternFGOpacity);\n      } else {\n        p.call(Color.fill, fillColor);\n      }\n\n      if (w) Color.stroke(p, d0.mlc || markerLine.color);\n    });\n  }\n\n  function styleBoxes(d) {\n    var trace = d[0].trace;\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendbox').data(trace.visible && Registry.traceIs(trace, 'box-violin') ? [d] : []);\n    pts.enter().append('path').classed('legendbox', true) // if we want the median bar, prepend M6,0H-6\n    .attr('d', 'M6,6H-6V-6H6Z').attr('transform', centerTransform);\n    pts.exit().remove();\n    pts.each(function () {\n      var p = d3.select(this);\n\n      if ((trace.boxpoints === 'all' || trace.points === 'all') && Color.opacity(trace.fillcolor) === 0 && Color.opacity((trace.line || {}).color) === 0) {\n        var tMod = Lib.minExtend(trace, {\n          marker: {\n            size: constantItemSizing ? CST_MARKER_SIZE : Lib.constrain(trace.marker.size, 2, 16),\n            sizeref: 1,\n            sizemin: 1,\n            sizemode: 'diameter'\n          }\n        });\n        pts.call(Drawing.pointStyle, tMod, gd);\n      } else {\n        var w = boundLineWidth(undefined, trace.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n        p.style('stroke-width', w + 'px').call(Color.fill, trace.fillcolor);\n        if (w) Color.stroke(p, trace.line.color);\n      }\n    });\n  }\n\n  function styleCandles(d) {\n    var trace = d[0].trace;\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendcandle').data(trace.visible && trace.type === 'candlestick' ? [d, d] : []);\n    pts.enter().append('path').classed('legendcandle', true).attr('d', function (_, i) {\n      if (i) return 'M-15,0H-8M-8,6V-6H8Z'; // increasing\n\n      return 'M15,0H8M8,-6V6H-8Z'; // decreasing\n    }).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (_, i) {\n      var p = d3.select(this);\n      var cont = trace[i ? 'increasing' : 'decreasing'];\n      var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      p.style('stroke-width', w + 'px').call(Color.fill, cont.fillcolor);\n      if (w) Color.stroke(p, cont.line.color);\n    });\n  }\n\n  function styleOHLC(d) {\n    var trace = d[0].trace;\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legendohlc').data(trace.visible && trace.type === 'ohlc' ? [d, d] : []);\n    pts.enter().append('path').classed('legendohlc', true).attr('d', function (_, i) {\n      if (i) return 'M-15,0H0M-8,-6V0'; // increasing\n\n      return 'M15,0H0M8,6V0'; // decreasing\n    }).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (_, i) {\n      var p = d3.select(this);\n      var cont = trace[i ? 'increasing' : 'decreasing'];\n      var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      p.style('fill', 'none').call(Drawing.dashLine, cont.line.dash, w);\n      if (w) Color.stroke(p, cont.line.color);\n    });\n  }\n\n  function stylePies(d) {\n    stylePieLike(d, this, 'pie');\n  }\n\n  function styleFunnelareas(d) {\n    stylePieLike(d, this, 'funnelarea');\n  }\n\n  function stylePieLike(d, lThis, desiredType) {\n    var d0 = d[0];\n    var trace = d0.trace;\n    var isVisible = !desiredType ? Registry.traceIs(trace, desiredType) : trace.visible && trace.type === desiredType;\n    var pts = d3.select(lThis).select('g.legendpoints').selectAll('path.legend' + desiredType).data(isVisible ? [d] : []);\n    pts.enter().append('path').classed('legend' + desiredType, true).attr('d', 'M6,6H-6V-6H6Z').attr('transform', centerTransform);\n    pts.exit().remove();\n\n    if (pts.size()) {\n      var cont = (trace.marker || {}).line;\n      var lw = boundLineWidth(pieCastOption(cont.width, d0.pts), cont, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n      var tMod = Lib.minExtend(trace, {\n        marker: {\n          line: {\n            width: lw\n          }\n        }\n      }); // since minExtend do not slice more than 3 items we need to patch line.color here\n\n      tMod.marker.line.color = cont.color;\n      var d0Mod = Lib.minExtend(d0, {\n        trace: tMod\n      });\n      stylePie(pts, d0Mod, tMod);\n    }\n  }\n\n  function styleSpatial(d) {\n    // i.e. maninly traces having z and colorscale\n    var trace = d[0].trace;\n    var useGradient;\n    var ptsData = [];\n\n    if (trace.visible) {\n      switch (trace.type) {\n        case 'histogram2d':\n        case 'heatmap':\n          ptsData = [['M-15,-2V4H15V-2Z'] // similar to contour\n          ];\n          useGradient = true;\n          break;\n\n        case 'choropleth':\n        case 'choroplethmapbox':\n          ptsData = [['M-6,-6V6H6V-6Z']];\n          useGradient = true;\n          break;\n\n        case 'densitymapbox':\n          ptsData = [['M-6,0 a6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0']];\n          useGradient = 'radial';\n          break;\n\n        case 'cone':\n          ptsData = [['M-6,2 A2,2 0 0,0 -6,6 V6L6,4Z'], ['M-6,-6 A2,2 0 0,0 -6,-2 L6,-4Z'], ['M-6,-2 A2,2 0 0,0 -6,2 L6,0Z']];\n          useGradient = false;\n          break;\n\n        case 'streamtube':\n          ptsData = [['M-6,2 A2,2 0 0,0 -6,6 H6 A2,2 0 0,1 6,2 Z'], ['M-6,-6 A2,2 0 0,0 -6,-2 H6 A2,2 0 0,1 6,-6 Z'], ['M-6,-2 A2,2 0 0,0 -6,2 H6 A2,2 0 0,1 6,-2 Z']];\n          useGradient = false;\n          break;\n\n        case 'surface':\n          ptsData = [['M-6,-6 A2,3 0 0,0 -6,0 H6 A2,3 0 0,1 6,-6 Z'], ['M-6,1 A2,3 0 0,1 -6,6 H6 A2,3 0 0,0 6,0 Z']];\n          useGradient = true;\n          break;\n\n        case 'mesh3d':\n          ptsData = [['M-6,6H0L-6,-6Z'], ['M6,6H0L6,-6Z'], ['M-6,-6H6L0,6Z']];\n          useGradient = false;\n          break;\n\n        case 'volume':\n          ptsData = [['M-6,6H0L-6,-6Z'], ['M6,6H0L6,-6Z'], ['M-6,-6H6L0,6Z']];\n          useGradient = true;\n          break;\n\n        case 'isosurface':\n          ptsData = [['M-6,6H0L-6,-6Z'], ['M6,6H0L6,-6Z'], ['M-6,-6 A12,24 0 0,0 6,-6 L0,6Z']];\n          useGradient = false;\n          break;\n      }\n    }\n\n    var pts = d3.select(this).select('g.legendpoints').selectAll('path.legend3dandfriends').data(ptsData);\n    pts.enter().append('path').classed('legend3dandfriends', true).attr('transform', centerTransform).style('stroke-miterlimit', 1);\n    pts.exit().remove();\n    pts.each(function (dd, i) {\n      var pt = d3.select(this);\n      var cOpts = extractOpts(trace);\n      var colorscale = cOpts.colorscale;\n      var reversescale = cOpts.reversescale;\n\n      var fillGradient = function (s) {\n        if (s.size()) {\n          var gradientID = 'legendfill-' + trace.uid;\n          Drawing.gradient(s, gd, gradientID, getGradientDirection(reversescale, useGradient === 'radial'), colorscale, 'fill');\n        }\n      };\n\n      var fillColor;\n\n      if (!colorscale) {\n        var color = trace.vertexcolor || trace.facecolor || trace.color;\n        fillColor = Lib.isArrayOrTypedArray(color) ? color[i] || color[0] : color;\n      } else {\n        if (!useGradient) {\n          var len = colorscale.length;\n          fillColor = i === 0 ? colorscale[reversescale ? len - 1 : 0][1] : // minimum\n          i === 1 ? colorscale[reversescale ? 0 : len - 1][1] : // maximum\n          colorscale[Math.floor((len - 1) / 2)][1]; // middle\n        }\n      }\n\n      pt.attr('d', dd[0]);\n\n      if (fillColor) {\n        pt.call(Color.fill, fillColor);\n      } else {\n        pt.call(fillGradient);\n      }\n    });\n  }\n};\n\nfunction getGradientDirection(reversescale, isRadial) {\n  var str = isRadial ? 'radial' : 'horizontal';\n  return str + (reversescale ? '' : 'reversed');\n}\n\nfunction getStyleGuide(d) {\n  var trace = d[0].trace;\n  var contours = trace.contours;\n  var showLine = subTypes.hasLines(trace);\n  var showMarker = subTypes.hasMarkers(trace);\n  var showFill = trace.visible && trace.fill && trace.fill !== 'none';\n  var showGradientLine = false;\n  var showGradientFill = false;\n\n  if (contours) {\n    var coloring = contours.coloring;\n\n    if (coloring === 'lines') {\n      showGradientLine = true;\n    } else {\n      showLine = coloring === 'none' || coloring === 'heatmap' || contours.showlines;\n    }\n\n    if (contours.type === 'constraint') {\n      showFill = contours._operation !== '=';\n    } else if (coloring === 'fill' || coloring === 'heatmap') {\n      showGradientFill = true;\n    }\n  }\n\n  return {\n    showMarker: showMarker,\n    showLine: showLine,\n    showFill: showFill,\n    showGradientLine: showGradientLine,\n    showGradientFill: showGradientFill,\n    anyLine: showLine || showGradientLine,\n    anyFill: showFill || showGradientFill\n  };\n}\n\nfunction dimAttr(v, dflt, max) {\n  if (v && Lib.isArrayOrTypedArray(v)) return dflt;\n  if (v > max) return max;\n  return v;\n}","map":{"version":3,"sources":["C:/Projects/reactApp/analyse_coderhub/node_modules/plotly.js/src/components/legend/style.js"],"names":["d3","require","Registry","Lib","strTranslate","Drawing","Color","extractOpts","subTypes","stylePie","pieCastOption","castOption","constants","CST_MARKER_SIZE","CST_LINE_WIDTH","CST_MARKER_LINE_WIDTH","MAX_LINE_WIDTH","MAX_MARKER_LINE_WIDTH","module","exports","style","s","gd","legend","fullLayout","_fullLayout","constantItemSizing","itemsizing","itemWidth","itemwidth","centerPos","itemGap","centerTransform","boundLineWidth","mlw","cont","max","cst","v","width","Math","min","each","d","traceGroup","select","layers","ensureSingle","trace","opacity","valign","lineHeight","height","attr","factor","top","bottom","markerOffsetY","fill","selectAll","data","enter","append","classed","line","symbol","styleSpatial","styleWaterfalls","styleFunnels","styleBars","styleBoxes","styleFunnelareas","stylePies","styleLines","stylePoints","styleCandles","styleOHLC","styleGuide","getStyleGuide","showFill","showLine","showGradientLine","showGradientFill","anyFill","anyLine","d0","dMod","tMod","cOpts","colorscale","reversescale","fillGradient","size","gradientID","uid","gradient","getGradientDirection","lineGradient","lineGroupStyle","pathStart","hasMarkers","this3","exit","remove","call","fillGroupStyle","lw","undefined","minExtend","showMarker","showText","hasText","boundVal","attrIn","arrayToValFn","bounds","valIn","nestedProperty","get","valToBound","isArrayOrTypedArray","pickFirst","array","_distinct","index","dEdit","tEdit","mc","mx","mo","mean","mlc","marker","sizeref","sizemin","sizemode","ms","tx","tp","ts","tc","tf","selectedpoints","texttemplate","ptgroup","pts","insert","pointStyle","mrc","txt","textPointStyle","isWaterfall","type","dir","color","styleBarLike","ptsData","visible","hasTotals","dd","pt","stroke","lThis","desiredType","markerLine","isVisible","traceIs","barpath","p","w","mcc","_inHover","mid","tryColorscale","fillColor","markerPattern","pattern","patternShape","getPatternAttr","shape","patternBGColor","bgcolor","patternFGColor","fgcolor","patternFGOpacity","fgopacity","patternSize","dimAttr","patternSolidity","solidity","patternID","fillmode","boxpoints","points","fillcolor","constrain","_","i","dashLine","dash","stylePieLike","d0Mod","useGradient","vertexcolor","facecolor","len","length","floor","isRadial","str","contours","hasLines","coloring","showlines","_operation","dflt"],"mappings":"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","sourcesContent":["'use strict';\n\nvar d3 = require('@plotly/d3');\n\nvar Registry = require('../../registry');\nvar Lib = require('../../lib');\nvar strTranslate = Lib.strTranslate;\nvar Drawing = require('../drawing');\nvar Color = require('../color');\nvar extractOpts = require('../colorscale/helpers').extractOpts;\n\nvar subTypes = require('../../traces/scatter/subtypes');\nvar stylePie = require('../../traces/pie/style_one');\nvar pieCastOption = require('../../traces/pie/helpers').castOption;\n\nvar constants = require('./constants');\n\nvar CST_MARKER_SIZE = 12;\nvar CST_LINE_WIDTH = 5;\nvar CST_MARKER_LINE_WIDTH = 2;\nvar MAX_LINE_WIDTH = 10;\nvar MAX_MARKER_LINE_WIDTH = 5;\n\nmodule.exports = function style(s, gd, legend) {\n    var fullLayout = gd._fullLayout;\n    if(!legend) legend = fullLayout.legend;\n    var constantItemSizing = legend.itemsizing === 'constant';\n    var itemWidth = legend.itemwidth;\n    var centerPos = (itemWidth + constants.itemGap * 2) / 2;\n    var centerTransform = strTranslate(centerPos, 0);\n\n    var boundLineWidth = function(mlw, cont, max, cst) {\n        var v;\n        if(mlw + 1) {\n            v = mlw;\n        } else if(cont && cont.width > 0) {\n            v = cont.width;\n        } else {\n            return 0;\n        }\n        return constantItemSizing ? cst : Math.min(v, max);\n    };\n\n    s.each(function(d) {\n        var traceGroup = d3.select(this);\n\n        var layers = Lib.ensureSingle(traceGroup, 'g', 'layers');\n        layers.style('opacity', d[0].trace.opacity);\n\n        var valign = legend.valign;\n        var lineHeight = d[0].lineHeight;\n        var height = d[0].height;\n\n        if(valign === 'middle' || !lineHeight || !height) {\n            layers.attr('transform', null);\n        } else {\n            var factor = {top: 1, bottom: -1}[valign];\n            var markerOffsetY = factor * (0.5 * (lineHeight - height + 3));\n            layers.attr('transform', strTranslate(0, markerOffsetY));\n        }\n\n        var fill = layers\n            .selectAll('g.legendfill')\n                .data([d]);\n        fill.enter().append('g')\n            .classed('legendfill', true);\n\n        var line = layers\n            .selectAll('g.legendlines')\n                .data([d]);\n        line.enter().append('g')\n            .classed('legendlines', true);\n\n        var symbol = layers\n            .selectAll('g.legendsymbols')\n                .data([d]);\n        symbol.enter().append('g')\n            .classed('legendsymbols', true);\n\n        symbol.selectAll('g.legendpoints')\n            .data([d])\n          .enter().append('g')\n            .classed('legendpoints', true);\n    })\n    .each(styleSpatial)\n    .each(styleWaterfalls)\n    .each(styleFunnels)\n    .each(styleBars)\n    .each(styleBoxes)\n    .each(styleFunnelareas)\n    .each(stylePies)\n    .each(styleLines)\n    .each(stylePoints)\n    .each(styleCandles)\n    .each(styleOHLC);\n\n    function styleLines(d) {\n        var styleGuide = getStyleGuide(d);\n        var showFill = styleGuide.showFill;\n        var showLine = styleGuide.showLine;\n        var showGradientLine = styleGuide.showGradientLine;\n        var showGradientFill = styleGuide.showGradientFill;\n        var anyFill = styleGuide.anyFill;\n        var anyLine = styleGuide.anyLine;\n\n        var d0 = d[0];\n        var trace = d0.trace;\n        var dMod, tMod;\n\n        var cOpts = extractOpts(trace);\n        var colorscale = cOpts.colorscale;\n        var reversescale = cOpts.reversescale;\n\n        var fillGradient = function(s) {\n            if(s.size()) {\n                var gradientID = 'legendfill-' + trace.uid;\n                Drawing.gradient(s, gd, gradientID,\n                    getGradientDirection(reversescale),\n                    colorscale, 'fill');\n            }\n        };\n\n        var lineGradient = function(s) {\n            if(s.size()) {\n                var gradientID = 'legendline-' + trace.uid;\n                Drawing.lineGroupStyle(s);\n                Drawing.gradient(s, gd, gradientID,\n                    getGradientDirection(reversescale),\n                    colorscale, 'stroke');\n            }\n        };\n\n        // with fill and no markers or text, move the line and fill up a bit\n        // so it's more centered\n\n        var pathStart = (subTypes.hasMarkers(trace) || !anyFill) ? 'M5,0' :\n            // with a line leave it slightly below center, to leave room for the\n            // line thickness and because the line is usually more prominent\n            anyLine ? 'M5,-2' : 'M5,-3';\n\n        var this3 = d3.select(this);\n\n        var fill = this3.select('.legendfill').selectAll('path')\n            .data(showFill || showGradientFill ? [d] : []);\n        fill.enter().append('path').classed('js-fill', true);\n        fill.exit().remove();\n        fill.attr('d', pathStart + 'h' + itemWidth + 'v6h-' + itemWidth + 'z')\n            .call(showFill ? Drawing.fillGroupStyle : fillGradient);\n\n        if(showLine || showGradientLine) {\n            var lw = boundLineWidth(undefined, trace.line, MAX_LINE_WIDTH, CST_LINE_WIDTH);\n            tMod = Lib.minExtend(trace, {line: {width: lw}});\n            dMod = [Lib.minExtend(d0, {trace: tMod})];\n        }\n\n        var line = this3.select('.legendlines').selectAll('path')\n            .data(showLine || showGradientLine ? [dMod] : []);\n        line.enter().append('path').classed('js-line', true);\n        line.exit().remove();\n\n        // this is ugly... but you can't apply a gradient to a perfectly\n        // horizontal or vertical line. Presumably because then\n        // the system doesn't know how to scale vertical variation, even\n        // though there *is* no vertical variation in this case.\n        // so add an invisibly small angle to the line\n        // This issue (and workaround) exist across (Mac) Chrome, FF, and Safari\n        line.attr('d', pathStart + (showGradientLine ? 'l' + itemWidth + ',0.0001' : 'h' + itemWidth))\n            .call(showLine ? Drawing.lineGroupStyle : lineGradient);\n    }\n\n    function stylePoints(d) {\n        var styleGuide = getStyleGuide(d);\n        var anyFill = styleGuide.anyFill;\n        var anyLine = styleGuide.anyLine;\n        var showLine = styleGuide.showLine;\n        var showMarker = styleGuide.showMarker;\n\n        var d0 = d[0];\n        var trace = d0.trace;\n        var showText = !showMarker && !anyLine && !anyFill && subTypes.hasText(trace);\n        var dMod, tMod;\n\n        // 'scatter3d' don't use gd.calcdata,\n        // use d0.trace to infer arrayOk attributes\n\n        function boundVal(attrIn, arrayToValFn, bounds, cst) {\n            var valIn = Lib.nestedProperty(trace, attrIn).get();\n            var valToBound = (Lib.isArrayOrTypedArray(valIn) && arrayToValFn) ?\n                arrayToValFn(valIn) :\n                valIn;\n\n            if(constantItemSizing && valToBound && cst !== undefined) {\n                valToBound = cst;\n            }\n\n            if(bounds) {\n                if(valToBound < bounds[0]) return bounds[0];\n                else if(valToBound > bounds[1]) return bounds[1];\n            }\n            return valToBound;\n        }\n\n        function pickFirst(array) {\n            if(d0._distinct && d0.index && array[d0.index]) return array[d0.index];\n            return array[0];\n        }\n\n        // constrain text, markers, etc so they'll fit on the legend\n        if(showMarker || showText || showLine) {\n            var dEdit = {};\n            var tEdit = {};\n\n            if(showMarker) {\n                dEdit.mc = boundVal('marker.color', pickFirst);\n                dEdit.mx = boundVal('marker.symbol', pickFirst);\n                dEdit.mo = boundVal('marker.opacity', Lib.mean, [0.2, 1]);\n                dEdit.mlc = boundVal('marker.line.color', pickFirst);\n                dEdit.mlw = boundVal('marker.line.width', Lib.mean, [0, 5], CST_MARKER_LINE_WIDTH);\n                tEdit.marker = {\n                    sizeref: 1,\n                    sizemin: 1,\n                    sizemode: 'diameter'\n                };\n\n                var ms = boundVal('marker.size', Lib.mean, [2, 16], CST_MARKER_SIZE);\n                dEdit.ms = ms;\n                tEdit.marker.size = ms;\n            }\n\n            if(showLine) {\n                tEdit.line = {\n                    width: boundVal('line.width', pickFirst, [0, 10], CST_LINE_WIDTH)\n                };\n            }\n\n            if(showText) {\n                dEdit.tx = 'Aa';\n                dEdit.tp = boundVal('textposition', pickFirst);\n                dEdit.ts = 10;\n                dEdit.tc = boundVal('textfont.color', pickFirst);\n                dEdit.tf = boundVal('textfont.family', pickFirst);\n            }\n\n            dMod = [Lib.minExtend(d0, dEdit)];\n            tMod = Lib.minExtend(trace, tEdit);\n\n            // always show legend items in base state\n            tMod.selectedpoints = null;\n\n            // never show texttemplate\n            tMod.texttemplate = null;\n        }\n\n        var ptgroup = d3.select(this).select('g.legendpoints');\n\n        var pts = ptgroup.selectAll('path.scatterpts')\n            .data(showMarker ? dMod : []);\n        // make sure marker is on the bottom, in case it enters after text\n        pts.enter().insert('path', ':first-child')\n            .classed('scatterpts', true)\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n        pts.call(Drawing.pointStyle, tMod, gd);\n\n        // 'mrc' is set in pointStyle and used in textPointStyle:\n        // constrain it here\n        if(showMarker) dMod[0].mrc = 3;\n\n        var txt = ptgroup.selectAll('g.pointtext')\n            .data(showText ? dMod : []);\n        txt.enter()\n            .append('g').classed('pointtext', true)\n                .append('text').attr('transform', centerTransform);\n        txt.exit().remove();\n        txt.selectAll('text').call(Drawing.textPointStyle, tMod, gd);\n    }\n\n    function styleWaterfalls(d) {\n        var trace = d[0].trace;\n        var isWaterfall = trace.type === 'waterfall';\n\n        if(d[0]._distinct && isWaterfall) {\n            var cont = d[0].trace[d[0].dir].marker;\n            d[0].mc = cont.color;\n            d[0].mlw = cont.line.width;\n            d[0].mlc = cont.line.color;\n            return styleBarLike(d, this, 'waterfall');\n        }\n\n        var ptsData = [];\n        if(trace.visible && isWaterfall) {\n            ptsData = d[0].hasTotals ?\n                [['increasing', 'M-6,-6V6H0Z'], ['totals', 'M6,6H0L-6,-6H-0Z'], ['decreasing', 'M6,6V-6H0Z']] :\n                [['increasing', 'M-6,-6V6H6Z'], ['decreasing', 'M6,6V-6H-6Z']];\n        }\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendwaterfall')\n            .data(ptsData);\n        pts.enter().append('path').classed('legendwaterfall', true)\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(dd) {\n            var pt = d3.select(this);\n            var cont = trace[dd[0]].marker;\n            var lw = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            pt.attr('d', dd[1])\n                .style('stroke-width', lw + 'px')\n                .call(Color.fill, cont.color);\n\n            if(lw) {\n                pt.call(Color.stroke, cont.line.color);\n            }\n        });\n    }\n\n    function styleBars(d) {\n        styleBarLike(d, this);\n    }\n\n    function styleFunnels(d) {\n        styleBarLike(d, this, 'funnel');\n    }\n\n    function styleBarLike(d, lThis, desiredType) {\n        var trace = d[0].trace;\n        var marker = trace.marker || {};\n        var markerLine = marker.line || {};\n\n        var isVisible = (!desiredType) ? Registry.traceIs(trace, 'bar') :\n            (trace.visible && trace.type === desiredType);\n\n        var barpath = d3.select(lThis).select('g.legendpoints')\n            .selectAll('path.legend' + desiredType)\n            .data(isVisible ? [d] : []);\n        barpath.enter().append('path').classed('legend' + desiredType, true)\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        barpath.exit().remove();\n\n        barpath.each(function(d) {\n            var p = d3.select(this);\n            var d0 = d[0];\n            var w = boundLineWidth(d0.mlw, marker.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('stroke-width', w + 'px');\n\n            var mcc = d0.mcc;\n            if(!legend._inHover && 'mc' in d0) {\n                // not in unified hover but\n                // for legend use the color in the middle of scale\n                var cOpts = extractOpts(marker);\n                var mid = cOpts.mid;\n                if(mid === undefined) mid = (cOpts.max + cOpts.min) / 2;\n                mcc = Drawing.tryColorscale(marker, '')(mid);\n            }\n            var fillColor = mcc || d0.mc || marker.color;\n\n            var markerPattern = marker.pattern;\n            var patternShape = markerPattern && Drawing.getPatternAttr(markerPattern.shape, 0, '');\n\n            if(patternShape) {\n                var patternBGColor = Drawing.getPatternAttr(markerPattern.bgcolor, 0, null);\n                var patternFGColor = Drawing.getPatternAttr(markerPattern.fgcolor, 0, null);\n                var patternFGOpacity = markerPattern.fgopacity;\n                var patternSize = dimAttr(markerPattern.size, 8, 10);\n                var patternSolidity = dimAttr(markerPattern.solidity, 0.5, 1);\n                var patternID = 'legend-' + trace.uid;\n                p.call(\n                    Drawing.pattern, 'legend', gd, patternID,\n                    patternShape, patternSize, patternSolidity,\n                    mcc, markerPattern.fillmode,\n                    patternBGColor, patternFGColor, patternFGOpacity\n                );\n            } else {\n                p.call(Color.fill, fillColor);\n            }\n\n            if(w) Color.stroke(p, d0.mlc || markerLine.color);\n        });\n    }\n\n    function styleBoxes(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendbox')\n            .data(trace.visible && Registry.traceIs(trace, 'box-violin') ? [d] : []);\n        pts.enter().append('path').classed('legendbox', true)\n            // if we want the median bar, prepend M6,0H-6\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n\n        pts.each(function() {\n            var p = d3.select(this);\n\n            if((trace.boxpoints === 'all' || trace.points === 'all') &&\n                Color.opacity(trace.fillcolor) === 0 && Color.opacity((trace.line || {}).color) === 0\n            ) {\n                var tMod = Lib.minExtend(trace, {\n                    marker: {\n                        size: constantItemSizing ? CST_MARKER_SIZE : Lib.constrain(trace.marker.size, 2, 16),\n                        sizeref: 1,\n                        sizemin: 1,\n                        sizemode: 'diameter'\n                    }\n                });\n                pts.call(Drawing.pointStyle, tMod, gd);\n            } else {\n                var w = boundLineWidth(undefined, trace.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n                p.style('stroke-width', w + 'px')\n                    .call(Color.fill, trace.fillcolor);\n\n                if(w) Color.stroke(p, trace.line.color);\n            }\n        });\n    }\n\n    function styleCandles(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendcandle')\n            .data(trace.visible && trace.type === 'candlestick' ? [d, d] : []);\n        pts.enter().append('path').classed('legendcandle', true)\n            .attr('d', function(_, i) {\n                if(i) return 'M-15,0H-8M-8,6V-6H8Z'; // increasing\n                return 'M15,0H8M8,-6V6H-8Z'; // decreasing\n            })\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(_, i) {\n            var p = d3.select(this);\n            var cont = trace[i ? 'increasing' : 'decreasing'];\n            var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('stroke-width', w + 'px')\n                .call(Color.fill, cont.fillcolor);\n\n            if(w) Color.stroke(p, cont.line.color);\n        });\n    }\n\n    function styleOHLC(d) {\n        var trace = d[0].trace;\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legendohlc')\n            .data(trace.visible && trace.type === 'ohlc' ? [d, d] : []);\n        pts.enter().append('path').classed('legendohlc', true)\n            .attr('d', function(_, i) {\n                if(i) return 'M-15,0H0M-8,-6V0'; // increasing\n                return 'M15,0H0M8,6V0'; // decreasing\n            })\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(_, i) {\n            var p = d3.select(this);\n            var cont = trace[i ? 'increasing' : 'decreasing'];\n            var w = boundLineWidth(undefined, cont.line, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            p.style('fill', 'none')\n                .call(Drawing.dashLine, cont.line.dash, w);\n\n            if(w) Color.stroke(p, cont.line.color);\n        });\n    }\n\n    function stylePies(d) {\n        stylePieLike(d, this, 'pie');\n    }\n\n    function styleFunnelareas(d) {\n        stylePieLike(d, this, 'funnelarea');\n    }\n\n    function stylePieLike(d, lThis, desiredType) {\n        var d0 = d[0];\n        var trace = d0.trace;\n\n        var isVisible = (!desiredType) ? Registry.traceIs(trace, desiredType) :\n            (trace.visible && trace.type === desiredType);\n\n        var pts = d3.select(lThis).select('g.legendpoints')\n            .selectAll('path.legend' + desiredType)\n            .data(isVisible ? [d] : []);\n        pts.enter().append('path').classed('legend' + desiredType, true)\n            .attr('d', 'M6,6H-6V-6H6Z')\n            .attr('transform', centerTransform);\n        pts.exit().remove();\n\n        if(pts.size()) {\n            var cont = (trace.marker || {}).line;\n            var lw = boundLineWidth(pieCastOption(cont.width, d0.pts), cont, MAX_MARKER_LINE_WIDTH, CST_MARKER_LINE_WIDTH);\n\n            var tMod = Lib.minExtend(trace, {marker: {line: {width: lw}}});\n            // since minExtend do not slice more than 3 items we need to patch line.color here\n            tMod.marker.line.color = cont.color;\n\n            var d0Mod = Lib.minExtend(d0, {trace: tMod});\n\n            stylePie(pts, d0Mod, tMod);\n        }\n    }\n\n    function styleSpatial(d) { // i.e. maninly traces having z and colorscale\n        var trace = d[0].trace;\n\n        var useGradient;\n        var ptsData = [];\n        if(trace.visible) {\n            switch(trace.type) {\n                case 'histogram2d' :\n                case 'heatmap' :\n                    ptsData = [\n                        ['M-15,-2V4H15V-2Z'] // similar to contour\n                    ];\n                    useGradient = true;\n                    break;\n                case 'choropleth' :\n                case 'choroplethmapbox' :\n                    ptsData = [\n                        ['M-6,-6V6H6V-6Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'densitymapbox' :\n                    ptsData = [\n                        ['M-6,0 a6,6 0 1,0 12,0 a 6,6 0 1,0 -12,0']\n                    ];\n                    useGradient = 'radial';\n                    break;\n                case 'cone' :\n                    ptsData = [\n                        ['M-6,2 A2,2 0 0,0 -6,6 V6L6,4Z'],\n                        ['M-6,-6 A2,2 0 0,0 -6,-2 L6,-4Z'],\n                        ['M-6,-2 A2,2 0 0,0 -6,2 L6,0Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'streamtube' :\n                    ptsData = [\n                        ['M-6,2 A2,2 0 0,0 -6,6 H6 A2,2 0 0,1 6,2 Z'],\n                        ['M-6,-6 A2,2 0 0,0 -6,-2 H6 A2,2 0 0,1 6,-6 Z'],\n                        ['M-6,-2 A2,2 0 0,0 -6,2 H6 A2,2 0 0,1 6,-2 Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'surface' :\n                    ptsData = [\n                        ['M-6,-6 A2,3 0 0,0 -6,0 H6 A2,3 0 0,1 6,-6 Z'],\n                        ['M-6,1 A2,3 0 0,1 -6,6 H6 A2,3 0 0,0 6,0 Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'mesh3d' :\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6H6L0,6Z']\n                    ];\n                    useGradient = false;\n                    break;\n                case 'volume' :\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6H6L0,6Z']\n                    ];\n                    useGradient = true;\n                    break;\n                case 'isosurface':\n                    ptsData = [\n                        ['M-6,6H0L-6,-6Z'],\n                        ['M6,6H0L6,-6Z'],\n                        ['M-6,-6 A12,24 0 0,0 6,-6 L0,6Z']\n                    ];\n                    useGradient = false;\n                    break;\n            }\n        }\n\n        var pts = d3.select(this).select('g.legendpoints')\n            .selectAll('path.legend3dandfriends')\n            .data(ptsData);\n        pts.enter().append('path').classed('legend3dandfriends', true)\n            .attr('transform', centerTransform)\n            .style('stroke-miterlimit', 1);\n        pts.exit().remove();\n\n        pts.each(function(dd, i) {\n            var pt = d3.select(this);\n\n            var cOpts = extractOpts(trace);\n            var colorscale = cOpts.colorscale;\n            var reversescale = cOpts.reversescale;\n            var fillGradient = function(s) {\n                if(s.size()) {\n                    var gradientID = 'legendfill-' + trace.uid;\n                    Drawing.gradient(s, gd, gradientID,\n                        getGradientDirection(reversescale, useGradient === 'radial'),\n                        colorscale, 'fill');\n                }\n            };\n\n            var fillColor;\n            if(!colorscale) {\n                var color = trace.vertexcolor || trace.facecolor || trace.color;\n                fillColor = Lib.isArrayOrTypedArray(color) ? (color[i] || color[0]) : color;\n            } else {\n                if(!useGradient) {\n                    var len = colorscale.length;\n                    fillColor =\n                        i === 0 ? colorscale[reversescale ? len - 1 : 0][1] : // minimum\n                        i === 1 ? colorscale[reversescale ? 0 : len - 1][1] : // maximum\n                            colorscale[Math.floor((len - 1) / 2)][1]; // middle\n                }\n            }\n\n            pt.attr('d', dd[0]);\n            if(fillColor) {\n                pt.call(Color.fill, fillColor);\n            } else {\n                pt.call(fillGradient);\n            }\n        });\n    }\n};\n\nfunction getGradientDirection(reversescale, isRadial) {\n    var str = isRadial ? 'radial' : 'horizontal';\n    return str + (reversescale ? '' : 'reversed');\n}\n\nfunction getStyleGuide(d) {\n    var trace = d[0].trace;\n    var contours = trace.contours;\n    var showLine = subTypes.hasLines(trace);\n    var showMarker = subTypes.hasMarkers(trace);\n\n    var showFill = trace.visible && trace.fill && trace.fill !== 'none';\n    var showGradientLine = false;\n    var showGradientFill = false;\n\n    if(contours) {\n        var coloring = contours.coloring;\n\n        if(coloring === 'lines') {\n            showGradientLine = true;\n        } else {\n            showLine = coloring === 'none' || coloring === 'heatmap' || contours.showlines;\n        }\n\n        if(contours.type === 'constraint') {\n            showFill = contours._operation !== '=';\n        } else if(coloring === 'fill' || coloring === 'heatmap') {\n            showGradientFill = true;\n        }\n    }\n\n    return {\n        showMarker: showMarker,\n        showLine: showLine,\n        showFill: showFill,\n        showGradientLine: showGradientLine,\n        showGradientFill: showGradientFill,\n        anyLine: showLine || showGradientLine,\n        anyFill: showFill || showGradientFill,\n    };\n}\n\nfunction dimAttr(v, dflt, max) {\n    if(v && Lib.isArrayOrTypedArray(v)) return dflt;\n    if(v > max) return max;\n    return v;\n}\n"]},"metadata":{},"sourceType":"script"}