{"ast":null,"code":"'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\n\nvar alignPeriod = require('../../plots/cartesian/align_period');\n\nvar arraysToCalcdata = require('./arrays_to_calcdata');\n\nvar calcSelection = require('../scatter/calc_selection');\n\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function calc(gd, trace) {\n  var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n  var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n  var size, pos, origPos, pObj, hasPeriod, pLetter, i, cdi;\n\n  if (trace.orientation === 'h') {\n    size = xa.makeCalcdata(trace, 'x');\n    origPos = ya.makeCalcdata(trace, 'y');\n    pObj = alignPeriod(trace, ya, 'y', origPos);\n    hasPeriod = !!trace.yperiodalignment;\n    pLetter = 'y';\n  } else {\n    size = ya.makeCalcdata(trace, 'y');\n    origPos = xa.makeCalcdata(trace, 'x');\n    pObj = alignPeriod(trace, xa, 'x', origPos);\n    hasPeriod = !!trace.xperiodalignment;\n    pLetter = 'x';\n  }\n\n  pos = pObj.vals; // create the \"calculated data\" to plot\n\n  var serieslen = Math.min(pos.length, size.length);\n  var cd = new Array(serieslen); // Unlike other bar-like traces funnels do not support base attribute.\n  // bases for funnels are computed internally in a way that\n  // the mid-point of each bar are located on the axis line.\n\n  trace._base = []; // set position and size\n\n  for (i = 0; i < serieslen; i++) {\n    // treat negative values as bad numbers\n    if (size[i] < 0) size[i] = BADNUM;\n    var connectToNext = false;\n\n    if (size[i] !== BADNUM) {\n      if (i + 1 < serieslen && size[i + 1] !== BADNUM) {\n        connectToNext = true;\n      }\n    }\n\n    cdi = cd[i] = {\n      p: pos[i],\n      s: size[i],\n      cNext: connectToNext\n    };\n    trace._base[i] = -0.5 * cdi.s;\n\n    if (hasPeriod) {\n      cd[i].orig_p = origPos[i]; // used by hover\n\n      cd[i][pLetter + 'End'] = pObj.ends[i];\n      cd[i][pLetter + 'Start'] = pObj.starts[i];\n    }\n\n    if (trace.ids) {\n      cdi.id = String(trace.ids[i]);\n    } // calculate total values\n\n\n    if (i === 0) cd[0].vTotal = 0;\n    cd[0].vTotal += fixNum(cdi.s); // ratio from initial value\n\n    cdi.begR = fixNum(cdi.s) / fixNum(cd[0].s);\n  }\n\n  var prevGoodNum;\n\n  for (i = 0; i < serieslen; i++) {\n    cdi = cd[i];\n    if (cdi.s === BADNUM) continue; // ratio of total value\n\n    cdi.sumR = cdi.s / cd[0].vTotal; // ratio of previous (good) value\n\n    cdi.difR = prevGoodNum !== undefined ? cdi.s / prevGoodNum : 1;\n    prevGoodNum = cdi.s;\n  }\n\n  arraysToCalcdata(cd, trace);\n  calcSelection(cd, trace);\n  return cd;\n};\n\nfunction fixNum(a) {\n  return a === BADNUM ? 0 : a;\n}","map":{"version":3,"sources":["C:/Projects/reactApp/frontend/node_modules/plotly.js/src/traces/funnel/calc.js"],"names":["Axes","require","alignPeriod","arraysToCalcdata","calcSelection","BADNUM","module","exports","calc","gd","trace","xa","getFromId","xaxis","ya","yaxis","size","pos","origPos","pObj","hasPeriod","pLetter","i","cdi","orientation","makeCalcdata","yperiodalignment","xperiodalignment","vals","serieslen","Math","min","length","cd","Array","_base","connectToNext","p","s","cNext","orig_p","ends","starts","ids","id","String","vTotal","fixNum","begR","prevGoodNum","sumR","difR","undefined","a"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Axes = require('../../plots/cartesian/axes');\nvar alignPeriod = require('../../plots/cartesian/align_period');\nvar arraysToCalcdata = require('./arrays_to_calcdata');\nvar calcSelection = require('../scatter/calc_selection');\nvar BADNUM = require('../../constants/numerical').BADNUM;\n\nmodule.exports = function calc(gd, trace) {\n    var xa = Axes.getFromId(gd, trace.xaxis || 'x');\n    var ya = Axes.getFromId(gd, trace.yaxis || 'y');\n    var size, pos, origPos, pObj, hasPeriod, pLetter, i, cdi;\n\n    if(trace.orientation === 'h') {\n        size = xa.makeCalcdata(trace, 'x');\n        origPos = ya.makeCalcdata(trace, 'y');\n        pObj = alignPeriod(trace, ya, 'y', origPos);\n        hasPeriod = !!trace.yperiodalignment;\n        pLetter = 'y';\n    } else {\n        size = ya.makeCalcdata(trace, 'y');\n        origPos = xa.makeCalcdata(trace, 'x');\n        pObj = alignPeriod(trace, xa, 'x', origPos);\n        hasPeriod = !!trace.xperiodalignment;\n        pLetter = 'x';\n    }\n    pos = pObj.vals;\n\n    // create the \"calculated data\" to plot\n    var serieslen = Math.min(pos.length, size.length);\n    var cd = new Array(serieslen);\n\n    // Unlike other bar-like traces funnels do not support base attribute.\n    // bases for funnels are computed internally in a way that\n    // the mid-point of each bar are located on the axis line.\n    trace._base = [];\n\n    // set position and size\n    for(i = 0; i < serieslen; i++) {\n        // treat negative values as bad numbers\n        if(size[i] < 0) size[i] = BADNUM;\n\n        var connectToNext = false;\n        if(size[i] !== BADNUM) {\n            if(i + 1 < serieslen && size[i + 1] !== BADNUM) {\n                connectToNext = true;\n            }\n        }\n\n        cdi = cd[i] = {\n            p: pos[i],\n            s: size[i],\n            cNext: connectToNext\n        };\n\n        trace._base[i] = -0.5 * cdi.s;\n\n        if(hasPeriod) {\n            cd[i].orig_p = origPos[i]; // used by hover\n            cd[i][pLetter + 'End'] = pObj.ends[i];\n            cd[i][pLetter + 'Start'] = pObj.starts[i];\n        }\n\n        if(trace.ids) {\n            cdi.id = String(trace.ids[i]);\n        }\n\n        // calculate total values\n        if(i === 0) cd[0].vTotal = 0;\n        cd[0].vTotal += fixNum(cdi.s);\n\n        // ratio from initial value\n        cdi.begR = fixNum(cdi.s) / fixNum(cd[0].s);\n    }\n\n    var prevGoodNum;\n    for(i = 0; i < serieslen; i++) {\n        cdi = cd[i];\n        if(cdi.s === BADNUM) continue;\n\n        // ratio of total value\n        cdi.sumR = cdi.s / cd[0].vTotal;\n\n        // ratio of previous (good) value\n        cdi.difR = (prevGoodNum !== undefined) ? cdi.s / prevGoodNum : 1;\n\n        prevGoodNum = cdi.s;\n    }\n\n    arraysToCalcdata(cd, trace);\n    calcSelection(cd, trace);\n\n    return cd;\n};\n\nfunction fixNum(a) {\n    return (a === BADNUM) ? 0 : a;\n}\n"]},"metadata":{},"sourceType":"script"}